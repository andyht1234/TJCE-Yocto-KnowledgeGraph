* SDK build generally broken?
@ 2023-08-21 12:49 David Daniel
  2023-08-21 13:23 ` [yocto] " Alexander Kanavin
  2023-08-21 22:53 ` Richard Purdie
  0 siblings, 2 replies; 6+ messages in thread
From: David Daniel @ 2023-08-21 12:49 UTC (permalink / raw)
  To: yocto

Hello everybody

Has anyone successfully built an SDK lately? I cannot build any SDK,
neither for my image nor for core-image-minimal.

If I define my own image I get the error (I already wrote - nobody any
idea?) that the dummy-sdk package is to be built for a different
architecture:


x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
 nativesdk-openssl-conf                 x86_64_nativesdk           3.1.2-r0    oe-repo   12 k
 target-sdk-provides-dummy              sdk_provides_dummy_target  1.0-r0      oe-repo  9.0 k

THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the image can be built and works).

I guess this is due to the following code in the sdk-dummy recipe:

python() {
    # Put the package somewhere separate to ensure it's never used except
    # when we want it
    # (note that we have to do this in anonymous python here to avoid
    # allarch.bbclass disabling itself)
    d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
}

But furthermore, I am completely unable to build the SDK with my
machine - I took the machine from the working image sources I am
working with and took a plain master poky checkout (bleeding master).
When I want to build the SDK for the core-image-minimal I get the
following error:

ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error executing a python function in exec_func_python() autogenerated:

The stack trace of python calls that resulted in this exception/failure was:
File: 'exec_func_python() autogenerated', lineno: 2, function: <module>
     0001:
 *** 0002:do_collect_spdx_deps(d)
     0003:
File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
     0490:    from pathlib import Path
     0491:
     0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
     0493:
 *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
     0495:
     0496:    with spdx_deps_file.open("w") as f:
     0497:        json.dump(deps, f)
     0498:}
File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 475, function: collect_direct_deps
     0471:    deps = set()
     0472:    for dep_name in this_dep[3]:
     0473:        dep_data = taskdepdata[dep_name]
     0474:        if dep_data[1] == dep_task and dep_data[0] != pn:
 *** 0475:            deps.add((dep_data[0], dep_data[7]))
     0476:
     0477:    return sorted(deps)
     0478:
     0479:collect_direct_deps[vardepsexclude] += "BB_TASKDEPDATA"
Exception: IndexError: list index out of range

ERROR: Logfile of failure stored in: /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-native/1.4.19/temp/log.do_collect_spdx_deps.731506
ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed with exit code '1'

Is the generation of an SDK outdated, not recommended, not maintained
anymore? Or do you have any recommendations to troubleshoot these
issues?

^ permalink raw reply	[flat|nested] 6+ messages in thread
* Re: [yocto] SDK build generally broken?
  2023-08-21 12:49 SDK build generally broken? David Daniel
@ 2023-08-21 13:23 ` Alexander Kanavin
  2023-08-21 22:53 ` Richard Purdie
  1 sibling, 0 replies; 6+ messages in thread
From: Alexander Kanavin @ 2023-08-21 13:23 UTC (permalink / raw)
  To: David Daniel; +Cc: yocto

SDK testing happens several times a day in yocto CI. You should
probably try building for core-image-minimal with only poky, no custom
layers, as that is where it's tested. Then bring bits of your custom
setup until it starts failing.

Alex

On Mon, 21 Aug 2023 at 14:49, David Daniel <david.daniel@vrag.ch> wrote:
>
> Hello everybody
>
> Has anyone successfully built an SDK lately? I cannot build any SDK,
> neither for my image nor for core-image-minimal.
>
> If I define my own image I get the error (I already wrote - nobody any
> idea?) that the dummy-sdk package is to be built for a different
> architecture:
>
>
> x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
>  nativesdk-openssl-conf                 x86_64_nativesdk           3.1.2-r0    oe-repo   12 k
>  target-sdk-provides-dummy              sdk_provides_dummy_target  1.0-r0      oe-repo  9.0 k
>
> THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the image can be built and works).
>
> I guess this is due to the following code in the sdk-dummy recipe:
>
> python() {
>     # Put the package somewhere separate to ensure it's never used except
>     # when we want it
>     # (note that we have to do this in anonymous python here to avoid
>     # allarch.bbclass disabling itself)
>     d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
> }
>
> But furthermore, I am completely unable to build the SDK with my
> machine - I took the machine from the working image sources I am
> working with and took a plain master poky checkout (bleeding master).
> When I want to build the SDK for the core-image-minimal I get the
> following error:
>
> ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error executing a python function in exec_func_python() autogenerated:
>
> The stack trace of python calls that resulted in this exception/failure was:
> File: 'exec_func_python() autogenerated', lineno: 2, function: <module>
>      0001:
>  *** 0002:do_collect_spdx_deps(d)
>      0003:
> File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
>      0490:    from pathlib import Path
>      0491:
>      0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
>      0493:
>  *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
>      0495:
>      0496:    with spdx_deps_file.open("w") as f:
>      0497:        json.dump(deps, f)
>      0498:}
> File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 475, function: collect_direct_deps
>      0471:    deps = set()
>      0472:    for dep_name in this_dep[3]:
>      0473:        dep_data = taskdepdata[dep_name]
>      0474:        if dep_data[1] == dep_task and dep_data[0] != pn:
>  *** 0475:            deps.add((dep_data[0], dep_data[7]))
>      0476:
>      0477:    return sorted(deps)
>      0478:
>      0479:collect_direct_deps[vardepsexclude] += "BB_TASKDEPDATA"
> Exception: IndexError: list index out of range
>
> ERROR: Logfile of failure stored in: /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-native/1.4.19/temp/log.do_collect_spdx_deps.731506
> ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed with exit code '1'
>
> Is the generation of an SDK outdated, not recommended, not maintained
> anymore? Or do you have any recommendations to troubleshoot these
> issues?
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#60838): https://lists.yoctoproject.org/g/yocto/message/60838
> Mute This Topic: https://lists.yoctoproject.org/mt/100872021/1686489
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>


^ permalink raw reply	[flat|nested] 6+ messages in thread
* Re: [yocto] SDK build generally broken?
  2023-08-21 12:49 SDK build generally broken? David Daniel
  2023-08-21 13:23 ` [yocto] " Alexander Kanavin
@ 2023-08-21 22:53 ` Richard Purdie
       [not found]   ` <c2bd34af44f35a7bf0455c9e4bf89c2d2ddebd35.camel@vrag.ch>
  1 sibling, 1 reply; 6+ messages in thread
From: Richard Purdie @ 2023-08-21 22:53 UTC (permalink / raw)
  To: David Daniel, yocto

On Mon, 2023-08-21 at 12:49 +0000, David Daniel wrote:
> Hello everybody
> 
> Has anyone successfully built an SDK lately? I cannot build any SDK,
> neither for my image nor for core-image-minimal.
> 
> If I define my own image I get the error (I already wrote - nobody any
> idea?) that the dummy-sdk package is to be built for a different
> architecture:
> 
> 
> x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
>  nativesdk-openssl-conf                 x86_64_nativesdk           3.1.2-r0    oe-repo   12 k
>  target-sdk-provides-dummy              sdk_provides_dummy_target  1.0-r0      oe-repo  9.0 k
> 
> THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the image can be built and works).
> 
> I guess this is due to the following code in the sdk-dummy recipe:
> 
> python() {
>     # Put the package somewhere separate to ensure it's never used except
>     # when we want it
>     # (note that we have to do this in anonymous python here to avoid
>     # allarch.bbclass disabling itself)
>     d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
> }
> 
> But furthermore, I am completely unable to build the SDK with my
> machine - I took the machine from the working image sources I am
> working with and took a plain master poky checkout (bleeding master).
> When I want to build the SDK for the core-image-minimal I get the
> following error:
> 
> ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error executing a python function in exec_func_python() autogenerated:
> 
> The stack trace of python calls that resulted in this exception/failure was:
> File: 'exec_func_python() autogenerated', lineno: 2, function: <module>
>      0001:
>  *** 0002:do_collect_spdx_deps(d)
>      0003:
> File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
>      0490:    from pathlib import Path
>      0491:
>      0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
>      0493:
>  *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
>      0495:
>      0496:    with spdx_deps_file.open("w") as f:
>      0497:        json.dump(deps, f)
>      0498:}
> File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-2.2.bbclass', lineno: 475, function: collect_direct_deps
>      0471:    deps = set()
>      0472:    for dep_name in this_dep[3]:
>      0473:        dep_data = taskdepdata[dep_name]
>      0474:        if dep_data[1] == dep_task and dep_data[0] != pn:
>  *** 0475:            deps.add((dep_data[0], dep_data[7]))
>      0476:
>      0477:    return sorted(deps)
>      0478:
>      0479:collect_direct_deps[vardepsexclude] += "BB_TASKDEPDATA"
> Exception: IndexError: list index out of range
> 
> ERROR: Logfile of failure stored in: /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-native/1.4.19/temp/log.do_collect_spdx_deps.731506
> ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed with exit code '1'
> 
> Is the generation of an SDK outdated, not recommended, not maintained
> anymore? Or do you have any recommendations to troubleshoot these
> issues?

SDK builds are tested on the autobuilder so it does work, at least
there.

Are you using the right version of bitbake with that metadata? That
index issue looks a bit to me like it is the wrong version of bitbake.

Cheers,

Richard



^ permalink raw reply	[flat|nested] 6+ messages in thread
* Re: [yocto] SDK build generally broken?
       [not found]   ` <c2bd34af44f35a7bf0455c9e4bf89c2d2ddebd35.camel@vrag.ch>
@ 2023-08-22  8:36     ` Richard Purdie
  2023-08-23 15:20       ` David Daniel
       [not found]       ` <177E0C50ADEBD9DE.28529@lists.yoctoproject.org>
  0 siblings, 2 replies; 6+ messages in thread
From: Richard Purdie @ 2023-08-22  8:36 UTC (permalink / raw)
  To: David Daniel; +Cc: yocto

On Tue, 2023-08-22 at 06:58 +0000, David Daniel wrote:
> Thanks for your reply! I cannot think of how I could mix the two but I
> checked out 4.2.2, added my machine, sourced oe-init-build-env and
> started the build. So the bitbake I use comes from the poky repository
> and the checkout I use.
> 
> Is there a good guideline what a machine must define and do in order to
> be fully compliant and compatible? I have gone through the BSP
> Developer Guide and provided all listed necessary items. Still it seems
> that I am missing something or that I am doing wrong. Since I can
> successfully build the image though, even when I include my own distro
> layer and use it all that SDK build problems seem awkward to me.
> 
> Or is there any particular thing an SDK build needs from a BSP layer
> that is not listed explicitely in the BSP Developer Guide?
> 
> Thanks for any help!
> Greets
> 
> Am Montag, dem 21.08.2023 um 23:53 +0100 schrieb Richard Purdie:
> > On Mon, 2023-08-21 at 12:49 +0000, David Daniel wrote:
> > > Hello everybody
> > > 
> > > Has anyone successfully built an SDK lately? I cannot build any
> > > SDK,
> > > neither for my image nor for core-image-minimal.
> > > 
> > > If I define my own image I get the error (I already wrote - nobody
> > > any
> > > idea?) that the dummy-sdk package is to be built for a different
> > > architecture:
> > > 
> > > 
> > > x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
> > >  nativesdk-openssl-conf                 x86_64_nativesdk          
> > > 3.1.2-r0    oe-repo   12 k
> > >  target-sdk-provides-dummy              sdk_provides_dummy_target 
> > > 1.0-r0      oe-repo  9.0 k
> > > 
> > > THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the image
> > > can be built and works).
> > > 
> > > I guess this is due to the following code in the sdk-dummy recipe:
> > > 
> > > python() {
> > >     # Put the package somewhere separate to ensure it's never used
> > > except
> > >     # when we want it
> > >     # (note that we have to do this in anonymous python here to
> > > avoid
> > >     # allarch.bbclass disabling itself)
> > >     d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
> > > }
> > > 
> > > But furthermore, I am completely unable to build the SDK with my
> > > machine - I took the machine from the working image sources I am
> > > working with and took a plain master poky checkout (bleeding
> > > master).
> > > When I want to build the SDK for the core-image-minimal I get the
> > > following error:
> > > 
> > > ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error executing a
> > > python function in exec_func_python() autogenerated:
> > > 
> > > The stack trace of python calls that resulted in this
> > > exception/failure was:
> > > File: 'exec_func_python() autogenerated', lineno: 2, function:
> > > <module>
> > >      0001:
> > >  *** 0002:do_collect_spdx_deps(d)
> > >      0003:
> > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > 2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
> > >      0490:    from pathlib import Path
> > >      0491:
> > >      0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
> > >      0493:
> > >  *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
> > >      0495:
> > >      0496:    with spdx_deps_file.open("w") as f:
> > >      0497:        json.dump(deps, f)
> > >      0498:}
> > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > 2.2.bbclass', lineno: 475, function: collect_direct_deps
> > >      0471:    deps = set()
> > >      0472:    for dep_name in this_dep[3]:
> > >      0473:        dep_data = taskdepdata[dep_name]
> > >      0474:        if dep_data[1] == dep_task and dep_data[0] != pn:
> > >  *** 0475:            deps.add((dep_data[0], dep_data[7]))
> > >      0476:
> > >      0477:    return sorted(deps)
> > >      0478:
> > >      0479:collect_direct_deps[vardepsexclude] += "BB_TASKDEPDATA"
> > > Exception: IndexError: list index out of range
> > > 
> > > ERROR: Logfile of failure stored in:
> > > /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-
> > > native/1.4.19/temp/log.do_collect_spdx_deps.731506
> > > ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-
> > > devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed with
> > > exit code '1'
> > > 
> > > Is the generation of an SDK outdated, not recommended, not
> > > maintained
> > > anymore? Or do you have any recommendations to troubleshoot these
> > > issues?
> > 
> > SDK builds are tested on the autobuilder so it does work, at least
> > there.
> > 
> > Are you using the right version of bitbake with that metadata? That
> > index issue looks a bit to me like it is the wrong version of
> > bitbake.

Firstly, please keep replies on the mailing list.

It looks like you have SPDX enabled. That wasn't enabled by default
until after mickledore was released so we hadn't tested with that
element of the configuration on the autobuilder.

Are you using 4.2.2 or master? You said 4.2.2 above but also that you
tested with master. The code fragment above includes:

https://git.yoctoproject.org/poky/commit/meta/classes/create-spdx-2.2.bbclass?id=15acbd10906568a1ed9c548b465f1cb6b5205202

which means it is master or there is backported code so it isn't 4.2.2
either.

That code depends on a change from bitbake master:

https://git.yoctoproject.org/poky/commit/bitbake?id=c6763d27efd11e2bc2a62147890ad1067c4af2ec

which if it was missing, would result in the error above.

Please be specific about what you're trying to run as I stand by what I
said, you're using master of oe-core with an older bitbake to get that
specific error. Or you've backported bits of master's spdx changes.

Cheers,

Richard



^ permalink raw reply	[flat|nested] 6+ messages in thread
* Re: [yocto] SDK build generally broken?
  2023-08-22  8:36     ` Richard Purdie
@ 2023-08-23 15:20       ` David Daniel
       [not found]       ` <177E0C50ADEBD9DE.28529@lists.yoctoproject.org>
  1 sibling, 0 replies; 6+ messages in thread
From: David Daniel @ 2023-08-23 15:20 UTC (permalink / raw)
  To: yocto

Thanks a lot for your answers and your time! It turned out that the
only problem was the following:

TOOLCHAIN_HOST_TASK += "nativesdk-cmake"

When I remove this, I still get the CMake Toolchain file but the error
is gone.

I must have missed something, it seems this is done by default. At
least here adding this task breaks the SDK and it is not needed at all.

So I am happily building again.

Best Regards
David

Am Dienstag, dem 22.08.2023 um 09:36 +0100 schrieb Richard Purdie:
> On Tue, 2023-08-22 at 06:58 +0000, David Daniel wrote:
> > Thanks for your reply! I cannot think of how I could mix the two
> > but I
> > checked out 4.2.2, added my machine, sourced oe-init-build-env and
> > started the build. So the bitbake I use comes from the poky
> > repository
> > and the checkout I use.
> > 
> > Is there a good guideline what a machine must define and do in
> > order to
> > be fully compliant and compatible? I have gone through the BSP
> > Developer Guide and provided all listed necessary items. Still it
> > seems
> > that I am missing something or that I am doing wrong. Since I can
> > successfully build the image though, even when I include my own
> > distro
> > layer and use it all that SDK build problems seem awkward to me.
> > 
> > Or is there any particular thing an SDK build needs from a BSP
> > layer
> > that is not listed explicitely in the BSP Developer Guide?
> > 
> > Thanks for any help!
> > Greets
> > 
> > Am Montag, dem 21.08.2023 um 23:53 +0100 schrieb Richard Purdie:
> > > On Mon, 2023-08-21 at 12:49 +0000, David Daniel wrote:
> > > > Hello everybody
> > > > 
> > > > Has anyone successfully built an SDK lately? I cannot build any
> > > > SDK,
> > > > neither for my image nor for core-image-minimal.
> > > > 
> > > > If I define my own image I get the error (I already wrote -
> > > > nobody
> > > > any
> > > > idea?) that the dummy-sdk package is to be built for a
> > > > different
> > > > architecture:
> > > > 
> > > > 
> > > > x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
> > > >  nativesdk-openssl-conf                
> > > > x86_64_nativesdk          
> > > > 3.1.2-r0    oe-repo   12 k
> > > >  target-sdk-provides-dummy             
> > > > sdk_provides_dummy_target 
> > > > 1.0-r0      oe-repo  9.0 k
> > > > 
> > > > THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the
> > > > image
> > > > can be built and works).
> > > > 
> > > > I guess this is due to the following code in the sdk-dummy
> > > > recipe:
> > > > 
> > > > python() {
> > > >     # Put the package somewhere separate to ensure it's never
> > > > used
> > > > except
> > > >     # when we want it
> > > >     # (note that we have to do this in anonymous python here to
> > > > avoid
> > > >     # allarch.bbclass disabling itself)
> > > >     d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
> > > > }
> > > > 
> > > > But furthermore, I am completely unable to build the SDK with
> > > > my
> > > > machine - I took the machine from the working image sources I
> > > > am
> > > > working with and took a plain master poky checkout (bleeding
> > > > master).
> > > > When I want to build the SDK for the core-image-minimal I get
> > > > the
> > > > following error:
> > > > 
> > > > ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error
> > > > executing a
> > > > python function in exec_func_python() autogenerated:
> > > > 
> > > > The stack trace of python calls that resulted in this
> > > > exception/failure was:
> > > > File: 'exec_func_python() autogenerated', lineno: 2, function:
> > > > <module>
> > > >      0001:
> > > >  *** 0002:do_collect_spdx_deps(d)
> > > >      0003:
> > > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > > 2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
> > > >      0490:    from pathlib import Path
> > > >      0491:
> > > >      0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
> > > >      0493:
> > > >  *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
> > > >      0495:
> > > >      0496:    with spdx_deps_file.open("w") as f:
> > > >      0497:        json.dump(deps, f)
> > > >      0498:}
> > > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > > 2.2.bbclass', lineno: 475, function: collect_direct_deps
> > > >      0471:    deps = set()
> > > >      0472:    for dep_name in this_dep[3]:
> > > >      0473:        dep_data = taskdepdata[dep_name]
> > > >      0474:        if dep_data[1] == dep_task and dep_data[0] !=
> > > > pn:
> > > >  *** 0475:            deps.add((dep_data[0], dep_data[7]))
> > > >      0476:
> > > >      0477:    return sorted(deps)
> > > >      0478:
> > > >      0479:collect_direct_deps[vardepsexclude] +=
> > > > "BB_TASKDEPDATA"
> > > > Exception: IndexError: list index out of range
> > > > 
> > > > ERROR: Logfile of failure stored in:
> > > > /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-
> > > > native/1.4.19/temp/log.do_collect_spdx_deps.731506
> > > > ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-
> > > > devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed
> > > > with
> > > > exit code '1'
> > > > 
> > > > Is the generation of an SDK outdated, not recommended, not
> > > > maintained
> > > > anymore? Or do you have any recommendations to troubleshoot
> > > > these
> > > > issues?
> > > 
> > > SDK builds are tested on the autobuilder so it does work, at
> > > least
> > > there.
> > > 
> > > Are you using the right version of bitbake with that metadata?
> > > That
> > > index issue looks a bit to me like it is the wrong version of
> > > bitbake.
> 
> Firstly, please keep replies on the mailing list.
> 
> It looks like you have SPDX enabled. That wasn't enabled by default
> until after mickledore was released so we hadn't tested with that
> element of the configuration on the autobuilder.
> 
> Are you using 4.2.2 or master? You said 4.2.2 above but also that you
> tested with master. The code fragment above includes:
> 
> https://git.yoctoproject.org/poky/commit/meta/classes/create-spdx-2.2.bbclass?id=15acbd10906568a1ed9c548b465f1cb6b5205202
> 
> which means it is master or there is backported code so it isn't
> 4.2.2
> either.
> 
> That code depends on a change from bitbake master:
> 
> https://git.yoctoproject.org/poky/commit/bitbake?id=c6763d27efd11e2bc2a62147890ad1067c4af2ec
> 
> which if it was missing, would result in the error above.
> 
> Please be specific about what you're trying to run as I stand by what
> I
> said, you're using master of oe-core with an older bitbake to get
> that
> specific error. Or you've backported bits of master's spdx changes.
> 
> Cheers,
> 
> Richard
> 



^ permalink raw reply	[flat|nested] 6+ messages in thread
* Re: [yocto] SDK build generally broken?
       [not found]       ` <177E0C50ADEBD9DE.28529@lists.yoctoproject.org>
@ 2023-08-29  9:01         ` David Daniel
  0 siblings, 0 replies; 6+ messages in thread
From: David Daniel @ 2023-08-29  9:01 UTC (permalink / raw)
  To: yocto

Ok, after some more reading the docs it turned out I was out of date.
Searching the internet on how to build the CMake addition to the SDK
one finds (a lot):

TOOLCHAIN_HOST_TASK += "nativesdk-cmake"

This is the old syntax that does not work anymore. It has to be written
with the following syntax:

TOOLCHAIN_HOST_TASK:append = " nativesdk-cmake"

That was why in my case the whole TOOLCHAIN_HOST_TASK was completely
overwritten with nativesdk-cmake.

Regards
Dave

Am Mittwoch, dem 23.08.2023 um 15:20 +0000 schrieb David Daniel:
> Thanks a lot for your answers and your time! It turned out that the
> only problem was the following:
> 
> TOOLCHAIN_HOST_TASK += "nativesdk-cmake"
> 
> When I remove this, I still get the CMake Toolchain file but the
> error
> is gone.
> 
> I must have missed something, it seems this is done by default. At
> least here adding this task breaks the SDK and it is not needed at
> all.
> 
> So I am happily building again.
> 
> Best Regards
> David
> 
> Am Dienstag, dem 22.08.2023 um 09:36 +0100 schrieb Richard Purdie:
> > On Tue, 2023-08-22 at 06:58 +0000, David Daniel wrote:
> > > Thanks for your reply! I cannot think of how I could mix the two
> > > but I
> > > checked out 4.2.2, added my machine, sourced oe-init-build-env
> > > and
> > > started the build. So the bitbake I use comes from the poky
> > > repository
> > > and the checkout I use.
> > > 
> > > Is there a good guideline what a machine must define and do in
> > > order to
> > > be fully compliant and compatible? I have gone through the BSP
> > > Developer Guide and provided all listed necessary items. Still it
> > > seems
> > > that I am missing something or that I am doing wrong. Since I can
> > > successfully build the image though, even when I include my own
> > > distro
> > > layer and use it all that SDK build problems seem awkward to me.
> > > 
> > > Or is there any particular thing an SDK build needs from a BSP
> > > layer
> > > that is not listed explicitely in the BSP Developer Guide?
> > > 
> > > Thanks for any help!
> > > Greets
> > > 
> > > Am Montag, dem 21.08.2023 um 23:53 +0100 schrieb Richard Purdie:
> > > > On Mon, 2023-08-21 at 12:49 +0000, David Daniel wrote:
> > > > > Hello everybody
> > > > > 
> > > > > Has anyone successfully built an SDK lately? I cannot build
> > > > > any
> > > > > SDK,
> > > > > neither for my image nor for core-image-minimal.
> > > > > 
> > > > > If I define my own image I get the error (I already wrote -
> > > > > nobody
> > > > > any
> > > > > idea?) that the dummy-sdk package is to be built for a
> > > > > different
> > > > > architecture:
> > > > > 
> > > > > 
> > > > > x86_64_nativesdk           3.1.2-r0    oe-repo  330 k
> > > > >  nativesdk-openssl-conf                
> > > > > x86_64_nativesdk          
> > > > > 3.1.2-r0    oe-repo   12 k
> > > > >  target-sdk-provides-dummy             
> > > > > sdk_provides_dummy_target 
> > > > > 1.0-r0      oe-repo  9.0 k
> > > > > 
> > > > > THIS ERROR ONLY APPEARS IF I DEFINE MY OWN IMAGE (though the
> > > > > image
> > > > > can be built and works).
> > > > > 
> > > > > I guess this is due to the following code in the sdk-dummy
> > > > > recipe:
> > > > > 
> > > > > python() {
> > > > >     # Put the package somewhere separate to ensure it's never
> > > > > used
> > > > > except
> > > > >     # when we want it
> > > > >     # (note that we have to do this in anonymous python here
> > > > > to
> > > > > avoid
> > > > >     # allarch.bbclass disabling itself)
> > > > >     d.setVar('PACKAGE_ARCH', '${DUMMYARCH}')
> > > > > }
> > > > > 
> > > > > But furthermore, I am completely unable to build the SDK with
> > > > > my
> > > > > machine - I took the machine from the working image sources I
> > > > > am
> > > > > working with and took a plain master poky checkout (bleeding
> > > > > master).
> > > > > When I want to build the SDK for the core-image-minimal I get
> > > > > the
> > > > > following error:
> > > > > 
> > > > > ERROR: m4-native-1.4.19-r0 do_collect_spdx_deps: Error
> > > > > executing a
> > > > > python function in exec_func_python() autogenerated:
> > > > > 
> > > > > The stack trace of python calls that resulted in this
> > > > > exception/failure was:
> > > > > File: 'exec_func_python() autogenerated', lineno: 2,
> > > > > function:
> > > > > <module>
> > > > >      0001:
> > > > >  *** 0002:do_collect_spdx_deps(d)
> > > > >      0003:
> > > > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > > > 2.2.bbclass', lineno: 494, function: do_collect_spdx_deps
> > > > >      0490:    from pathlib import Path
> > > > >      0491:
> > > > >      0492:    spdx_deps_file = Path(d.getVar("SPDXDEPS"))
> > > > >      0493:
> > > > >  *** 0494:    deps = collect_direct_deps(d, "do_create_spdx")
> > > > >      0495:
> > > > >      0496:    with spdx_deps_file.open("w") as f:
> > > > >      0497:        json.dump(deps, f)
> > > > >      0498:}
> > > > > File: '/home/david/yocto/bf133/poky/meta/classes/create-spdx-
> > > > > 2.2.bbclass', lineno: 475, function: collect_direct_deps
> > > > >      0471:    deps = set()
> > > > >      0472:    for dep_name in this_dep[3]:
> > > > >      0473:        dep_data = taskdepdata[dep_name]
> > > > >      0474:        if dep_data[1] == dep_task and dep_data[0]
> > > > > !=
> > > > > pn:
> > > > >  *** 0475:            deps.add((dep_data[0], dep_data[7]))
> > > > >      0476:
> > > > >      0477:    return sorted(deps)
> > > > >      0478:
> > > > >      0479:collect_direct_deps[vardepsexclude] +=
> > > > > "BB_TASKDEPDATA"
> > > > > Exception: IndexError: list index out of range
> > > > > 
> > > > > ERROR: Logfile of failure stored in:
> > > > > /mnt/data/yocto/bf133/sdk/build/tmp/work/x86_64-linux/m4-
> > > > > native/1.4.19/temp/log.do_collect_spdx_deps.731506
> > > > > ERROR: Task (/home/david/yocto/bf133/poky/meta/recipes-
> > > > > devtools/m4/m4-native_1.4.19.bb:do_collect_spdx_deps) failed
> > > > > with
> > > > > exit code '1'
> > > > > 
> > > > > Is the generation of an SDK outdated, not recommended, not
> > > > > maintained
> > > > > anymore? Or do you have any recommendations to troubleshoot
> > > > > these
> > > > > issues?
> > > > 
> > > > SDK builds are tested on the autobuilder so it does work, at
> > > > least
> > > > there.
> > > > 
> > > > Are you using the right version of bitbake with that metadata?
> > > > That
> > > > index issue looks a bit to me like it is the wrong version of
> > > > bitbake.
> > 
> > Firstly, please keep replies on the mailing list.
> > 
> > It looks like you have SPDX enabled. That wasn't enabled by default
> > until after mickledore was released so we hadn't tested with that
> > element of the configuration on the autobuilder.
> > 
> > Are you using 4.2.2 or master? You said 4.2.2 above but also that
> > you
> > tested with master. The code fragment above includes:
> > 
> > https://git.yoctoproject.org/poky/commit/meta/classes/create-spdx-2.2.bbclass?id=15acbd10906568a1ed9c548b465f1cb6b5205202
> > 
> > which means it is master or there is backported code so it isn't
> > 4.2.2
> > either.
> > 
> > That code depends on a change from bitbake master:
> > 
> > https://git.yoctoproject.org/poky/commit/bitbake?id=c6763d27efd11e2bc2a62147890ad1067c4af2ec
> > 
> > which if it was missing, would result in the error above.
> > 
> > Please be specific about what you're trying to run as I stand by
> > what
> > I
> > said, you're using master of oe-core with an older bitbake to get
> > that
> > specific error. Or you've backported bits of master's spdx changes.
> > 
> > Cheers,
> > 
> > Richard
> > 
> 
> 
> 
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#60859):
> https://lists.yoctoproject.org/g/yocto/message/60859
> Mute This Topic: https://lists.yoctoproject.org/mt/100872021/7801465
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe:
> https://lists.yoctoproject.org/g/yocto/unsub [david.daniel@vrag.ch]
> -=-=-=-=-=-=-=-=-=-=-=-
> 


^ permalink raw reply	[flat|nested] 6+ messages in thread
end of thread, other threads:[~2023-08-29  9:01 UTC | newest]

Thread overview: 6+ messages (download: mbox.gz / follow: Atom feed)
-- links below jump to the message on this page --
2023-08-21 12:49 SDK build generally broken? David Daniel
2023-08-21 13:23 ` [yocto] " Alexander Kanavin
2023-08-21 22:53 ` Richard Purdie
     [not found]   ` <c2bd34af44f35a7bf0455c9e4bf89c2d2ddebd35.camel@vrag.ch>
2023-08-22  8:36     ` Richard Purdie
2023-08-23 15:20       ` David Daniel
     [not found]       ` <177E0C50ADEBD9DE.28529@lists.yoctoproject.org>
2023-08-29  9:01         ` David Daniel

