* Changing git url of qemu
@ 2022-09-28  7:58 PHIL
  2022-09-28  8:14 ` [yocto] " Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-28  7:58 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 238 bytes --]

Greetings,

I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?

Regards
-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 450 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  7:58 Changing git url of qemu PHIL
@ 2022-09-28  8:14 ` Alexander Kanavin
  2022-09-28  8:21   ` PHIL
  0 siblings, 1 reply; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-28  8:14 UTC (permalink / raw)
  To: Edgar Mobile; +Cc: yocto

[-- Attachment #1: Type: text/plain, Size: 848 bytes --]

You need to clarify what you want to do exactly. Why can’t you use the
existing recipe?

Alex

On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:

> Greetings,
>
> I want to change the git repo url in order to test the Venus driver. Can
> someone tell me which variable in which recipe I'd have to set?
>
> Regards
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#58196):
> https://lists.yoctoproject.org/g/yocto/message/58196
> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [
> alex.kanavin@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>
>

[-- Attachment #2: Type: text/html, Size: 1737 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:14 ` [yocto] " Alexander Kanavin
@ 2022-09-28  8:21   ` PHIL
  2022-09-28  8:29     ` Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-28  8:21 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: yocto

[-- Attachment #1: Type: text/plain, Size: 1300 bytes --]

I try to enable vulkan according to this tutorial

https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/

According to the author the modified qemu branch is still necessary so I want to enable that.

Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>You need to clarify what you want to do exactly. Why can’t you use the
>existing recipe?
>
>Alex
>
>On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>
>> Greetings,
>>
>> I want to change the git repo url in order to test the Venus driver. Can
>> someone tell me which variable in which recipe I'd have to set?
>>
>> Regards
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> -=-=-=-=-=-=-=-=-=-=-=-
>> Links: You receive all messages sent to this group.
>> View/Reply Online (#58196):
>> https://lists.yoctoproject.org/g/yocto/message/58196
>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>> Group Owner: yocto+owner@lists.yoctoproject.org
>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [
>> alex.kanavin@gmail.com]
>> -=-=-=-=-=-=-=-=-=-=-=-
>>
>>

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 2654 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:21   ` PHIL
@ 2022-09-28  8:29     ` Alexander Kanavin
  2022-09-28  8:44       ` PHIL
  0 siblings, 1 reply; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-28  8:29 UTC (permalink / raw)
  To: PHIL; +Cc: yocto

[-- Attachment #1: Type: text/plain, Size: 1607 bytes --]

I would first check whether any of that work in the branch has meanwhile
landed upstream. The post is from 2021.

Have you tried the software Vulkan in the guest?

Alex

On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:

> I try to enable vulkan according to this tutorial
>
>
> https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>
> According to the author the modified qemu branch is still necessary so I
> want to enable that.
>
>
> Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <
> alex.kanavin@gmail.com>:
>>
>> You need to clarify what you want to do exactly. Why can’t you use the
>> existing recipe?
>>
>> Alex
>>
>> On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>
>>> Greetings,
>>>
>>> I want to change the git repo url in order to test the Venus driver. Can
>>> someone tell me which variable in which recipe I'd have to set?
>>>
>>> Regards
>>> --
>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>> -=-=-=-=-=-=-=-=-=-=-=-
>>> Links: You receive all messages sent to this group.
>>> View/Reply Online (#58196):
>>> https://lists.yoctoproject.org/g/yocto/message/58196
>>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>> Group Owner: yocto+owner@lists.yoctoproject.org
>>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [
>>> alex.kanavin@gmail.com]
>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>
>>> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>

[-- Attachment #2: Type: text/html, Size: 3336 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:29     ` Alexander Kanavin
@ 2022-09-28  8:44       ` PHIL
  2022-09-28  8:51         ` Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-28  8:44 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: yocto

[-- Attachment #1: Type: text/plain, Size: 2314 bytes --]

I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.

Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.

I also added virtio-experimental flag to mesa and virglrenderer meson recipes.

I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.

What am I missing for Software Mode?

Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>I would first check whether any of that work in the branch has meanwhile
>landed upstream. The post is from 2021.
>
>Have you tried the software Vulkan in the guest?
>
>Alex
>
>On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>
>> I try to enable vulkan according to this tutorial
>>
>>
>> https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>
>> According to the author the modified qemu branch is still necessary so I
>> want to enable that.
>>
>>
>> Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <
>> alex.kanavin@gmail.com>:
>>>
>>> You need to clarify what you want to do exactly. Why can’t you use the
>>> existing recipe?
>>>
>>> Alex
>>>
>>> On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>
>>>> Greetings,
>>>>
>>>> I want to change the git repo url in order to test the Venus driver. Can
>>>> someone tell me which variable in which recipe I'd have to set?
>>>>
>>>> Regards
>>>> --
>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>> Links: You receive all messages sent to this group.
>>>> View/Reply Online (#58196):
>>>> https://lists.yoctoproject.org/g/yocto/message/58196
>>>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>> Group Owner: yocto+owner@lists.yoctoproject.org
>>>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [
>>>> alex.kanavin@gmail.com]
>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>
>>>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 4373 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:44       ` PHIL
@ 2022-09-28  8:51         ` Alexander Kanavin
  2022-09-28  9:26           ` PHIL
  2022-09-28  9:49           ` PHIL
  0 siblings, 2 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-28  8:51 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

I think for software vulkan you need to pass in
-Dvulkan-drivers=swrast when building mesa for the target.

Alex

On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>
> I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>
> Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>
> I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>
> I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>
> What am I missing for Software Mode?
>
> Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>
>> Have you tried the software Vulkan in the guest?
>>
>> Alex
>>
>> On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>
>>> I try to enable vulkan according to this tutorial
>>>
>>> https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>
>>> According to the author the modified qemu branch is still necessary so I want to enable that.
>>>
>>>
>>> Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>> You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>
>>>> Alex
>>>>
>>>> On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>
>>>>> Greetings,
>>>>>
>>>>> I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>
>>>>> Regards
>>>>> --
>>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>> Links: You receive all messages sent to this group.
>>>>> View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>> Group Owner: yocto+owner@lists.yoctoproject.org
>>>>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>>
>>> --
>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:51         ` Alexander Kanavin
@ 2022-09-28  9:26           ` PHIL
  2022-09-28  9:49           ` PHIL
  1 sibling, 0 replies; 28+ messages in thread
From: PHIL @ 2022-09-28  9:26 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 2858 bytes --]

I now have 

-Dvulkan-drivers=swrast,virtio-experimental

In mesa_22.2.0.bb  doesn't help

Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>I think for software vulkan you need to pass in
>-Dvulkan-drivers=swrast when building mesa for the target.
>
>Alex
>
>On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>
>> I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>
>> Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>
>> I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>
>> I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>
>> What am I missing for Software Mode?
>>
>> Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>
>>> Have you tried the software Vulkan in the guest?
>>>
>>> Alex
>>>
>>> On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>> I try to enable vulkan according to this tutorial
>>>>
>>>> https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>
>>>> According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>
>>>>
>>>> Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>> You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>
>>>>> Alex
>>>>>
>>>>> On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>> Greetings,
>>>>>>
>>>>>> I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>
>>>>>> Regards
>>>>>> --
>>>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>>> Links: You receive all messages sent to this group.
>>>>>> View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>> Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>>>
>>>> --
>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 4091 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  8:51         ` Alexander Kanavin
  2022-09-28  9:26           ` PHIL
@ 2022-09-28  9:49           ` PHIL
  2022-09-28 10:48             ` Alexander Kanavin
  1 sibling, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-28  9:49 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 2908 bytes --]

Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?

Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>I think for software vulkan you need to pass in
>-Dvulkan-drivers=swrast when building mesa for the target.
>
>Alex
>
>On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>
>> I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>
>> Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>
>> I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>
>> I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>
>> What am I missing for Software Mode?
>>
>> Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>
>>> Have you tried the software Vulkan in the guest?
>>>
>>> Alex
>>>
>>> On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>> I try to enable vulkan according to this tutorial
>>>>
>>>> https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>
>>>> According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>
>>>>
>>>> Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>> You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>
>>>>> Alex
>>>>>
>>>>> On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>> Greetings,
>>>>>>
>>>>>> I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>
>>>>>> Regards
>>>>>> --
>>>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>>> Links: You receive all messages sent to this group.
>>>>>> View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>> Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>> Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>> -=-=-=-=-=-=-=-=-=-=-=-
>>>>>>
>>>> --
>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 4133 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28  9:49           ` PHIL
@ 2022-09-28 10:48             ` Alexander Kanavin
  2022-09-28 11:23               ` PHIL
  0 siblings, 1 reply; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-28 10:48 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

The following works for me. I get

tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so

--- a/meta/recipes-graphics/mesa/mesa.inc
+++ b/meta/recipes-graphics/mesa/mesa.inc
@@ -88,6 +88,7 @@ def strip_comma(s):

 PACKAGECONFIG = " \
        gallium \
+        gallium-llvm \
        ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
        ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
gles gbm virgl', '', d)} \
        ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
@@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
-Ddri3=disabled, xorgproto libxshmfence"

 # Vulkan drivers need dri3 enabled
 # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
-VULKAN_DRIVERS = ""
+VULKAN_DRIVERS = "swrast"
 VULKAN_DRIVERS:append:x86:class-target = ",intel"
 VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
 VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
'freedreno', ',freedreno', '', d)}"

Alex

On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>
> Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>
> Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> I think for software vulkan you need to pass in
>> -Dvulkan-drivers=swrast when building mesa for the target.
>>
>> Alex
>>
>> On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>  I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>
>>>  Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>
>>>  I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>
>>>  I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>
>>>  What am I missing for Software Mode?
>>>
>>>  Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>  I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>
>>>>  Have you tried the software Vulkan in the guest?
>>>>
>>>>  Alex
>>>>
>>>>  On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>  I try to enable vulkan according to this tutorial
>>>>>
>>>>>  https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>
>>>>>  According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>
>>>>>
>>>>>  Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>  You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>
>>>>>>  Alex
>>>>>>
>>>>>>  On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>  Greetings,
>>>>>>>
>>>>>>>  I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>
>>>>>>>  Regards
>>>>>>>  --
>>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>> ________________________________
>>>>>>>  Links: You receive all messages sent to this group.
>>>>>>>  View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>  Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>  Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>  Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>> ________________________________
>>>>>
>>>>> --
>>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28 10:48             ` Alexander Kanavin
@ 2022-09-28 11:23               ` PHIL
  2022-09-28 11:37                 ` Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-28 11:23 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 4682 bytes --]

Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.

Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>The following works for me. I get
>
>tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>
>--- a/meta/recipes-graphics/mesa/mesa.inc
>+++ b/meta/recipes-graphics/mesa/mesa.inc
>@@ -88,6 +88,7 @@ def strip_comma(s):
>
> PACKAGECONFIG = " \
>        gallium \
>+        gallium-llvm \
>        ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>        ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>gles gbm virgl', '', d)} \
>        ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>@@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>-Ddri3=disabled, xorgproto libxshmfence"
>
> # Vulkan drivers need dri3 enabled
> # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>-VULKAN_DRIVERS = ""
>+VULKAN_DRIVERS = "swrast"
> VULKAN_DRIVERS:append:x86:class-target = ",intel"
> VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
> VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>'freedreno', ',freedreno', '', d)}"
>
>Alex
>
>On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>
>> Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>
>> Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> I think for software vulkan you need to pass in
>>> -Dvulkan-drivers=swrast when building mesa for the target.
>>>
>>> Alex
>>>
>>> On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>
>>>>  Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>
>>>>  I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>
>>>>  I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>
>>>>  What am I missing for Software Mode?
>>>>
>>>>  Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>  I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>
>>>>>  Have you tried the software Vulkan in the guest?
>>>>>
>>>>>  Alex
>>>>>
>>>>>  On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>  I try to enable vulkan according to this tutorial
>>>>>>
>>>>>>  https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>
>>>>>>  According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>
>>>>>>
>>>>>>  Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>  You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>
>>>>>>>  Alex
>>>>>>>
>>>>>>>  On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>  Greetings,
>>>>>>>>
>>>>>>>>  I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>
>>>>>>>>  Regards
>>>>>>>>  --
>>>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>> ________________________________
>>>>>>>>  Links: You receive all messages sent to this group.
>>>>>>>>  View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>  Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>  Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>  Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>> ________________________________
>>>>>>
>>>>>> --
>>>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 6125 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28 11:23               ` PHIL
@ 2022-09-28 11:37                 ` Alexander Kanavin
  2022-09-28 17:59                   ` PHIL
  2022-09-29 10:28                   ` PHIL
  0 siblings, 2 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-28 11:37 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

Try latest poky master?

Alex

On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>
> Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>
> Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> The following works for me. I get
>>
>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>
>> --- a/meta/recipes-graphics/mesa/mesa.inc
>> +++ b/meta/recipes-graphics/mesa/mesa.inc
>> @@ -88,6 +88,7 @@ def strip_comma(s):
>>
>>  PACKAGECONFIG = " \
>>         gallium \
>> +        gallium-llvm \
>>         ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>         ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>> gles gbm virgl', '', d)} \
>>         ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>> @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>> -Ddri3=disabled, xorgproto libxshmfence"
>>
>>  # Vulkan drivers need dri3 enabled
>>  # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>> -VULKAN_DRIVERS = ""
>> +VULKAN_DRIVERS = "swrast"
>>  VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>  VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>  VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>> 'freedreno', ',freedreno', '', d)}"
>>
>> Alex
>>
>> On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>  Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>
>>>  Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>  I think for software vulkan you need to pass in
>>>>  -Dvulkan-drivers=swrast when building mesa for the target.
>>>>
>>>>  Alex
>>>>
>>>>  On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>
>>>>>   I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>
>>>>>   Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>
>>>>>   I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>
>>>>>   I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>
>>>>>   What am I missing for Software Mode?
>>>>>
>>>>>   Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>
>>>>>>   I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>
>>>>>>   Have you tried the software Vulkan in the guest?
>>>>>>
>>>>>>   Alex
>>>>>>
>>>>>>   On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   I try to enable vulkan according to this tutorial
>>>>>>>
>>>>>>>   https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>
>>>>>>>   According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>
>>>>>>>
>>>>>>>   Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>   You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>
>>>>>>>>   Alex
>>>>>>>>
>>>>>>>>   On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>   Greetings,
>>>>>>>>>
>>>>>>>>>   I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>>
>>>>>>>>>   Regards
>>>>>>>>>   --
>>>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>> ________________________________
>>>>>>>>>   Links: You receive all messages sent to this group.
>>>>>>>>>   View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>>   Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>>   Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>>   Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>>> ________________________________
>>>>>>>
>>>>>>>
>>>>>>>  --
>>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>
>>>>>   --
>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28 11:37                 ` Alexander Kanavin
@ 2022-09-28 17:59                   ` PHIL
  2022-09-29 10:28                   ` PHIL
  1 sibling, 0 replies; 28+ messages in thread
From: PHIL @ 2022-09-28 17:59 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 5470 bytes --]

Tried building mesa on its own with the recipe changes. It fails with meson Error this is a bug and should be reported. 

Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>Try latest poky master?
>
>Alex
>
>On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>
>> Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>
>> Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> The following works for me. I get
>>>
>>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>
>>> --- a/meta/recipes-graphics/mesa/mesa.inc
>>> +++ b/meta/recipes-graphics/mesa/mesa.inc
>>> @@ -88,6 +88,7 @@ def strip_comma(s):
>>>
>>>  PACKAGECONFIG = " \
>>>         gallium \
>>> +        gallium-llvm \
>>>         ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>         ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>> gles gbm virgl', '', d)} \
>>>         ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>> @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>> -Ddri3=disabled, xorgproto libxshmfence"
>>>
>>>  # Vulkan drivers need dri3 enabled
>>>  # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>> -VULKAN_DRIVERS = ""
>>> +VULKAN_DRIVERS = "swrast"
>>>  VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>  VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>  VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>> 'freedreno', ',freedreno', '', d)}"
>>>
>>> Alex
>>>
>>> On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>
>>>>  Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>  I think for software vulkan you need to pass in
>>>>>  -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>
>>>>>  Alex
>>>>>
>>>>>  On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>   I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>
>>>>>>   Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>
>>>>>>   I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>
>>>>>>   I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>
>>>>>>   What am I missing for Software Mode?
>>>>>>
>>>>>>   Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>
>>>>>>>   Have you tried the software Vulkan in the guest?
>>>>>>>
>>>>>>>   Alex
>>>>>>>
>>>>>>>   On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>   I try to enable vulkan according to this tutorial
>>>>>>>>
>>>>>>>>   https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>>
>>>>>>>>   According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>>
>>>>>>>>
>>>>>>>>   Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>   You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>>
>>>>>>>>>   Alex
>>>>>>>>>
>>>>>>>>>   On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>   Greetings,
>>>>>>>>>>
>>>>>>>>>>   I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>>>
>>>>>>>>>>   Regards
>>>>>>>>>>   --
>>>>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>> ________________________________
>>>>>>>>>>   Links: You receive all messages sent to this group.
>>>>>>>>>>   View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>>>   Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>>>   Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>>>   Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>>>> ________________________________
>>>>>>>>
>>>>>>>>
>>>>>>>>  --
>>>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>
>>>>>>   --
>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 6924 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-28 11:37                 ` Alexander Kanavin
  2022-09-28 17:59                   ` PHIL
@ 2022-09-29 10:28                   ` PHIL
  2022-09-29 10:46                     ` Alexander Kanavin
  1 sibling, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-29 10:28 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 5758 bytes --]

Tried in a sifferent machine with wednesday poky master

Building mesa-native gives the error

cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file

Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>Try latest poky master?
>
>Alex
>
>On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>
>> Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>
>> Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> The following works for me. I get
>>>
>>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>> tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>
>>> --- a/meta/recipes-graphics/mesa/mesa.inc
>>> +++ b/meta/recipes-graphics/mesa/mesa.inc
>>> @@ -88,6 +88,7 @@ def strip_comma(s):
>>>
>>>  PACKAGECONFIG = " \
>>>         gallium \
>>> +        gallium-llvm \
>>>         ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>         ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>> gles gbm virgl', '', d)} \
>>>         ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>> @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>> -Ddri3=disabled, xorgproto libxshmfence"
>>>
>>>  # Vulkan drivers need dri3 enabled
>>>  # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>> -VULKAN_DRIVERS = ""
>>> +VULKAN_DRIVERS = "swrast"
>>>  VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>  VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>  VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>> 'freedreno', ',freedreno', '', d)}"
>>>
>>> Alex
>>>
>>> On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>
>>>>  Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>  I think for software vulkan you need to pass in
>>>>>  -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>
>>>>>  Alex
>>>>>
>>>>>  On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>   I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>
>>>>>>   Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>
>>>>>>   I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>
>>>>>>   I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>
>>>>>>   What am I missing for Software Mode?
>>>>>>
>>>>>>   Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>
>>>>>>>   Have you tried the software Vulkan in the guest?
>>>>>>>
>>>>>>>   Alex
>>>>>>>
>>>>>>>   On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>   I try to enable vulkan according to this tutorial
>>>>>>>>
>>>>>>>>   https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>>
>>>>>>>>   According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>>
>>>>>>>>
>>>>>>>>   Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>   You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>>
>>>>>>>>>   Alex
>>>>>>>>>
>>>>>>>>>   On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>   Greetings,
>>>>>>>>>>
>>>>>>>>>>   I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>>>
>>>>>>>>>>   Regards
>>>>>>>>>>   --
>>>>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>> ________________________________
>>>>>>>>>>   Links: You receive all messages sent to this group.
>>>>>>>>>>   View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>>>   Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>>>   Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>>>   Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>>>> ________________________________
>>>>>>>>
>>>>>>>>
>>>>>>>>  --
>>>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>
>>>>>>   --
>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 7220 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-29 10:28                   ` PHIL
@ 2022-09-29 10:46                     ` Alexander Kanavin
  2022-09-29 11:20                       ` Edgar Mobile
  2022-09-30 20:24                       ` Edgar Mobile
  0 siblings, 2 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-29 10:46 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 6278 bytes --]

You need to build mesa, not mesa-native. And please show exact changes you
made.

Alex

On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:

> Tried in a sifferent machine with wednesday poky master
>
> Building mesa-native gives the error
>
> cp:
> '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6'
> and
> '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6'
> are the same file
>
>
> Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <
> alex.kanavin@gmail.com>:
>>
>> Try latest poky master?
>>
>> Alex
>>
>> On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>
>>>
>>>  Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>
>>>  Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>>
>>>>  The following works for me. I get
>>>>
>>>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>
>>>>  --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>  +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>  @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>
>>>>   PACKAGECONFIG = " \
>>>>          gallium \
>>>>  +        gallium-llvm \
>>>>          ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>          ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>  gles gbm virgl', '', d)} \
>>>>          ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>  @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>  -Ddri3=disabled, xorgproto libxshmfence"
>>>>
>>>>   # Vulkan drivers need dri3 enabled
>>>>   # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>  -VULKAN_DRIVERS = ""
>>>>  +VULKAN_DRIVERS = "swrast"
>>>>   VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>   VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>   VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>  'freedreno', ',freedreno', '', d)}"
>>>>
>>>>  Alex
>>>>
>>>>  On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>>
>>>>>
>>>>>   Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>
>>>>>   Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>>
>>>>>>
>>>>>>   I think for software vulkan you need to pass in
>>>>>>   -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>>
>>>>>>   Alex
>>>>>>
>>>>>>   On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>    I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>>
>>>>>>>    Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>>
>>>>>>>    I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>>
>>>>>>>    I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>>
>>>>>>>    What am I missing for Software Mode?
>>>>>>>
>>>>>>>    Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>    I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>>
>>>>>>>>    Have you tried the software Vulkan in the guest?
>>>>>>>>
>>>>>>>>    Alex
>>>>>>>>
>>>>>>>>    On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>    I try to enable vulkan according to this tutorial
>>>>>>>>>
>>>>>>>>>    https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>>>
>>>>>>>>>    According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>    Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>    You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>>>
>>>>>>>>>>    Alex
>>>>>>>>>>
>>>>>>>>>>    On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>    Greetings,
>>>>>>>>>>>
>>>>>>>>>>>    I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>>>>
>>>>>>>>>>>    Regards
>>>>>>>>>>>    --
>>>>>>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>>> ------------------------------
>>>>>>>>>>>    Links: You receive all messages sent to this group.
>>>>>>>>>>>    View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>>>>    Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>>>>    Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>>>>    Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>>>>> ------------------------------
>>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>
>>>>>>>>>   --
>>>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>    --
>>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>
>>>>>
>>>>>   --
>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>

[-- Attachment #2: Type: text/html, Size: 9736 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-29 10:46                     ` Alexander Kanavin
@ 2022-09-29 11:20                       ` Edgar Mobile
  2022-09-30 20:24                       ` Edgar Mobile
  1 sibling, 0 replies; 28+ messages in thread
From: Edgar Mobile @ 2022-09-29 11:20 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 7807 bytes --]

diff --git a/meta/recipes-graphics/mesa/mesa.inc b/meta/recipes-graphics/mesa/mesa.inc
index 8a74e0a80a..ffa35a5ca7 100644
--- a/meta/recipes-graphics/mesa/mesa.inc
+++ b/meta/recipes-graphics/mesa/mesa.inc
@@ -88,6 +88,7 @@ def strip_comma(s):

 PACKAGECONFIG = " \
        gallium \
+       gallium-llvm \
        ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
        ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl gles gbm virgl', '', d)} \
        ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
@@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled, -Ddri3=disabled, xorgproto libxshmfence"

 # Vulkan drivers need dri3 enabled
 # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
-VULKAN_DRIVERS = ""
+VULKAN_DRIVERS = "swrast"
 VULKAN_DRIVERS:append:x86:class-target = ",intel"
 VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
 VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG', 'freedreno', ',freedreno', '', d)}"
diff --git a/meta/recipes-graphics/mesa/mesa_22.2.0.bb b/meta/recipes-graphics/mesa/mesa_22.2.0.bb
index 96e8aa38d6..81b1cd66fd 100644
--- a/meta/recipes-graphics/mesa/mesa_22.2.0.bb
+++ b/meta/recipes-graphics/mesa/mesa_22.2.0.bb
@@ -1,2 +1,6 @@
 require ${BPN}.inc

+
+EXTRA_OEMESON += "-Dvulkan-drivers=virtio-experimental"
+
+
diff --git a/meta/recipes-graphics/virglrenderer/virglrenderer_0.10.3.bb b/meta/recipes-graphics/virglrenderer/virglrenderer_0.10.3.bb
index 3480eb954d..9760d86cf9 100644
--- a/meta/recipes-graphics/virglrenderer/virglrenderer_0.10.3.bb
+++ b/meta/recipes-graphics/virglrenderer/virglrenderer_0.10.3.bb
@@ -31,3 +31,5 @@ PACKAGECONFIG[tests] = "-Dtests=true,-Dtests=false,libcheck"
 BBCLASSEXTEND = "native nativesdk"

 REQUIRED_DISTRO_FEATURES = "opengl"
+
+EXTRA_OEMESON += "-Dvenus-experimental=true"
/media/user/SSD1TB/yoctoqemu/poky master✭✱ ❯

________________________________
From: Alexander Kanavin <alex.kanavin@gmail.com>
Sent: Thursday, September 29, 2022 10:46 AM
To: PHIL <heideggm@hotmail.com>
Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
Subject: Re: [yocto] Changing git url of qemu

You need to build mesa, not mesa-native. And please show exact changes you made.

Alex

On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:
Tried in a sifferent machine with wednesday poky master

Building mesa-native gives the error

cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file


Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:

Try latest poky master?

Alex

On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:

 Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.

 Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:

 The following works for me. I get

 tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
 tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so

 --- a/meta/recipes-graphics/mesa/mesa.inc
 +++ b/meta/recipes-graphics/mesa/mesa.inc
 @@ -88,6 +88,7 @@ def strip_comma(s):

  PACKAGECONFIG = " \
         gallium \
 +        gallium-llvm \
         ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
         ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
 gles gbm virgl', '', d)} \
         ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
 @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
 -Ddri3=disabled, xorgproto libxshmfence"

  # Vulkan drivers need dri3 enabled
  # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
 -VULKAN_DRIVERS = ""
 +VULKAN_DRIVERS = "swrast"
  VULKAN_DRIVERS:append:x86:class-target = ",intel"
  VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
  VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
 'freedreno', ',freedreno', '', d)}"

 Alex

 On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:


  Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?

  Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:


  I think for software vulkan you need to pass in
  -Dvulkan-drivers=swrast when building mesa for the target.

  Alex

  On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.

   Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.

   I also added virtio-experimental flag to mesa and virglrenderer meson recipes.

   I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.

   What am I missing for Software Mode?

   Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:



   I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.

   Have you tried the software Vulkan in the guest?

   Alex

   On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   I try to enable vulkan according to this tutorial

   https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/

   According to the author the modified qemu branch is still necessary so I want to enable that.


   Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:



   You need to clarify what you want to do exactly. Why can’t you use the existing recipe?

   Alex

   On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   Greetings,

   I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?

   Regards
   --
   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
________________________________
   Links: You receive all messages sent to this group.
   View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
   Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
   Group Owner: yocto+owner@lists.yoctoproject.org<mailto:yocto%2Bowner@lists.yoctoproject.org>
   Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>]
________________________________


  --
  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.



   --
   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


  --
  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

 --
 Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

--
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 19441 bytes --]

^ permalink raw reply related	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-29 10:46                     ` Alexander Kanavin
  2022-09-29 11:20                       ` Edgar Mobile
@ 2022-09-30 20:24                       ` Edgar Mobile
  2022-09-30 20:39                         ` Alexander Kanavin
  1 sibling, 1 reply; 28+ messages in thread
From: Edgar Mobile @ 2022-09-30 20:24 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 6124 bytes --]

I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.

________________________________
From: Alexander Kanavin <alex.kanavin@gmail.com>
Sent: Thursday, September 29, 2022 10:46 AM
To: PHIL <heideggm@hotmail.com>
Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
Subject: Re: [yocto] Changing git url of qemu

You need to build mesa, not mesa-native. And please show exact changes you made.

Alex

On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:
Tried in a sifferent machine with wednesday poky master

Building mesa-native gives the error

cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file


Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:

Try latest poky master?

Alex

On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:

 Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.

 Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:

 The following works for me. I get

 tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
 tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so

 --- a/meta/recipes-graphics/mesa/mesa.inc
 +++ b/meta/recipes-graphics/mesa/mesa.inc
 @@ -88,6 +88,7 @@ def strip_comma(s):

  PACKAGECONFIG = " \
         gallium \
 +        gallium-llvm \
         ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
         ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
 gles gbm virgl', '', d)} \
         ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
 @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
 -Ddri3=disabled, xorgproto libxshmfence"

  # Vulkan drivers need dri3 enabled
  # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
 -VULKAN_DRIVERS = ""
 +VULKAN_DRIVERS = "swrast"
  VULKAN_DRIVERS:append:x86:class-target = ",intel"
  VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
  VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
 'freedreno', ',freedreno', '', d)}"

 Alex

 On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:


  Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?

  Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:


  I think for software vulkan you need to pass in
  -Dvulkan-drivers=swrast when building mesa for the target.

  Alex

  On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.

   Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.

   I also added virtio-experimental flag to mesa and virglrenderer meson recipes.

   I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.

   What am I missing for Software Mode?

   Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:



   I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.

   Have you tried the software Vulkan in the guest?

   Alex

   On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   I try to enable vulkan according to this tutorial

   https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/

   According to the author the modified qemu branch is still necessary so I want to enable that.


   Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>>:



   You need to clarify what you want to do exactly. Why can’t you use the existing recipe?

   Alex

   On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com<mailto:heideggm@hotmail.com>> wrote:



   Greetings,

   I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?

   Regards
   --
   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
________________________________
   Links: You receive all messages sent to this group.
   View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
   Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
   Group Owner: yocto+owner@lists.yoctoproject.org<mailto:yocto%2Bowner@lists.yoctoproject.org>
   Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com<mailto:alex.kanavin@gmail.com>]
________________________________


  --
  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.



   --
   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


  --
  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

 --
 Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

--
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 11299 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:24                       ` Edgar Mobile
@ 2022-09-30 20:39                         ` Alexander Kanavin
  2022-09-30 20:50                           ` PHIL
  2022-09-30 20:54                           ` PHIL
  0 siblings, 2 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-30 20:39 UTC (permalink / raw)
  To: Edgar Mobile; +Cc: Yocto-mailing-list

You might want to try enabling gallium-llvm only for the target mesa:

PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'

Alex

On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>
> I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
> After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>
> ________________________________
> From: Alexander Kanavin <alex.kanavin@gmail.com>
> Sent: Thursday, September 29, 2022 10:46 AM
> To: PHIL <heideggm@hotmail.com>
> Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
> Subject: Re: [yocto] Changing git url of qemu
>
> You need to build mesa, not mesa-native. And please show exact changes you made.
>
> Alex
>
> On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>
> Tried in a sifferent machine with wednesday poky master
>
> Building mesa-native gives the error
>
> cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>
>
> Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>
> Try latest poky master?
>
> Alex
>
> On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>
>
>  Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>
>  Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>
>
>  The following works for me. I get
>
>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>
>  --- a/meta/recipes-graphics/mesa/mesa.inc
>  +++ b/meta/recipes-graphics/mesa/mesa.inc
>  @@ -88,6 +88,7 @@ def strip_comma(s):
>
>   PACKAGECONFIG = " \
>          gallium \
>  +        gallium-llvm \
>          ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>          ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>  gles gbm virgl', '', d)} \
>          ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>  @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>  -Ddri3=disabled, xorgproto libxshmfence"
>
>   # Vulkan drivers need dri3 enabled
>   # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>  -VULKAN_DRIVERS = ""
>  +VULKAN_DRIVERS = "swrast"
>   VULKAN_DRIVERS:append:x86:class-target = ",intel"
>   VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>   VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>  'freedreno', ',freedreno', '', d)}"
>
>  Alex
>
>  On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>
>
>
>   Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>
>   Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>
>
>
>   I think for software vulkan you need to pass in
>   -Dvulkan-drivers=swrast when building mesa for the target.
>
>   Alex
>
>   On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>
>
>
>
>    I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>
>    Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>
>    I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>
>    I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>
>    What am I missing for Software Mode?
>
>    Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>
>
>
>
>    I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>
>    Have you tried the software Vulkan in the guest?
>
>    Alex
>
>    On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>
>
>
>
>    I try to enable vulkan according to this tutorial
>
>    https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>
>    According to the author the modified qemu branch is still necessary so I want to enable that.
>
>
>    Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>
>
>
>
>    You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>
>    Alex
>
>    On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>
>
>
>
>    Greetings,
>
>    I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>
>    Regards
>    --
>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
> ________________________________
>    Links: You receive all messages sent to this group.
>    View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>    Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>    Group Owner: yocto+owner@lists.yoctoproject.org
>    Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
> ________________________________
>
>
>
>   --
>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
>
>
>
>    --
>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
>
>
>   --
>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
>
>  --
>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:39                         ` Alexander Kanavin
@ 2022-09-30 20:50                           ` PHIL
  2022-09-30 20:53                             ` Alexander Kanavin
  2022-09-30 20:54                           ` PHIL
  1 sibling, 1 reply; 28+ messages in thread
From: PHIL @ 2022-09-30 20:50 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 6616 bytes --]

X86-64 is right or do you mean arm?

Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>You might want to try enabling gallium-llvm only for the target mesa:
>
>PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>
>Alex
>
>On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>
>> I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>> After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>
>> ________________________________
>> From: Alexander Kanavin <alex.kanavin@gmail.com>
>> Sent: Thursday, September 29, 2022 10:46 AM
>> To: PHIL <heideggm@hotmail.com>
>> Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>> Subject: Re: [yocto] Changing git url of qemu
>>
>> You need to build mesa, not mesa-native. And please show exact changes you made.
>>
>> Alex
>>
>> On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>
>> Tried in a sifferent machine with wednesday poky master
>>
>> Building mesa-native gives the error
>>
>> cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>
>>
>> Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> Try latest poky master?
>>
>> Alex
>>
>> On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>  Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>
>>  Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>  The following works for me. I get
>>
>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>
>>  --- a/meta/recipes-graphics/mesa/mesa.inc
>>  +++ b/meta/recipes-graphics/mesa/mesa.inc
>>  @@ -88,6 +88,7 @@ def strip_comma(s):
>>
>>   PACKAGECONFIG = " \
>>          gallium \
>>  +        gallium-llvm \
>>          ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>          ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>  gles gbm virgl', '', d)} \
>>          ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>  @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>  -Ddri3=disabled, xorgproto libxshmfence"
>>
>>   # Vulkan drivers need dri3 enabled
>>   # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>  -VULKAN_DRIVERS = ""
>>  +VULKAN_DRIVERS = "swrast"
>>   VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>   VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>   VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>  'freedreno', ',freedreno', '', d)}"
>>
>>  Alex
>>
>>  On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>   Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>
>>   Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>   I think for software vulkan you need to pass in
>>   -Dvulkan-drivers=swrast when building mesa for the target.
>>
>>   Alex
>>
>>   On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>
>>    Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>
>>    I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>
>>    I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>
>>    What am I missing for Software Mode?
>>
>>    Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>
>>    I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>
>>    Have you tried the software Vulkan in the guest?
>>
>>    Alex
>>
>>    On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    I try to enable vulkan according to this tutorial
>>
>>    https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>
>>    According to the author the modified qemu branch is still necessary so I want to enable that.
>>
>>
>>    Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>
>>    You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>
>>    Alex
>>
>>    On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    Greetings,
>>
>>    I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>
>>    Regards
>>    --
>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>> ________________________________
>>    Links: You receive all messages sent to this group.
>>    View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>    Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>    Group Owner: yocto+owner@lists.yoctoproject.org
>>    Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>> ________________________________
>>
>>
>>
>>   --
>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>
>>
>>    --
>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>
>>   --
>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>  --
>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 7501 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:50                           ` PHIL
@ 2022-09-30 20:53                             ` Alexander Kanavin
  2022-09-30 20:57                               ` PHIL
                                                 ` (2 more replies)
  0 siblings, 3 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-09-30 20:53 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

That depends on what is your target. If you're running qemu on a x86
host, it's better to not do software emulation and build for
qemux86_64 as well, and then run qemu with kvm, so it executes
directly on the host CPU.

Alex

On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>
> X86-64 is right or do you mean arm?
>
> Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> You might want to try enabling gallium-llvm only for the target mesa:
>>
>> PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>
>> Alex
>>
>> On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>
>>>
>>>  I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>  After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>> ________________________________
>>>  From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>  Sent: Thursday, September 29, 2022 10:46 AM
>>>  To: PHIL <heideggm@hotmail.com>
>>>  Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>  Subject: Re: [yocto] Changing git url of qemu
>>>
>>>  You need to build mesa, not mesa-native. And please show exact changes you made.
>>>
>>>  Alex
>>>
>>>  On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>  Tried in a sifferent machine with wednesday poky master
>>>
>>>  Building mesa-native gives the error
>>>
>>>  cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>
>>>
>>>  Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>  Try latest poky master?
>>>
>>>  Alex
>>>
>>>  On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>   Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>
>>>   Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>
>>>   The following works for me. I get
>>>
>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>
>>>   --- a/meta/recipes-graphics/mesa/mesa.inc
>>>   +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>   @@ -88,6 +88,7 @@ def strip_comma(s):
>>>
>>>    PACKAGECONFIG = " \
>>>           gallium \
>>>   +        gallium-llvm \
>>>           ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>   gles gbm virgl', '', d)} \
>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>   @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>   -Ddri3=disabled, xorgproto libxshmfence"
>>>
>>>    # Vulkan drivers need dri3 enabled
>>>    # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>   -VULKAN_DRIVERS = ""
>>>   +VULKAN_DRIVERS = "swrast"
>>>    VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>    VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>    VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>   'freedreno', ',freedreno', '', d)}"
>>>
>>>   Alex
>>>
>>>   On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>
>>>    Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>
>>>    Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>
>>>
>>>    I think for software vulkan you need to pass in
>>>    -Dvulkan-drivers=swrast when building mesa for the target.
>>>
>>>    Alex
>>>
>>>    On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>
>>>
>>>     I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>
>>>     Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>
>>>     I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>
>>>     I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>
>>>     What am I missing for Software Mode?
>>>
>>>     Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>
>>>
>>>
>>>     I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>
>>>     Have you tried the software Vulkan in the guest?
>>>
>>>     Alex
>>>
>>>     On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>
>>>
>>>     I try to enable vulkan according to this tutorial
>>>
>>>     https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>
>>>     According to the author the modified qemu branch is still necessary so I want to enable that.
>>>
>>>
>>>     Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>
>>>
>>>
>>>     You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>
>>>     Alex
>>>
>>>     On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>
>>>
>>>
>>>
>>>     Greetings,
>>>
>>>     I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>
>>>     Regards
>>>     --
>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>> ________________________________
>>>     Links: You receive all messages sent to this group.
>>>     View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>     Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>     Group Owner: yocto+owner@lists.yoctoproject.org
>>>     Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>> ________________________________
>>>    --
>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>
>>>
>>>     --
>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>
>>>    --
>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>   --
>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:39                         ` Alexander Kanavin
  2022-09-30 20:50                           ` PHIL
@ 2022-09-30 20:54                           ` PHIL
  1 sibling, 0 replies; 28+ messages in thread
From: PHIL @ 2022-09-30 20:54 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 6653 bytes --]

I added your line to mesa.inc now it complains over llvm disabled again.

Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>You might want to try enabling gallium-llvm only for the target mesa:
>
>PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>
>Alex
>
>On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>
>> I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>> After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>
>> ________________________________
>> From: Alexander Kanavin <alex.kanavin@gmail.com>
>> Sent: Thursday, September 29, 2022 10:46 AM
>> To: PHIL <heideggm@hotmail.com>
>> Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>> Subject: Re: [yocto] Changing git url of qemu
>>
>> You need to build mesa, not mesa-native. And please show exact changes you made.
>>
>> Alex
>>
>> On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>
>> Tried in a sifferent machine with wednesday poky master
>>
>> Building mesa-native gives the error
>>
>> cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>
>>
>> Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> Try latest poky master?
>>
>> Alex
>>
>> On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>  Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>
>>  Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>  The following works for me. I get
>>
>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>  tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>
>>  --- a/meta/recipes-graphics/mesa/mesa.inc
>>  +++ b/meta/recipes-graphics/mesa/mesa.inc
>>  @@ -88,6 +88,7 @@ def strip_comma(s):
>>
>>   PACKAGECONFIG = " \
>>          gallium \
>>  +        gallium-llvm \
>>          ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>          ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>  gles gbm virgl', '', d)} \
>>          ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>  @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>  -Ddri3=disabled, xorgproto libxshmfence"
>>
>>   # Vulkan drivers need dri3 enabled
>>   # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>  -VULKAN_DRIVERS = ""
>>  +VULKAN_DRIVERS = "swrast"
>>   VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>   VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>   VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>  'freedreno', ',freedreno', '', d)}"
>>
>>  Alex
>>
>>  On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>   Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>
>>   Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>   I think for software vulkan you need to pass in
>>   -Dvulkan-drivers=swrast when building mesa for the target.
>>
>>   Alex
>>
>>   On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>
>>    Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>
>>    I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>
>>    I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>
>>    What am I missing for Software Mode?
>>
>>    Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>
>>    I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>
>>    Have you tried the software Vulkan in the guest?
>>
>>    Alex
>>
>>    On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    I try to enable vulkan according to this tutorial
>>
>>    https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>
>>    According to the author the modified qemu branch is still necessary so I want to enable that.
>>
>>
>>    Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>>
>>
>>
>>    You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>
>>    Alex
>>
>>    On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>
>>
>>
>>
>>    Greetings,
>>
>>    I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>
>>    Regards
>>    --
>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>> ________________________________
>>    Links: You receive all messages sent to this group.
>>    View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>    Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>    Group Owner: yocto+owner@lists.yoctoproject.org
>>    Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>> ________________________________
>>
>>
>>
>>   --
>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>
>>
>>    --
>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>
>>   --
>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>>
>>  --
>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 7538 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:53                             ` Alexander Kanavin
@ 2022-09-30 20:57                               ` PHIL
  2022-09-30 22:23                               ` PHIL
  2022-10-09 22:29                               ` PHIL
  2 siblings, 0 replies; 28+ messages in thread
From: PHIL @ 2022-09-30 20:57 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 7597 bytes --]

Host is x86-64 ubuntu, guest is aarch64 yocto.

Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>That depends on what is your target. If you're running qemu on a x86
>host, it's better to not do software emulation and build for
>qemux86_64 as well, and then run qemu with kvm, so it executes
>directly on the host CPU.
>
>Alex
>
>On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>
>> X86-64 is right or do you mean arm?
>>
>> Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> You might want to try enabling gallium-llvm only for the target mesa:
>>>
>>> PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>
>>> Alex
>>>
>>> On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>  After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>> ________________________________
>>>>  From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>  Sent: Thursday, September 29, 2022 10:46 AM
>>>>  To: PHIL <heideggm@hotmail.com>
>>>>  Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>  Subject: Re: [yocto] Changing git url of qemu
>>>>
>>>>  You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>
>>>>  Alex
>>>>
>>>>  On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>  Tried in a sifferent machine with wednesday poky master
>>>>
>>>>  Building mesa-native gives the error
>>>>
>>>>  cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>
>>>>
>>>>  Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>  Try latest poky master?
>>>>
>>>>  Alex
>>>>
>>>>  On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>   Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>
>>>>   Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>   The following works for me. I get
>>>>
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>
>>>>   --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>   +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>   @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>
>>>>    PACKAGECONFIG = " \
>>>>           gallium \
>>>>   +        gallium-llvm \
>>>>           ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>   gles gbm virgl', '', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>   @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>   -Ddri3=disabled, xorgproto libxshmfence"
>>>>
>>>>    # Vulkan drivers need dri3 enabled
>>>>    # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>   -VULKAN_DRIVERS = ""
>>>>   +VULKAN_DRIVERS = "swrast"
>>>>    VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>   'freedreno', ',freedreno', '', d)}"
>>>>
>>>>   Alex
>>>>
>>>>   On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>    Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>
>>>>    Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>    I think for software vulkan you need to pass in
>>>>    -Dvulkan-drivers=swrast when building mesa for the target.
>>>>
>>>>    Alex
>>>>
>>>>    On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>
>>>>     Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>
>>>>     I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>
>>>>     I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>
>>>>     What am I missing for Software Mode?
>>>>
>>>>     Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>
>>>>     Have you tried the software Vulkan in the guest?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I try to enable vulkan according to this tutorial
>>>>
>>>>     https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>
>>>>     According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>
>>>>
>>>>     Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     Greetings,
>>>>
>>>>     I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>
>>>>     Regards
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>> ________________________________
>>>>     Links: You receive all messages sent to this group.
>>>>     View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>     Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>     Group Owner: yocto+owner@lists.yoctoproject.org
>>>>     Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>> ________________________________
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>   --
>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 8427 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:53                             ` Alexander Kanavin
  2022-09-30 20:57                               ` PHIL
@ 2022-09-30 22:23                               ` PHIL
  2022-10-09 22:29                               ` PHIL
  2 siblings, 0 replies; 28+ messages in thread
From: PHIL @ 2022-09-30 22:23 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 7728 bytes --]

Tried

PACKAGECONFIG:append:aarch64:pn-mesa = ' gallium-llvm


It goes pretty far, but then we get back to:

../mesa-22.2.0/meson.build:1782:2: Unhandled python exception

Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>That depends on what is your target. If you're running qemu on a x86
>host, it's better to not do software emulation and build for
>qemux86_64 as well, and then run qemu with kvm, so it executes
>directly on the host CPU.
>
>Alex
>
>On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>
>> X86-64 is right or do you mean arm?
>>
>> Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> You might want to try enabling gallium-llvm only for the target mesa:
>>>
>>> PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>
>>> Alex
>>>
>>> On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>  After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>> ________________________________
>>>>  From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>  Sent: Thursday, September 29, 2022 10:46 AM
>>>>  To: PHIL <heideggm@hotmail.com>
>>>>  Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>  Subject: Re: [yocto] Changing git url of qemu
>>>>
>>>>  You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>
>>>>  Alex
>>>>
>>>>  On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>  Tried in a sifferent machine with wednesday poky master
>>>>
>>>>  Building mesa-native gives the error
>>>>
>>>>  cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>
>>>>
>>>>  Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>  Try latest poky master?
>>>>
>>>>  Alex
>>>>
>>>>  On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>   Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>
>>>>   Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>   The following works for me. I get
>>>>
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>
>>>>   --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>   +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>   @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>
>>>>    PACKAGECONFIG = " \
>>>>           gallium \
>>>>   +        gallium-llvm \
>>>>           ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>   gles gbm virgl', '', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>   @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>   -Ddri3=disabled, xorgproto libxshmfence"
>>>>
>>>>    # Vulkan drivers need dri3 enabled
>>>>    # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>   -VULKAN_DRIVERS = ""
>>>>   +VULKAN_DRIVERS = "swrast"
>>>>    VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>   'freedreno', ',freedreno', '', d)}"
>>>>
>>>>   Alex
>>>>
>>>>   On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>    Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>
>>>>    Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>    I think for software vulkan you need to pass in
>>>>    -Dvulkan-drivers=swrast when building mesa for the target.
>>>>
>>>>    Alex
>>>>
>>>>    On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>
>>>>     Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>
>>>>     I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>
>>>>     I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>
>>>>     What am I missing for Software Mode?
>>>>
>>>>     Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>
>>>>     Have you tried the software Vulkan in the guest?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I try to enable vulkan according to this tutorial
>>>>
>>>>     https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>
>>>>     According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>
>>>>
>>>>     Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     Greetings,
>>>>
>>>>     I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>
>>>>     Regards
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>> ________________________________
>>>>     Links: You receive all messages sent to this group.
>>>>     View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>     Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>     Group Owner: yocto+owner@lists.yoctoproject.org
>>>>     Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>> ________________________________
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>   --
>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 8572 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-09-30 20:53                             ` Alexander Kanavin
  2022-09-30 20:57                               ` PHIL
  2022-09-30 22:23                               ` PHIL
@ 2022-10-09 22:29                               ` PHIL
  2022-10-10  3:55                                 ` Alexander Kanavin
  2 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-10-09 22:29 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 7566 bytes --]

Any more ideas?

Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>That depends on what is your target. If you're running qemu on a x86
>host, it's better to not do software emulation and build for
>qemux86_64 as well, and then run qemu with kvm, so it executes
>directly on the host CPU.
>
>Alex
>
>On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>
>> X86-64 is right or do you mean arm?
>>
>> Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> You might want to try enabling gallium-llvm only for the target mesa:
>>>
>>> PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>
>>> Alex
>>>
>>> On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>  I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>  After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>> ________________________________
>>>>  From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>  Sent: Thursday, September 29, 2022 10:46 AM
>>>>  To: PHIL <heideggm@hotmail.com>
>>>>  Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>  Subject: Re: [yocto] Changing git url of qemu
>>>>
>>>>  You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>
>>>>  Alex
>>>>
>>>>  On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>  Tried in a sifferent machine with wednesday poky master
>>>>
>>>>  Building mesa-native gives the error
>>>>
>>>>  cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>
>>>>
>>>>  Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>  Try latest poky master?
>>>>
>>>>  Alex
>>>>
>>>>  On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>   Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>
>>>>   Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>   The following works for me. I get
>>>>
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>   tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>
>>>>   --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>   +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>   @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>
>>>>    PACKAGECONFIG = " \
>>>>           gallium \
>>>>   +        gallium-llvm \
>>>>           ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>   gles gbm virgl', '', d)} \
>>>>           ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>   @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>   -Ddri3=disabled, xorgproto libxshmfence"
>>>>
>>>>    # Vulkan drivers need dri3 enabled
>>>>    # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>   -VULKAN_DRIVERS = ""
>>>>   +VULKAN_DRIVERS = "swrast"
>>>>    VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>    VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>   'freedreno', ',freedreno', '', d)}"
>>>>
>>>>   Alex
>>>>
>>>>   On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>    Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>
>>>>    Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>    I think for software vulkan you need to pass in
>>>>    -Dvulkan-drivers=swrast when building mesa for the target.
>>>>
>>>>    Alex
>>>>
>>>>    On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>
>>>>     Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>
>>>>     I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>
>>>>     I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>
>>>>     What am I missing for Software Mode?
>>>>
>>>>     Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>
>>>>     Have you tried the software Vulkan in the guest?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     I try to enable vulkan according to this tutorial
>>>>
>>>>     https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>
>>>>     According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>
>>>>
>>>>     Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>
>>>>
>>>>     You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>
>>>>     Alex
>>>>
>>>>     On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>     Greetings,
>>>>
>>>>     I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>
>>>>     Regards
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>> ________________________________
>>>>     Links: You receive all messages sent to this group.
>>>>     View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>     Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>     Group Owner: yocto+owner@lists.yoctoproject.org
>>>>     Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>> ________________________________
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>
>>>>     --
>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>
>>>>    --
>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>
>>>>   --
>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 8396 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-10-09 22:29                               ` PHIL
@ 2022-10-10  3:55                                 ` Alexander Kanavin
  2022-10-10  7:49                                   ` PHIL
  0 siblings, 1 reply; 28+ messages in thread
From: Alexander Kanavin @ 2022-10-10  3:55 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 8474 bytes --]

It works for me. If it does not work for you, you need to show the full
content of your local modifications and full content of error messages, and
precise revisions of all of the layers and poky. And keep in mind it’s
volunteer help and no one is obliged to carry you to a solution, especially
when you have not introduced yourself and your goal properly. It’s far
easier to just stop answering.

Otherwise, commercial support is available. From my company (linutronix) as
well.

Alex

On Mon 10. Oct 2022 at 0.29, PHIL <heideggm@hotmail.com> wrote:

> Any more ideas?
>
>
> Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <
> alex.kanavin@gmail.com>:
>>
>> That depends on what is your target. If you're running qemu on a x86
>> host, it's better to not do software emulation and build for
>> qemux86_64 as well, and then run qemu with kvm, so it executes
>> directly on the host CPU.
>>
>> Alex
>>
>> On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>
>>>
>>>  X86-64 is right or do you mean arm?
>>>
>>>  Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>>>
>>>>  You might want to try enabling gallium-llvm only for the target mesa:
>>>>
>>>>  PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>>
>>>>  Alex
>>>>
>>>>  On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>
>>>>>
>>>>>
>>>>>   I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>>   After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>>> ------------------------------
>>>>>   From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>>   Sent: Thursday, September 29, 2022 10:46 AM
>>>>>   To: PHIL <heideggm@hotmail.com>
>>>>>   Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>>   Subject: Re: [yocto] Changing git url of qemu
>>>>>
>>>>>   You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>>
>>>>>   Alex
>>>>>
>>>>>   On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>   Tried in a sifferent machine with wednesday poky master
>>>>>
>>>>>   Building mesa-native gives the error
>>>>>
>>>>>   cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>>
>>>>>
>>>>>   Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>   Try latest poky master?
>>>>>
>>>>>   Alex
>>>>>
>>>>>   On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>    Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>>
>>>>>    Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>    The following works for me. I get
>>>>>
>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>>
>>>>>    --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>>    +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>>    @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>>
>>>>>     PACKAGECONFIG = " \
>>>>>            gallium \
>>>>>    +        gallium-llvm \
>>>>>            ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>>    gles gbm virgl', '', d)} \
>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>>    @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>>    -Ddri3=disabled, xorgproto libxshmfence"
>>>>>
>>>>>     # Vulkan drivers need dri3 enabled
>>>>>     # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>>    -VULKAN_DRIVERS = ""
>>>>>    +VULKAN_DRIVERS = "swrast"
>>>>>     VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>>     VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>>     VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>>    'freedreno', ',freedreno', '', d)}"
>>>>>
>>>>>    Alex
>>>>>
>>>>>    On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>
>>>>>     Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>
>>>>>     Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>
>>>>>     I think for software vulkan you need to pass in
>>>>>     -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>
>>>>>     Alex
>>>>>
>>>>>     On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>
>>>>>      Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>
>>>>>      I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>
>>>>>      I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>
>>>>>      What am I missing for Software Mode?
>>>>>
>>>>>      Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>
>>>>>      Have you tried the software Vulkan in the guest?
>>>>>
>>>>>      Alex
>>>>>
>>>>>      On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      I try to enable vulkan according to this tutorial
>>>>>
>>>>>      https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>
>>>>>      According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>
>>>>>
>>>>>      Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>
>>>>>      Alex
>>>>>
>>>>>      On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      Greetings,
>>>>>
>>>>>      I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>
>>>>>      Regards
>>>>>      --
>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>> ------------------------------
>>>>>      Links: You receive all messages sent to this group.
>>>>>      View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>      Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>      Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>      Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>> ------------------------------
>>>>>     --
>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>      --
>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>
>>>>>     --
>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>    --
>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>   --
>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>

[-- Attachment #2: Type: text/html, Size: 11715 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-10-10  3:55                                 ` Alexander Kanavin
@ 2022-10-10  7:49                                   ` PHIL
  2022-10-10 13:04                                     ` Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-10-10  7:49 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list


[-- Attachment #1.1: Type: text/plain, Size: 9313 bytes --]

Sorry for being strenuous! I just really want to get this going and I've ran out of ideas. All I can do at the moment is to express my gratitude dor the time you've already invested.

I've gathered some data that hopefully has everything you need. This includes:

Poky Commit
My local recipe diff
Poky.conf
Output from bitbake layers and recipe
Output from bitbake core-image-weston

I can provide more if you give me the command!

Regards

Am 10. Oktober 2022 05:55:35 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>It works for me. If it does not work for you, you need to show the full
>content of your local modifications and full content of error messages, and
>precise revisions of all of the layers and poky. And keep in mind it’s
>volunteer help and no one is obliged to carry you to a solution, especially
>when you have not introduced yourself and your goal properly. It’s far
>easier to just stop answering.
>
>Otherwise, commercial support is available. From my company (linutronix) as
>well.
>
>Alex
>
>On Mon 10. Oct 2022 at 0.29, PHIL <heideggm@hotmail.com> wrote:
>
>> Any more ideas?
>>
>>
>> Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <
>> alex.kanavin@gmail.com>:
>>>
>>> That depends on what is your target. If you're running qemu on a x86
>>> host, it's better to not do software emulation and build for
>>> qemux86_64 as well, and then run qemu with kvm, so it executes
>>> directly on the host CPU.
>>>
>>> Alex
>>>
>>> On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>>
>>>>  X86-64 is right or do you mean arm?
>>>>
>>>>  Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>>
>>>>>  You might want to try enabling gallium-llvm only for the target mesa:
>>>>>
>>>>>  PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>>>
>>>>>  Alex
>>>>>
>>>>>  On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>
>>>>>>
>>>>>>
>>>>>>   I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>>>   After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>>>> ------------------------------
>>>>>>   From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>>>   Sent: Thursday, September 29, 2022 10:46 AM
>>>>>>   To: PHIL <heideggm@hotmail.com>
>>>>>>   Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>>>   Subject: Re: [yocto] Changing git url of qemu
>>>>>>
>>>>>>   You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>>>
>>>>>>   Alex
>>>>>>
>>>>>>   On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>   Tried in a sifferent machine with wednesday poky master
>>>>>>
>>>>>>   Building mesa-native gives the error
>>>>>>
>>>>>>   cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>>>
>>>>>>
>>>>>>   Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>   Try latest poky master?
>>>>>>
>>>>>>   Alex
>>>>>>
>>>>>>   On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>    Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>>>
>>>>>>    Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>    The following works for me. I get
>>>>>>
>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>>>
>>>>>>    --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>>>    +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>>>    @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>>>
>>>>>>     PACKAGECONFIG = " \
>>>>>>            gallium \
>>>>>>    +        gallium-llvm \
>>>>>>            ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>>>    gles gbm virgl', '', d)} \
>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>>>    @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>>>    -Ddri3=disabled, xorgproto libxshmfence"
>>>>>>
>>>>>>     # Vulkan drivers need dri3 enabled
>>>>>>     # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>>>    -VULKAN_DRIVERS = ""
>>>>>>    +VULKAN_DRIVERS = "swrast"
>>>>>>     VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>>>     VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>>>     VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>>>    'freedreno', ',freedreno', '', d)}"
>>>>>>
>>>>>>    Alex
>>>>>>
>>>>>>    On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>     Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>>
>>>>>>     Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>
>>>>>>     I think for software vulkan you need to pass in
>>>>>>     -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>>
>>>>>>     Alex
>>>>>>
>>>>>>     On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>
>>>>>>      Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>
>>>>>>      I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>
>>>>>>      I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>
>>>>>>      What am I missing for Software Mode?
>>>>>>
>>>>>>      Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>
>>>>>>      Have you tried the software Vulkan in the guest?
>>>>>>
>>>>>>      Alex
>>>>>>
>>>>>>      On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      I try to enable vulkan according to this tutorial
>>>>>>
>>>>>>      https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>
>>>>>>      According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>
>>>>>>
>>>>>>      Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>
>>>>>>      Alex
>>>>>>
>>>>>>      On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      Greetings,
>>>>>>
>>>>>>      I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>
>>>>>>      Regards
>>>>>>      --
>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>> ------------------------------
>>>>>>      Links: You receive all messages sent to this group.
>>>>>>      View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>      Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>      Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>      Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>> ------------------------------
>>>>>>     --
>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>      --
>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>
>>>>>>     --
>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>    --
>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>   --
>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>
>>>>  --
>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #1.2: Type: text/html, Size: 12574 bytes --]

[-- Attachment #2: yoctoproblem.zip --]
[-- Type: application/zip, Size: 16612 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-10-10  7:49                                   ` PHIL
@ 2022-10-10 13:04                                     ` Alexander Kanavin
  2022-10-10 13:23                                       ` PHIL
  0 siblings, 1 reply; 28+ messages in thread
From: Alexander Kanavin @ 2022-10-10 13:04 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

You still have not introduced yourself.

I  have reproduced; the key difference is that you are building for
qemuarm64. This does seem like a bug somewhere, but you can work
around it if you build for qemux86-64 - you should do this anyway
because otherwise the performance of the software renderer and
everything else in qemu (without kvm) will be appalling.

Alex

On Mon, 10 Oct 2022 at 09:49, PHIL <heideggm@hotmail.com> wrote:
>
> Sorry for being strenuous! I just really want to get this going and I've ran out of ideas. All I can do at the moment is to express my gratitude dor the time you've already invested.
>
> I've gathered some data that hopefully has everything you need. This includes:
>
> Poky Commit
> My local recipe diff
> Poky.conf
> Output from bitbake layers and recipe
> Output from bitbake core-image-weston
>
> I can provide more if you give me the command!
>
> Regards
>
> Am 10. Oktober 2022 05:55:35 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> It works for me. If it does not work for you, you need to show the full content of your local modifications and full content of error messages, and precise revisions of all of the layers and poky. And keep in mind it’s volunteer help and no one is obliged to carry you to a solution, especially when you have not introduced yourself and your goal properly. It’s far easier to just stop answering.
>>
>> Otherwise, commercial support is available. From my company (linutronix) as well.
>>
>> Alex
>>
>> On Mon 10. Oct 2022 at 0.29, PHIL <heideggm@hotmail.com> wrote:
>>>
>>> Any more ideas?
>>>
>>>
>>> Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>> That depends on what is your target. If you're running qemu on a x86
>>>> host, it's better to not do software emulation and build for
>>>> qemux86_64 as well, and then run qemu with kvm, so it executes
>>>> directly on the host CPU.
>>>>
>>>> Alex
>>>>
>>>> On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>  X86-64 is right or do you mean arm?
>>>>>
>>>>>  Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>  You might want to try enabling gallium-llvm only for the target mesa:
>>>>>>
>>>>>>  PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>>>>
>>>>>>  Alex
>>>>>>
>>>>>>  On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>>>>   After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>>>>> ________________________________
>>>>>>>   From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>>>>   Sent: Thursday, September 29, 2022 10:46 AM
>>>>>>>   To: PHIL <heideggm@hotmail.com>
>>>>>>>   Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>>>>   Subject: Re: [yocto] Changing git url of qemu
>>>>>>>
>>>>>>>   You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>>>>
>>>>>>>   Alex
>>>>>>>
>>>>>>>   On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>   Tried in a sifferent machine with wednesday poky master
>>>>>>>
>>>>>>>   Building mesa-native gives the error
>>>>>>>
>>>>>>>   cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>>>>
>>>>>>>
>>>>>>>   Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>   Try latest poky master?
>>>>>>>
>>>>>>>   Alex
>>>>>>>
>>>>>>>   On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>    Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>>>>
>>>>>>>    Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>    The following works for me. I get
>>>>>>>
>>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>>>>
>>>>>>>    --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>    +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>    @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>>>>
>>>>>>>     PACKAGECONFIG = " \
>>>>>>>            gallium \
>>>>>>>    +        gallium-llvm \
>>>>>>>            ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>>>>    gles gbm virgl', '', d)} \
>>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>>>>    @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>>>>    -Ddri3=disabled, xorgproto libxshmfence"
>>>>>>>
>>>>>>>     # Vulkan drivers need dri3 enabled
>>>>>>>     # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>>>>    -VULKAN_DRIVERS = ""
>>>>>>>    +VULKAN_DRIVERS = "swrast"
>>>>>>>     VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>>>>     VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>>>>     VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>>>>    'freedreno', ',freedreno', '', d)}"
>>>>>>>
>>>>>>>    Alex
>>>>>>>
>>>>>>>    On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>     Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>>>
>>>>>>>     Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>     I think for software vulkan you need to pass in
>>>>>>>     -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>>>
>>>>>>>     Alex
>>>>>>>
>>>>>>>     On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>>
>>>>>>>      Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>>
>>>>>>>      I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>>
>>>>>>>      I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>>
>>>>>>>      What am I missing for Software Mode?
>>>>>>>
>>>>>>>      Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>
>>>>>>>      Have you tried the software Vulkan in the guest?
>>>>>>>
>>>>>>>      Alex
>>>>>>>
>>>>>>>      On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      I try to enable vulkan according to this tutorial
>>>>>>>
>>>>>>>      https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>
>>>>>>>      According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>
>>>>>>>
>>>>>>>      Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>
>>>>>>>      Alex
>>>>>>>
>>>>>>>      On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      Greetings,
>>>>>>>
>>>>>>>      I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>
>>>>>>>      Regards
>>>>>>>      --
>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>> ________________________________
>>>>>>>      Links: You receive all messages sent to this group.
>>>>>>>      View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>      Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>      Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>      Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>> ________________________________
>>>>>>>     --
>>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>      --
>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>     --
>>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>>
>>>>>>>    --
>>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>>   --
>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>  --
>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>> --
>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-10-10 13:04                                     ` Alexander Kanavin
@ 2022-10-10 13:23                                       ` PHIL
  2022-10-10 13:33                                         ` Alexander Kanavin
  0 siblings, 1 reply; 28+ messages in thread
From: PHIL @ 2022-10-10 13:23 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: Yocto-mailing-list

[-- Attachment #1: Type: text/plain, Size: 10633 bytes --]

I have an OpenGLES 3.1 based app for Weston that runs on Aarch64 Linux. I can start it sucessfully in emulated Poky. Now I port this app to Vulkan so I need an Aarch64-Vulkan-Weston test suite. 

If that is the info you wanted.

Am 10. Oktober 2022 15:04:18 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>You still have not introduced yourself.
>
>I  have reproduced; the key difference is that you are building for
>qemuarm64. This does seem like a bug somewhere, but you can work
>around it if you build for qemux86-64 - you should do this anyway
>because otherwise the performance of the software renderer and
>everything else in qemu (without kvm) will be appalling.
>
>Alex
>
>On Mon, 10 Oct 2022 at 09:49, PHIL <heideggm@hotmail.com> wrote:
>>
>> Sorry for being strenuous! I just really want to get this going and I've ran out of ideas. All I can do at the moment is to express my gratitude dor the time you've already invested.
>>
>> I've gathered some data that hopefully has everything you need. This includes:
>>
>> Poky Commit
>> My local recipe diff
>> Poky.conf
>> Output from bitbake layers and recipe
>> Output from bitbake core-image-weston
>>
>> I can provide more if you give me the command!
>>
>> Regards
>>
>> Am 10. Oktober 2022 05:55:35 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>
>>> It works for me. If it does not work for you, you need to show the full content of your local modifications and full content of error messages, and precise revisions of all of the layers and poky. And keep in mind it’s volunteer help and no one is obliged to carry you to a solution, especially when you have not introduced yourself and your goal properly. It’s far easier to just stop answering.
>>>
>>> Otherwise, commercial support is available. From my company (linutronix) as well.
>>>
>>> Alex
>>>
>>> On Mon 10. Oct 2022 at 0.29, PHIL <heideggm@hotmail.com> wrote:
>>>>
>>>> Any more ideas?
>>>>
>>>>
>>>> Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>
>>>>> That depends on what is your target. If you're running qemu on a x86
>>>>> host, it's better to not do software emulation and build for
>>>>> qemux86_64 as well, and then run qemu with kvm, so it executes
>>>>> directly on the host CPU.
>>>>>
>>>>> Alex
>>>>>
>>>>> On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>>>>>
>>>>>>
>>>>>>  X86-64 is right or do you mean arm?
>>>>>>
>>>>>>  Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>
>>>>>>>
>>>>>>>  You might want to try enabling gallium-llvm only for the target mesa:
>>>>>>>
>>>>>>>  PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>>>>>
>>>>>>>  Alex
>>>>>>>
>>>>>>>  On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>   I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>>>>>   After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>>>>>> ________________________________
>>>>>>>>   From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>>>>>   Sent: Thursday, September 29, 2022 10:46 AM
>>>>>>>>   To: PHIL <heideggm@hotmail.com>
>>>>>>>>   Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>>>>>   Subject: Re: [yocto] Changing git url of qemu
>>>>>>>>
>>>>>>>>   You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>>>>>
>>>>>>>>   Alex
>>>>>>>>
>>>>>>>>   On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>   Tried in a sifferent machine with wednesday poky master
>>>>>>>>
>>>>>>>>   Building mesa-native gives the error
>>>>>>>>
>>>>>>>>   cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>>>>>
>>>>>>>>
>>>>>>>>   Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>   Try latest poky master?
>>>>>>>>
>>>>>>>>   Alex
>>>>>>>>
>>>>>>>>   On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>    Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>>>>>
>>>>>>>>    Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>    The following works for me. I get
>>>>>>>>
>>>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>>>>>    tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>>>>>
>>>>>>>>    --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>>    +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>>    @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>>>>>
>>>>>>>>     PACKAGECONFIG = " \
>>>>>>>>            gallium \
>>>>>>>>    +        gallium-llvm \
>>>>>>>>            ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>>>>>    gles gbm virgl', '', d)} \
>>>>>>>>            ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>>>>>    @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>>>>>    -Ddri3=disabled, xorgproto libxshmfence"
>>>>>>>>
>>>>>>>>     # Vulkan drivers need dri3 enabled
>>>>>>>>     # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>>>>>    -VULKAN_DRIVERS = ""
>>>>>>>>    +VULKAN_DRIVERS = "swrast"
>>>>>>>>     VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>>>>>     VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>>>>>     VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>>>>>    'freedreno', ',freedreno', '', d)}"
>>>>>>>>
>>>>>>>>    Alex
>>>>>>>>
>>>>>>>>    On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>     Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>>>>
>>>>>>>>     Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>     I think for software vulkan you need to pass in
>>>>>>>>     -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>>>>
>>>>>>>>     Alex
>>>>>>>>
>>>>>>>>     On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>>>
>>>>>>>>      Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>>>
>>>>>>>>      I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>>>
>>>>>>>>      I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>>>
>>>>>>>>      What am I missing for Software Mode?
>>>>>>>>
>>>>>>>>      Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>>
>>>>>>>>      Have you tried the software Vulkan in the guest?
>>>>>>>>
>>>>>>>>      Alex
>>>>>>>>
>>>>>>>>      On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      I try to enable vulkan according to this tutorial
>>>>>>>>
>>>>>>>>      https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>>
>>>>>>>>      According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>>
>>>>>>>>
>>>>>>>>      Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>
>>>>>>>>      Alex
>>>>>>>>
>>>>>>>>      On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      Greetings,
>>>>>>>>
>>>>>>>>      I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>
>>>>>>>>      Regards
>>>>>>>>      --
>>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>> ________________________________
>>>>>>>>      Links: You receive all messages sent to this group.
>>>>>>>>      View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>      Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>      Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>      Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>> ________________________________
>>>>>>>>     --
>>>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>      --
>>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>     --
>>>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>
>>>>>>>>
>>>>>>>>    --
>>>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>
>>>>>>>>   --
>>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>
>>>>>>
>>>>>>  --
>>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>
>>>> --
>>>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>
>> --
>> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.

[-- Attachment #2: Type: text/html, Size: 11206 bytes --]

^ permalink raw reply	[flat|nested] 28+ messages in thread
* Re: [yocto] Changing git url of qemu
  2022-10-10 13:23                                       ` PHIL
@ 2022-10-10 13:33                                         ` Alexander Kanavin
  0 siblings, 0 replies; 28+ messages in thread
From: Alexander Kanavin @ 2022-10-10 13:33 UTC (permalink / raw)
  To: PHIL; +Cc: Yocto-mailing-list

Not really: I wanted to see your real name, the name of your company,
or your customer, and some kind of description or link to the product.

Since you are porting the app to vulkan, you have the source code, and
so do not have to build it for aarch64, at least initially. Keep in
mind the performance too.

Alex

On Mon, 10 Oct 2022 at 15:23, PHIL <heideggm@hotmail.com> wrote:
>
> I have an OpenGLES 3.1 based app for Weston that runs on Aarch64 Linux. I can start it sucessfully in emulated Poky. Now I port this app to Vulkan so I need an Aarch64-Vulkan-Weston test suite.
>
> If that is the info you wanted.
>
> Am 10. Oktober 2022 15:04:18 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>
>> You still have not introduced yourself.
>>
>> I  have reproduced; the key difference is that you are building for
>> qemuarm64. This does seem like a bug somewhere, but you can work
>> around it if you build for qemux86-64 - you should do this anyway
>> because otherwise the performance of the software renderer and
>> everything else in qemu (without kvm) will be appalling.
>>
>> Alex
>>
>> On Mon, 10 Oct 2022 at 09:49, PHIL <heideggm@hotmail.com> wrote:
>>>
>>>
>>>  Sorry for being strenuous! I just really want to get this going and I've ran out of ideas. All I can do at the moment is to express my gratitude dor the time you've already invested.
>>>
>>>  I've gathered some data that hopefully has everything you need. This includes:
>>>
>>>  Poky Commit
>>>  My local recipe diff
>>>  Poky.conf
>>>  Output from bitbake layers and recipe
>>>  Output from bitbake core-image-weston
>>>
>>>  I can provide more if you give me the command!
>>>
>>>  Regards
>>>
>>>  Am 10. Oktober 2022 05:55:35 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>
>>>>
>>>>  It works for me. If it does not work for you, you need to show the full content of your local modifications and full content of error messages, and precise revisions of all of the layers and poky. And keep in mind it’s volunteer help and no one is obliged to carry you to a solution, especially when you have not introduced yourself and your goal properly. It’s far easier to just stop answering.
>>>>
>>>>  Otherwise, commercial support is available. From my company (linutronix) as well.
>>>>
>>>>  Alex
>>>>
>>>>  On Mon 10. Oct 2022 at 0.29, PHIL <heideggm@hotmail.com> wrote:
>>>>>
>>>>>
>>>>>  Any more ideas?
>>>>>
>>>>>
>>>>>  Am 30. September 2022 22:53:22 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>
>>>>>>
>>>>>>  That depends on what is your target. If you're running qemu on a x86
>>>>>>  host, it's better to not do software emulation and build for
>>>>>>  qemux86_64 as well, and then run qemu with kvm, so it executes
>>>>>>  directly on the host CPU.
>>>>>>
>>>>>>  Alex
>>>>>>
>>>>>>  On Fri, 30 Sept 2022 at 22:50, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   X86-64 is right or do you mean arm?
>>>>>>>
>>>>>>>   Am 30. September 2022 22:39:44 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>   You might want to try enabling gallium-llvm only for the target mesa:
>>>>>>>>
>>>>>>>>   PACKAGECONFIG:append:x86-64:pn-mesa = ' gallium-llvm'
>>>>>>>>
>>>>>>>>   Alex
>>>>>>>>
>>>>>>>>   On Fri, 30 Sept 2022 at 22:24, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>    I deleted the whole build directory, recreated it, only added the arm switch in local conf and your changes for mesa.inc.
>>>>>>>>>    After a few hours of building core-image-weston it again complains that it tries to copy llcm-config14.0.6 over itself. I don't know what to do anymore.
>>>>>>>>> ________________________________
>>>>>>>>>    From: Alexander Kanavin <alex.kanavin@gmail.com>
>>>>>>>>>    Sent: Thursday, September 29, 2022 10:46 AM
>>>>>>>>>    To: PHIL <heideggm@hotmail.com>
>>>>>>>>>    Cc: Yocto-mailing-list <yocto@lists.yoctoproject.org>
>>>>>>>>>    Subject: Re: [yocto] Changing git url of qemu
>>>>>>>>>
>>>>>>>>>    You need to build mesa, not mesa-native. And please show exact changes you made.
>>>>>>>>>
>>>>>>>>>    Alex
>>>>>>>>>
>>>>>>>>>    On Thu 29. Sep 2022 at 12.28, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>    Tried in a sifferent machine with wednesday poky master
>>>>>>>>>
>>>>>>>>>    Building mesa-native gives the error
>>>>>>>>>
>>>>>>>>>    cp: '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' and '/media/user/SSD1TB/yoctoqemu/poky/build-virgl/tmp/work/x86_64-linux/mesa-native/2_22.2.0-r0/recipe-sysroot-native/usr/bin/llvm-config14.0.6' are the same file
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>    Am 28. September 2022 13:37:05 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>    Try latest poky master?
>>>>>>>>>
>>>>>>>>>    Alex
>>>>>>>>>
>>>>>>>>>    On Wed, 28 Sept 2022 at 13:23, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>     Mesa build fails. It complains that it copies llvm-config14.0.6 to the same file.
>>>>>>>>>
>>>>>>>>>     Am 28. September 2022 12:48:04 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>     The following works for me. I get
>>>>>>>>>
>>>>>>>>>     tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_intel.so
>>>>>>>>>     tmp/work/core2-64-poky-linux/mesa/2_22.2.0-r0/packages-split/mesa-vulkan-drivers/usr/lib/libvulkan_lvp.so
>>>>>>>>>
>>>>>>>>>     --- a/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>>>     +++ b/meta/recipes-graphics/mesa/mesa.inc
>>>>>>>>>     @@ -88,6 +88,7 @@ def strip_comma(s):
>>>>>>>>>
>>>>>>>>>      PACKAGECONFIG = " \
>>>>>>>>>             gallium \
>>>>>>>>>     +        gallium-llvm \
>>>>>>>>>             ${@bb.utils.filter('DISTRO_FEATURES', 'x11 vulkan wayland', d)} \
>>>>>>>>>             ${@bb.utils.contains('DISTRO_FEATURES', 'opengl', 'opengl egl
>>>>>>>>>     gles gbm virgl', '', d)} \
>>>>>>>>>             ${@bb.utils.contains('DISTRO_FEATURES', 'x11 opengl', 'dri3', '', d)} \
>>>>>>>>>     @@ -108,7 +109,7 @@ PACKAGECONFIG[dri3] = "-Ddri3=enabled,
>>>>>>>>>     -Ddri3=disabled, xorgproto libxshmfence"
>>>>>>>>>
>>>>>>>>>      # Vulkan drivers need dri3 enabled
>>>>>>>>>      # amd could be enabled as well but requires gallium-llvm with llvm >= 3.9
>>>>>>>>>     -VULKAN_DRIVERS = ""
>>>>>>>>>     +VULKAN_DRIVERS = "swrast"
>>>>>>>>>      VULKAN_DRIVERS:append:x86:class-target = ",intel"
>>>>>>>>>      VULKAN_DRIVERS:append:x86-64:class-target = ",intel"
>>>>>>>>>      VULKAN_DRIVERS:append ="${@bb.utils.contains('PACKAGECONFIG',
>>>>>>>>>     'freedreno', ',freedreno', '', d)}"
>>>>>>>>>
>>>>>>>>>     Alex
>>>>>>>>>
>>>>>>>>>     On Wed, 28 Sept 2022 at 11:49, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>      Also vulkan-drivers is empty in meson generated by bitbake. If I add it manually it will complain that llvm is disabled. How would I enable it?
>>>>>>>>>
>>>>>>>>>      Am 28. September 2022 10:51:26 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>      I think for software vulkan you need to pass in
>>>>>>>>>      -Dvulkan-drivers=swrast when building mesa for the target.
>>>>>>>>>
>>>>>>>>>      Alex
>>>>>>>>>
>>>>>>>>>      On Wed, 28 Sept 2022 at 10:44, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       I asked the author so I assume he would have told me. Apparently the virglrenderer branch is obsolete.
>>>>>>>>>
>>>>>>>>>       Currently my only changes from poky master are adding vulkan opengl x11 to distro features and vulkan-samples vulkan-loader vulkan-tools virglrenderer to core image extra install in local.conf.
>>>>>>>>>
>>>>>>>>>       I also added virtio-experimental flag to mesa and virglrenderer meson recipes.
>>>>>>>>>
>>>>>>>>>       I still get ERROR_INCOMPATIBLE_DRIVER when running vulkaninfo.
>>>>>>>>>
>>>>>>>>>       What am I missing for Software Mode?
>>>>>>>>>
>>>>>>>>>       Am 28. September 2022 10:29:28 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       I would first check whether any of that work in the branch has meanwhile landed upstream. The post is from 2021.
>>>>>>>>>
>>>>>>>>>       Have you tried the software Vulkan in the guest?
>>>>>>>>>
>>>>>>>>>       Alex
>>>>>>>>>
>>>>>>>>>       On Wed 28. Sep 2022 at 10.21, PHIL <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       I try to enable vulkan according to this tutorial
>>>>>>>>>
>>>>>>>>>       https://www.collabora.com/news-and-blog/blog/2021/11/26/venus-on-qemu-enabling-new-virtual-vulkan-driver/
>>>>>>>>>
>>>>>>>>>       According to the author the modified qemu branch is still necessary so I want to enable that.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       Am 28. September 2022 10:14:24 MESZ schrieb Alexander Kanavin <alex.kanavin@gmail.com>:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       You need to clarify what you want to do exactly. Why can’t you use the existing recipe?
>>>>>>>>>
>>>>>>>>>       Alex
>>>>>>>>>
>>>>>>>>>       On Wed 28. Sep 2022 at 9.58, Edgar Mobile <heideggm@hotmail.com> wrote:
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       Greetings,
>>>>>>>>>
>>>>>>>>>       I want to change the git repo url in order to test the Venus driver. Can someone tell me which variable in which recipe I'd have to set?
>>>>>>>>>
>>>>>>>>>       Regards
>>>>>>>>>       --
>>>>>>>>>       Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>> ________________________________
>>>>>>>>>       Links: You receive all messages sent to this group.
>>>>>>>>>       View/Reply Online (#58196): https://lists.yoctoproject.org/g/yocto/message/58196
>>>>>>>>>       Mute This Topic: https://lists.yoctoproject.org/mt/93968127/1686489
>>>>>>>>>       Group Owner: yocto+owner@lists.yoctoproject.org
>>>>>>>>>       Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
>>>>>>>>> ________________________________
>>>>>>>>>      --
>>>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>       --
>>>>>>>>>       Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>      --
>>>>>>>>>      Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>     --
>>>>>>>>>     Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>>>
>>>>>>>>>    --
>>>>>>>>>    Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>   --
>>>>>>>   Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>>>
>>>>>
>>>>>  --
>>>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>>>
>>>
>>>  --
>>>  Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
>
> --
> Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.


^ permalink raw reply	[flat|nested] 28+ messages in thread
end of thread, other threads:[~2022-10-10 13:34 UTC | newest]

Thread overview: 28+ messages (download: mbox.gz / follow: Atom feed)
-- links below jump to the message on this page --
2022-09-28  7:58 Changing git url of qemu PHIL
2022-09-28  8:14 ` [yocto] " Alexander Kanavin
2022-09-28  8:21   ` PHIL
2022-09-28  8:29     ` Alexander Kanavin
2022-09-28  8:44       ` PHIL
2022-09-28  8:51         ` Alexander Kanavin
2022-09-28  9:26           ` PHIL
2022-09-28  9:49           ` PHIL
2022-09-28 10:48             ` Alexander Kanavin
2022-09-28 11:23               ` PHIL
2022-09-28 11:37                 ` Alexander Kanavin
2022-09-28 17:59                   ` PHIL
2022-09-29 10:28                   ` PHIL
2022-09-29 10:46                     ` Alexander Kanavin
2022-09-29 11:20                       ` Edgar Mobile
2022-09-30 20:24                       ` Edgar Mobile
2022-09-30 20:39                         ` Alexander Kanavin
2022-09-30 20:50                           ` PHIL
2022-09-30 20:53                             ` Alexander Kanavin
2022-09-30 20:57                               ` PHIL
2022-09-30 22:23                               ` PHIL
2022-10-09 22:29                               ` PHIL
2022-10-10  3:55                                 ` Alexander Kanavin
2022-10-10  7:49                                   ` PHIL
2022-10-10 13:04                                     ` Alexander Kanavin
2022-10-10 13:23                                       ` PHIL
2022-10-10 13:33                                         ` Alexander Kanavin
2022-09-30 20:54                           ` PHIL

