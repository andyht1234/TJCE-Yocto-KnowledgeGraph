[
    "* Http access token fetching with gitsm fetcher\n@ 2023-10-20 11:55 alexzoyv\n  2023-10-20 13:32 ` [yocto] \" Adrian Freihofer\n  0 siblings, 1 reply; 4+ messages in thread\nFrom: alexzoyv @ 2023-10-20 11:55 UTC (permalink / raw)\n  To: yocto\n\n\n[-- Attachment #1.1: Type: text/plain, Size: 543 bytes --]\n\nGreetings!\nI try to use gitsm fetcher to fetch bitbucket repository with read-only https access token. SRC_URI looks like this\n> \n> \n> SRC_URI =\n> \"gitsm://******.git;protocol=https;branch=${BRANCH};user=azoykin:${TOKEN}\"\n> \n> \n\nThis recipe fetches parent repository, but is unable to fetch submodule, writing fatal: could not read Username for 'https://tps-git.topcon.com': No such device or address in log.do_fetch\nIt happens because url is passed to fetcher function already with user string. I suggest a patch to fix this issue\n\n[-- Attachment #1.2: Type: text/html, Size: 605 bytes --]\n\n[-- Warning: decoded text below may be mangled, UTF-8 assumed --]\n[-- Attachment #2: gits.patch --]\n[-- Type: text/x-patch; name=\"gits.patch\", Size: 704 bytes --]\n\ndiff --git a/lib/bb/fetch2/gitsm.py b/lib/bb/fetch2/gitsm.py\nindex c5f7c03c..3a025624 100644\n--- a/lib/bb/fetch2/gitsm.py\n+++ b/lib/bb/fetch2/gitsm.py\n@@ -100,6 +100,10 @@ class GitSM(Git):\n                 # Properly formated URL already\n                 proto = uris[module].split(':', 1)[0]\n                 url = uris[module].replace('%s:' % proto, 'gitsm:', 1)\n+                # remove user+password from string to add them as parameter\n+                if ud.user in url:\n+                    url = url.replace(ud.user + '@', '')\n+                    url += \";user=%s\" % ud.user\n             else:\n                 if \":\" in uris[module]:\n                     # Most likely an SSH style reference\n\n^ permalink raw reply related\t[flat|nested] 4+ messages in thread",
    "* Re: [yocto] Http access token fetching with gitsm fetcher\n  2023-10-20 11:55 Http access token fetching with gitsm fetcher alexzoyv\n@ 2023-10-20 13:32 ` Adrian Freihofer\n  2023-10-20 13:43   ` Yoann CONGAL\n  0 siblings, 1 reply; 4+ messages in thread\nFrom: Adrian Freihofer @ 2023-10-20 13:32 UTC (permalink / raw)\n  To: alexzoyv; +Cc: Yocto-mailing-list\n\n[-- Attachment #1: Type: text/plain, Size: 1128 bytes --]\n\nDid you already consider to write the credentials in a  .netrc file?\n\nRegards\nAdrian\n\n<alexzoyv@gmail.com> schrieb am Fr., 20. Okt. 2023, 13:55:\n\n> Greetings!\n> I try to use gitsm fetcher to fetch bitbucket repository with read-only\n> https access token. SRC_URI looks like this\n>\n> SRC_URI =\n> \"gitsm://******.git;protocol=https;branch=${BRANCH};user=azoykin:${TOKEN}\"\n>\n> This recipe fetches parent repository, but is unable to fetch submodule,\n> writing *fatal: could not read Username for 'https://tps-git.topcon.com\n> <https://tps-git.topcon.com>': No such device or address *in log.do_fetch\n> It happens because url is passed to fetcher function already with user\n> string. I suggest a patch to fix this issue\n>\n>\n> -=-=-=-=-=-=-=-=-=-=-=-\n> Links: You receive all messages sent to this group.\n> View/Reply Online (#61430):\n> https://lists.yoctoproject.org/g/yocto/message/61430\n> Mute This Topic: https://lists.yoctoproject.org/mt/102079282/4454582\n> Group Owner: yocto+owner@lists.yoctoproject.org\n> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [\n> adrian.freihofer@gmail.com]\n> -=-=-=-=-=-=-=-=-=-=-=-\n>\n>\n\n[-- Attachment #2: Type: text/html, Size: 2088 bytes --]\n\n^ permalink raw reply\t[flat|nested] 4+ messages in thread",
    "* Re: [yocto] Http access token fetching with gitsm fetcher\n  2023-10-20 13:32 ` [yocto] \" Adrian Freihofer\n@ 2023-10-20 13:43   ` Yoann CONGAL\n  2023-10-20 14:32     ` alexzoyv\n  0 siblings, 1 reply; 4+ messages in thread\nFrom: Yoann CONGAL @ 2023-10-20 13:43 UTC (permalink / raw)\n  To: Adrian Freihofer; +Cc: alexzoyv, Yocto-mailing-list\n\nHi,\n\nLe ven. 20 oct. 2023 à 15:32, Adrian Freihofer\n<adrian.freihofer@gmail.com> a écrit :\n> Did you already consider to write the credentials in a  .netrc file?\n>\n> Regards\n> Adrian\n>\n> <alexzoyv@gmail.com> schrieb am Fr., 20. Okt. 2023, 13:55:\n>>\n>> Greetings!\n>> I try to use gitsm fetcher to fetch bitbucket repository with read-only https access token. SRC_URI looks like this\n>>\n>> SRC_URI = \"gitsm://******.git;protocol=https;branch=${BRANCH};user=azoykin:${TOKEN}\"\n>>\n>> This recipe fetches parent repository, but is unable to fetch submodule, writing fatal: could not read Username for 'https://tps-git.topcon.com': No such device or address in log.do_fetch\n>> It happens because url is passed to fetcher function already with user string. I suggest a patch to fix this issue\n\nI'm sorry but this is a known WONTFIX bug :\nhttps://bugzilla.yoctoproject.org/show_bug.cgi?id=13550\nSee : https://git.openembedded.org/bitbake/tree/lib/bb/fetch2/gitsm.py#n127\n\nThe only supported way to do this (that I know of) is to use .netrc as\nAdrian suggested.\n\nRegards,\n-- \nYoann Congal\nSmile ECS - Tech expert\n\n\n^ permalink raw reply\t[flat|nested] 4+ messages in thread",
    "* Re: Http access token fetching with gitsm fetcher\n  2023-10-20 13:43   ` Yoann CONGAL\n@ 2023-10-20 14:32     ` alexzoyv\n  0 siblings, 0 replies; 4+ messages in thread\nFrom: alexzoyv @ 2023-10-20 14:32 UTC (permalink / raw)\n  To: yocto\n\n[-- Attachment #1: Type: text/plain, Size: 1403 bytes --]\n\nAdrian, Yoann,\nThank you very much and sorry for bringing it up.\n.netrc does fix my problem.\nAlex\nOn Fri, Oct 20, 2023 at 04:43 PM, Yoann Congal wrote:\n\n> \n> Hi,\n> \n> Le ven. 20 oct. 2023 à 15:32, Adrian Freihofer\n> <adrian.freihofer@gmail.com> a écrit :\n> \n>> Did you already consider to write the credentials in a .netrc file?\n>> \n>> Regards\n>> Adrian\n>> \n>> <alexzoyv@gmail.com> schrieb am Fr., 20. Okt. 2023, 13:55:\n>> \n>>> \n>>> Greetings!\n>>> I try to use gitsm fetcher to fetch bitbucket repository with read-only\n>>> https access token. SRC_URI looks like this\n>>> \n>>> SRC_URI =\n>>> \"gitsm://******.git;protocol=https;branch=${BRANCH};user=azoykin:${TOKEN}\"\n>>> \n>>> \n>>> This recipe fetches parent repository, but is unable to fetch submodule,\n>>> writing fatal: could not read Username for ' https://tps-git.topcon.com' :\n>>> No such device or address in log.do_fetch\n>>> It happens because url is passed to fetcher function already with user\n>>> string. I suggest a patch to fix this issue\n>> \n>> \n> \n> I'm sorry but this is a known WONTFIX bug :\n> https://bugzilla.yoctoproject.org/show_bug.cgi?id=13550\n> See : https://git.openembedded.org/bitbake/tree/lib/bb/fetch2/gitsm.py#n127\n> \n> \n> The only supported way to do this (that I know of) is to use .netrc as\n> Adrian suggested.\n> \n> Regards,\n> --\n> Yoann Congal\n> Smile ECS - Tech expert\n\n[-- Attachment #2: Type: text/html, Size: 1782 bytes --]\n\n^ permalink raw reply\t[flat|nested] 4+ messages in thread",
    "end of thread, other threads:[~2023-10-20 14:32 UTC | newest]\n\nThread overview: 4+ messages (download: mbox.gz / follow: Atom feed)\n-- links below jump to the message on this page --\n2023-10-20 11:55 Http access token fetching with gitsm fetcher alexzoyv\n2023-10-20 13:32 ` [yocto] \" Adrian Freihofer\n2023-10-20 13:43   ` Yoann CONGAL\n2023-10-20 14:32     ` alexzoyv\n"
]