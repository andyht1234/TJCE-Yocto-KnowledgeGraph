[
    "* [meta-rockchip] [PATCH v3] rock-3a add\n@ 2023-10-16 10:43 anthony.t.davies\n  0 siblings, 0 replies; only message in thread\nFrom: anthony.t.davies @ 2023-10-16 10:43 UTC (permalink / raw)\n  To: yocto; +Cc: twoerner, Anthony Davies\n\nFrom: Anthony Davies <anthony.t.davies@gmail.com>\n\nAdd support for the Radxa Rock 3A\nhttps://wiki.radxa.com/Rock3/3a\n\nThe TF-A project does not currently have support for\nthe rk3568. Therefore, for the time-being, the only way to supply a\nTPL/DDR-init for the rk3568 is to use the closed-source rkbin binaries\nfrom Rockchip. If/when TF-A adds support for the rk3588 we can investigate\nswitching.\n\nrecipes-bsp/rkbin/rockchip-rkbin_git.bb was modified to allow a machine\noverride to allow both rk3568 and rk3588s to use differnet binary blobs\n\nSigned-off-by: Anthony Davies <anthony.t.davies@gmail.com>\n---\n README                                  |  1 +\n conf/machine/include/rk3568.inc         | 17 +++++++++++++++++\n conf/machine/rock-3a.conf               | 12 ++++++++++++\n recipes-bsp/rkbin/rockchip-rkbin_git.bb | 16 +++++++++++++++-\n recipes-bsp/u-boot/u-boot%.bbappend     |  5 +++++\n 5 files changed, 50 insertions(+), 1 deletion(-)\n create mode 100644 conf/machine/include/rk3568.inc\n create mode 100644 conf/machine/rock-3a.conf\n\ndiff --git a/README b/README\nindex 8104474..3357b47 100644\n--- a/README\n+++ b/README\n@@ -32,6 +32,7 @@ Status of supported boards:\n \t\tnanopi-r4s\n \t\trock-5b\n \t\tnanopi-r2s\n+    rock-3a\n \tbuilds:\n \t\tmarsboard-rk3066\n \t\tradxarock\ndiff --git a/conf/machine/include/rk3568.inc b/conf/machine/include/rk3568.inc\nnew file mode 100644\nindex 0000000..5382b58\n--- /dev/null\n+++ b/conf/machine/include/rk3568.inc\n@@ -0,0 +1,17 @@\n+MACHINEOVERRIDES =. \"rk3568:\"\n+DEFAULTTUNE ?= \"cortexa55\"\n+\n+require conf/machine/include/arm/armv8-2a/tune-cortexa55.inc\n+require conf/machine/include/rockchip-defaults.inc\n+require conf/machine/include/rockchip-wic.inc\n+\n+KBUILD_DEFCONFIG ?= \"defconfig\"\n+KERNEL_FEATURES:append:rk3568 = \" bsp/rockchip/remove-non-rockchip-arch-arm64.scc\"\n+KERNEL_CLASSES ??= \"kernel-fitimage\"\n+KERNEL_IMAGETYPE ??= \"fitImage\"\n+\n+PREFERRED_PROVIDER_trusted-firmware-a = \"rockchip-rkbin\"\n+PREFERRED_PROVIDER_optee-os = \"rockchip-rkbin\"\n+\n+UBOOT_SUFFIX ?= \"itb\"\n+UBOOT_ENTRYPOINT ?= \"0x06000000\"\ndiff --git a/conf/machine/rock-3a.conf b/conf/machine/rock-3a.conf\nnew file mode 100644\nindex 0000000..2ed83a3\n--- /dev/null\n+++ b/conf/machine/rock-3a.conf\n@@ -0,0 +1,12 @@\n+#@TYPE: Machine\n+#@NAME: Radxa Rock 3a\n+#@DESCRIPTION: ROCK3 is a series of Rockchip RK3566/RK3568 based\n+#SBC(Single Board Computer) and Compute Module by Radxa.\n+#https://wiki.radxa.com/Rock3\n+\n+require conf/machine/include/rk3568.inc\n+\n+KERNEL_DEVICETREE = \"rockchip/rk3568-rock-3a.dtb\"\n+MACHINE_EXTRA_RRECOMMENDS += \"kernel-modules\"\n+\n+UBOOT_MACHINE = \"rock-3a-rk3568_defconfig\"\ndiff --git a/recipes-bsp/rkbin/rockchip-rkbin_git.bb b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\nindex 7fefb01..ad5593c 100644\n--- a/recipes-bsp/rkbin/rockchip-rkbin_git.bb\n+++ b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\n@@ -14,6 +14,7 @@ S = \"${WORKDIR}/git\"\n \n COMPATIBLE_MACHINE = \"\"\n COMPATIBLE_MACHINE:rk3588s = \"rk3588s\"\n+COMPATIBLE_MACHINE:rk3568 = \"rk3568\"\n \n PACKAGE_ARCH = \"${MACHINE_ARCH}\"\n \n@@ -25,7 +26,16 @@ do_install() {\n PACKAGES = \"${PN}\"\n ALLOW_EMPTY:${PN} = \"1\"\n \n-do_deploy() {\n+do_deploy:rk3568() {\n+\t# Prebuilt TF-A\n+\tinstall -m 644 ${S}/bin/rk35/rk3568_bl31_v*.elf ${DEPLOYDIR}/bl31-rk3568.elf\n+\t# Prebuilt OPTEE-OS\n+\tinstall -m 644 ${S}/bin/rk35/rk3568_bl32_v*.bin ${DEPLOYDIR}/tee-rk3568.bin\n+\t# Prebuilt U-Boot TPL (DDR init)\n+\tinstall -m 644 ${S}/bin/rk35/rk3568_ddr_1560MHz_v1.18.bin ${DEPLOYDIR}/ddr-rk3568.bin\n+}\n+\n+do_deploy:rk3588s() {\n \t# Prebuilt TF-A\n \tinstall -m 644 ${S}/bin/rk35/rk3588_bl31_v*.elf ${DEPLOYDIR}/bl31-rk3588.elf\n \t# Prebuilt OPTEE-OS\n@@ -34,4 +44,8 @@ do_deploy() {\n \tinstall -m 644 ${S}/bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v*.bin ${DEPLOYDIR}/ddr-rk3588.bin\n }\n \n+do_deploy() {\n+  bbfatal \"COMPATIBLE_MACHINE requires a corressponding do_deploy:<MACHINE>() override\"\n+}\n+\n addtask deploy after do_install\ndiff --git a/recipes-bsp/u-boot/u-boot%.bbappend b/recipes-bsp/u-boot/u-boot%.bbappend\nindex e79c471..66c81da 100644\n--- a/recipes-bsp/u-boot/u-boot%.bbappend\n+++ b/recipes-bsp/u-boot/u-boot%.bbappend\n@@ -9,12 +9,17 @@ EXTRA_OEMAKE:append:rk3588s = \" \\\n \tBL31=${DEPLOY_DIR_IMAGE}/bl31-rk3588.elf \\\n \tROCKCHIP_TPL=${DEPLOY_DIR_IMAGE}/ddr-rk3588.bin \\\n \t\"\n+EXTRA_OEMAKE:append:rk3568 = \" \\\n+\tBL31=${DEPLOY_DIR_IMAGE}/bl31-rk3568.elf \\\n+\tROCKCHIP_TPL=${DEPLOY_DIR_IMAGE}/ddr-rk3568.bin \\\n+\t\"\n \n INIT_FIRMWARE_DEPENDS ??= \"\"\n INIT_FIRMWARE_DEPENDS:px30 = \" trusted-firmware-a:do_deploy\"\n INIT_FIRMWARE_DEPENDS:rk3328 = \" trusted-firmware-a:do_deploy\"\n INIT_FIRMWARE_DEPENDS:rk3399 = \" trusted-firmware-a:do_deploy\"\n INIT_FIRMWARE_DEPENDS:rk3588s = \" rockchip-rkbin:do_deploy\"\n+INIT_FIRMWARE_DEPENDS:rk3568 = \" rockchip-rkbin:do_deploy\"\n do_compile[depends] .= \"${INIT_FIRMWARE_DEPENDS}\"\n \n do_compile:append:rock2-square () {\n-- \n2.34.1\n\n\n\n^ permalink raw reply related\t[flat|nested] only message in thread",
    "only message in thread, other threads:[~2023-10-16 10:44 UTC | newest]\n\nThread overview: (only message) (download: mbox.gz / follow: Atom feed)\n-- links below jump to the message on this page --\n2023-10-16 10:43 [meta-rockchip] [PATCH v3] rock-3a add anthony.t.davies\n"
]