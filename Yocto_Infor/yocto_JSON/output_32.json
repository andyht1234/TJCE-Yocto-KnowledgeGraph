[
    "* [layerindex-web][PATCH 0/2] Allow per LayerBranch update disable\n@ 2023-10-17  0:54 Tim Orling\n  2023-10-17  0:54 ` [layerindex-web][PATCH 1/2] models.py: add updates_enabled to LayerBranch Tim Orling\n  2023-10-17  0:54 ` [layerindex-web][PATCH 2/2] update.py: skip unless layerbranch.updates_enabled Tim Orling\n  0 siblings, 2 replies; 3+ messages in thread\nFrom: Tim Orling @ 2023-10-17  0:54 UTC (permalink / raw)\n  To: yocto; +Cc: Tim Orling\n\nSome layers have branches which match the stable release branch names, but\nfail to update for some reason. Rather than completely disable updates for\na LayerItem, allow for a LayerBranch to have updates disabled.\n\nBefore this change, we only had the option to completely disable updates for\na layer (Change from \"Published\" to \"No Update\" state) or completely disable a\nBranch for all layers. These hammers are too heavy and needed a little nuance.\n\nTim Orling (2):\n  models.py: add updates_enabled to LayerBranch\n  update.py: skip unless layerbranch.updates_enabled\n\n .../0047_layerbranch_updates_enabled.py        | 18 ++++++++++++++++++\n layerindex/models.py                           |  2 +-\n layerindex/update.py                           |  5 +++++\n 3 files changed, 24 insertions(+), 1 deletion(-)\n create mode 100644 layerindex/migrations/0047_layerbranch_updates_enabled.py\n\n-- \n2.34.1\n\n\n\n^ permalink raw reply\t[flat|nested] 3+ messages in thread",
    "* [layerindex-web][PATCH 1/2] models.py: add updates_enabled to LayerBranch\n  2023-10-17  0:54 [layerindex-web][PATCH 0/2] Allow per LayerBranch update disable Tim Orling\n@ 2023-10-17  0:54 ` Tim Orling\n  2023-10-17  0:54 ` [layerindex-web][PATCH 2/2] update.py: skip unless layerbranch.updates_enabled Tim Orling\n  1 sibling, 0 replies; 3+ messages in thread\nFrom: Tim Orling @ 2023-10-17  0:54 UTC (permalink / raw)\n  To: yocto; +Cc: Tim Orling\n\nEspecially since LTS branches have become more popular as the\nonly active branch, we need to be able to turn off updates on\na LayerBranch basis rather than the current Layer or Branch\nheavier hammers.\n\nSigned-off-by: Tim Orling <tim.orling@konsulko.com>\n---\n .../0047_layerbranch_updates_enabled.py        | 18 ++++++++++++++++++\n layerindex/models.py                           |  2 +-\n 2 files changed, 19 insertions(+), 1 deletion(-)\n create mode 100644 layerindex/migrations/0047_layerbranch_updates_enabled.py\n\ndiff --git a/layerindex/migrations/0047_layerbranch_updates_enabled.py b/layerindex/migrations/0047_layerbranch_updates_enabled.py\nnew file mode 100644\nindex 0000000..44e07ee\n--- /dev/null\n+++ b/layerindex/migrations/0047_layerbranch_updates_enabled.py\n@@ -0,0 +1,18 @@\n+# Generated by Django 4.2.6 on 2023-10-07 19:39\n+\n+from django.db import migrations, models\n+\n+\n+class Migration(migrations.Migration):\n+\n+    dependencies = [\n+        ('layerindex', '0046_alter_patch_status'),\n+    ]\n+\n+    operations = [\n+        migrations.AddField(\n+            model_name='layerbranch',\n+            name='updates_enabled',\n+            field=models.BooleanField(default=True, help_text='Enable automatically updating layer metadata for this layer:branch via the update script', verbose_name='Enable updates'),\n+        ),\n+    ]\ndiff --git a/layerindex/models.py b/layerindex/models.py\nindex 5ae60c3..397425a 100644\n--- a/layerindex/models.py\n+++ b/layerindex/models.py\n@@ -241,7 +241,7 @@ class LayerBranch(models.Model):\n     actual_branch = models.CharField('Actual Branch', max_length=80, blank=True, help_text='Name of the actual branch in the repository matching the core branch')\n     yp_compatible_version = models.ForeignKey(YPCompatibleVersion, verbose_name='Yocto Project Compatible version', null=True, blank=True, on_delete=models.SET_NULL, help_text='Which version of the Yocto Project Compatible program has this layer been approved for for?')\n     local_path = models.CharField(max_length=255, blank=True, help_text='Local subdirectory where layer data can be found')\n-\n+    updates_enabled = models.BooleanField('Enable updates', default=True, help_text='Enable automatically updating layer metadata for this layer:branch via the update script')\n     updated = models.DateTimeField(auto_now=True)\n \n     class Meta:\n-- \n2.34.1\n\n\n\n^ permalink raw reply related\t[flat|nested] 3+ messages in thread",
    "* [layerindex-web][PATCH 2/2] update.py: skip unless layerbranch.updates_enabled\n  2023-10-17  0:54 [layerindex-web][PATCH 0/2] Allow per LayerBranch update disable Tim Orling\n  2023-10-17  0:54 ` [layerindex-web][PATCH 1/2] models.py: add updates_enabled to LayerBranch Tim Orling\n@ 2023-10-17  0:54 ` Tim Orling\n  1 sibling, 0 replies; 3+ messages in thread\nFrom: Tim Orling @ 2023-10-17  0:54 UTC (permalink / raw)\n  To: yocto; +Cc: Tim Orling\n\nIf layerbranch.updates_enabled is false, skip the update.\n\nSigned-off-by: Tim Orling <tim.orling@konsulko.com>\n---\n layerindex/update.py | 5 +++++\n 1 file changed, 5 insertions(+)\n\ndiff --git a/layerindex/update.py b/layerindex/update.py\nindex 7de9c0d..e7e5c63 100755\n--- a/layerindex/update.py\n+++ b/layerindex/update.py\n@@ -375,6 +375,11 @@ def main():\n                         if layerbranch_source:\n                             layerbranch.vcs_subdir = layerbranch_source.vcs_subdir\n \n+                    layerbranch_updates_enabled = LayerBranch.objects.filter(layer=layer, branch=branchobj.id, updates_enabled=True)\n+                    if not layerbranch_updates_enabled:\n+                        logger.info(\"Skipping update of layer %s  branch %s - updates disabled\" % (layer.name, branchname))\n+                        continue\n+\n                     # Collect repo info\n                     urldir = layer.get_fetch_dir()\n                     repodir = os.path.join(fetchdir, urldir)\n-- \n2.34.1\n\n\n\n^ permalink raw reply related\t[flat|nested] 3+ messages in thread",
    "end of thread, other threads:[~2023-10-17  0:55 UTC | newest]\n\nThread overview: 3+ messages (download: mbox.gz / follow: Atom feed)\n-- links below jump to the message on this page --\n2023-10-17  0:54 [layerindex-web][PATCH 0/2] Allow per LayerBranch update disable Tim Orling\n2023-10-17  0:54 ` [layerindex-web][PATCH 1/2] models.py: add updates_enabled to LayerBranch Tim Orling\n2023-10-17  0:54 ` [layerindex-web][PATCH 2/2] update.py: skip unless layerbranch.updates_enabled Tim Orling\n"
]