[
    "* [meta-rockchip][kirkstone][PATCH] rk3588(s): add\n@ 2023-10-05  9:00 Quentin Schulz\n  2023-10-05  9:30 ` Quentin Schulz\n  2023-10-13 16:15 ` [yocto] \" Trevor Woerner\n  0 siblings, 2 replies; 3+ messages in thread\nFrom: Quentin Schulz @ 2023-10-05  9:00 UTC (permalink / raw)\n  To: twoerner; +Cc: yocto, Quentin Schulz\n\nFrom: Trevor Woerner <twoerner@gmail.com>\n\nUnfortunately the TF-A project does not currently have support for\nthe rk3588. Therefore, for the time-being, the only way to supply a\nTPL/DDR-init for the rk3588 is to use the closed-source rkbin binaries\nfrom Rockchip. If/when TF-A adds support for the rk3588 we can investigate\nswitching.\n\nThe rk3588 comes in two variants: rk3588 and rk3588s. The \"s\" option is a\nstripped-down version of the rk3588. In the Linux kernel these two SoCs are\nkept separate, with the rk3588 building on the rk3588s, so we've mimicked that\nsame behaviour here.\n\nSigned-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\nSigned-off-by: Trevor Woerner <twoerner@gmail.com>\n[backported from f8af59dd7cd7 (\"rock-5b: add\")]\n[removed support for rock-5b since no decent linux-yocto support in kirkstone]\n[removed KERNEL_FEATURES and kmeta since no decent linux-yocto support in kirkstone]\n[renamed INIT_FIRMWARE_DEPENDS to ATF_DEPENDS]\n[tested on downstream board with downstream kernel and u-boot]\nSigned-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\n---\n conf/machine/include/rk3588.inc         |  6 ++++\n conf/machine/include/rk3588s.inc        | 16 +++++++++++\n recipes-bsp/rkbin/rockchip-rkbin_git.bb | 37 +++++++++++++++++++++++++\n recipes-bsp/u-boot/u-boot%.bbappend     |  6 ++++\n 4 files changed, 65 insertions(+)\n create mode 100644 conf/machine/include/rk3588.inc\n create mode 100644 conf/machine/include/rk3588s.inc\n create mode 100644 recipes-bsp/rkbin/rockchip-rkbin_git.bb\n\ndiff --git a/conf/machine/include/rk3588.inc b/conf/machine/include/rk3588.inc\nnew file mode 100644\nindex 0000000..34f0627\n--- /dev/null\n+++ b/conf/machine/include/rk3588.inc\n@@ -0,0 +1,6 @@\n+MACHINEOVERRIDES =. \"rk3588:\"\n+\n+# the rk3588s is a \"stripped-down\" version of the rk3588\n+# in the kernel's device-tree the rk3588 builds on top of the rk3588s\n+# so anything that is valid for the rk3588s is valid for the rk3588\n+require conf/machine/include/rk3588s.inc\ndiff --git a/conf/machine/include/rk3588s.inc b/conf/machine/include/rk3588s.inc\nnew file mode 100644\nindex 0000000..3da226e\n--- /dev/null\n+++ b/conf/machine/include/rk3588s.inc\n@@ -0,0 +1,16 @@\n+MACHINEOVERRIDES =. \"rk3588s:\"\n+DEFAULTTUNE ?= \"cortexa76-cortexa55-crypto\"\n+\n+require conf/machine/include/arm/armv8-2a/tune-cortexa76-cortexa55.inc\n+require conf/machine/include/rockchip-defaults.inc\n+require conf/machine/include/rockchip-wic.inc\n+\n+KBUILD_DEFCONFIG ?= \"defconfig\"\n+KERNEL_CLASSES = \"kernel-fitimage\"\n+KERNEL_IMAGETYPE = \"fitImage\"\n+\n+PREFERRED_PROVIDER_trusted-firmware-a = \"rockchip-rkbin\"\n+PREFERRED_PROVIDER_optee-os = \"rockchip-rkbin\"\n+\n+UBOOT_SUFFIX ?= \"itb\"\n+UBOOT_ENTRYPOINT ?= \"0x06000000\"\ndiff --git a/recipes-bsp/rkbin/rockchip-rkbin_git.bb b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\nnew file mode 100644\nindex 0000000..7fefb01\n--- /dev/null\n+++ b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\n@@ -0,0 +1,37 @@\n+DESCRIPTION = \"Rockchip Firmware and Tool Binaries\"\n+LICENSE = \"Proprietary\"\n+LIC_FILES_CHKSUM = \"file://LICENSE;md5=15faa4a01e7eb0f5d33f9f2bcc7bff62\"\n+\n+SRC_URI = \"git://github.com/rockchip-linux/rkbin;protocol=https;branch=master\"\n+SRCREV = \"b4558da0860ca48bf1a571dd33ccba580b9abe23\"\n+\n+PROVIDES += \"trusted-firmware-a\"\n+PROVIDES += \"optee-os\"\n+\n+inherit bin_package deploy\n+\n+S = \"${WORKDIR}/git\"\n+\n+COMPATIBLE_MACHINE = \"\"\n+COMPATIBLE_MACHINE:rk3588s = \"rk3588s\"\n+\n+PACKAGE_ARCH = \"${MACHINE_ARCH}\"\n+\n+do_install() {\n+\t# Nothing in this recipe is useful in a filesystem\n+\t:\n+}\n+\n+PACKAGES = \"${PN}\"\n+ALLOW_EMPTY:${PN} = \"1\"\n+\n+do_deploy() {\n+\t# Prebuilt TF-A\n+\tinstall -m 644 ${S}/bin/rk35/rk3588_bl31_v*.elf ${DEPLOYDIR}/bl31-rk3588.elf\n+\t# Prebuilt OPTEE-OS\n+\tinstall -m 644 ${S}/bin/rk35/rk3588_bl32_v*.bin ${DEPLOYDIR}/tee-rk3588.bin\n+\t# Prebuilt U-Boot TPL (DDR init)\n+\tinstall -m 644 ${S}/bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v*.bin ${DEPLOYDIR}/ddr-rk3588.bin\n+}\n+\n+addtask deploy after do_install\ndiff --git a/recipes-bsp/u-boot/u-boot%.bbappend b/recipes-bsp/u-boot/u-boot%.bbappend\nindex de1f2ca..c611377 100644\n--- a/recipes-bsp/u-boot/u-boot%.bbappend\n+++ b/recipes-bsp/u-boot/u-boot%.bbappend\n@@ -7,6 +7,12 @@ do_compile:append:rock2-square () {\n \n ATF_DEPENDS ??= \"\"\n \n+EXTRA_OEMAKE:append:rk3588s = \" \\\n+\tBL31=${DEPLOY_DIR_IMAGE}/bl31-rk3588.elf \\\n+\tROCKCHIP_TPL=${DEPLOY_DIR_IMAGE}/ddr-rk3588.bin \\\n+\t\"\n+ATF_DEPENDS:rk3588s = \" rockchip-rkbin:do_deploy\"\n+\n EXTRA_OEMAKE:append:rk3399 = \" BL31=${DEPLOY_DIR_IMAGE}/bl31-rk3399.elf\"\n ATF_DEPENDS:rk3399 = \" trusted-firmware-a:do_deploy\"\n EXTRA_OEMAKE:append:rk3328 = \" BL31=${DEPLOY_DIR_IMAGE}/bl31-rk3328.elf\"\n-- \n2.41.0\n\n\n\n^ permalink raw reply related\t[flat|nested] 3+ messages in thread",
    "* Re: [meta-rockchip][kirkstone][PATCH] rk3588(s): add\n  2023-10-05  9:00 [meta-rockchip][kirkstone][PATCH] rk3588(s): add Quentin Schulz\n@ 2023-10-05  9:30 ` Quentin Schulz\n  2023-10-13 16:15 ` [yocto] \" Trevor Woerner\n  1 sibling, 0 replies; 3+ messages in thread\nFrom: Quentin Schulz @ 2023-10-05  9:30 UTC (permalink / raw)\n  To: Quentin Schulz, twoerner; +Cc: yocto\n\nHi Trevor,\n\nOn 10/5/23 11:00, Quentin Schulz wrote:\n> From: Trevor Woerner <twoerner@gmail.com>\n> \n> Unfortunately the TF-A project does not currently have support for\n> the rk3588. Therefore, for the time-being, the only way to supply a\n> TPL/DDR-init for the rk3588 is to use the closed-source rkbin binaries\n> from Rockchip. If/when TF-A adds support for the rk3588 we can investigate\n> switching.\n> \n> The rk3588 comes in two variants: rk3588 and rk3588s. The \"s\" option is a\n> stripped-down version of the rk3588. In the Linux kernel these two SoCs are\n> kept separate, with the rk3588 building on the rk3588s, so we've mimicked that\n> same behaviour here.\n> \n> Signed-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\n> Signed-off-by: Trevor Woerner <twoerner@gmail.com>\n> [backported from f8af59dd7cd7 (\"rock-5b: add\")]\n> [removed support for rock-5b since no decent linux-yocto support in kirkstone]\n> [removed KERNEL_FEATURES and kmeta since no decent linux-yocto support in kirkstone]\n> [renamed INIT_FIRMWARE_DEPENDS to ATF_DEPENDS]\n\n^^^ This is actually something we probably need to discuss?\n\nThis makes it harder to backport patches from the master branch to \nkirkstone because we have to be careful to rename those variables before \napplying the patch (even if somehow it applies cleanly).\n\nOn the other hand, migrating to the new name means we break the current \nbehavior for downstream users of meta-rockchip.\n\nCheers,\nQuentin\n\n> [tested on downstream board with downstream kernel and u-boot]\n> Signed-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\n> ---\n>   conf/machine/include/rk3588.inc         |  6 ++++\n>   conf/machine/include/rk3588s.inc        | 16 +++++++++++\n>   recipes-bsp/rkbin/rockchip-rkbin_git.bb | 37 +++++++++++++++++++++++++\n>   recipes-bsp/u-boot/u-boot%.bbappend     |  6 ++++\n>   4 files changed, 65 insertions(+)\n>   create mode 100644 conf/machine/include/rk3588.inc\n>   create mode 100644 conf/machine/include/rk3588s.inc\n>   create mode 100644 recipes-bsp/rkbin/rockchip-rkbin_git.bb\n> \n> diff --git a/conf/machine/include/rk3588.inc b/conf/machine/include/rk3588.inc\n> new file mode 100644\n> index 0000000..34f0627\n> --- /dev/null\n> +++ b/conf/machine/include/rk3588.inc\n> @@ -0,0 +1,6 @@\n> +MACHINEOVERRIDES =. \"rk3588:\"\n> +\n> +# the rk3588s is a \"stripped-down\" version of the rk3588\n> +# in the kernel's device-tree the rk3588 builds on top of the rk3588s\n> +# so anything that is valid for the rk3588s is valid for the rk3588\n> +require conf/machine/include/rk3588s.inc\n> diff --git a/conf/machine/include/rk3588s.inc b/conf/machine/include/rk3588s.inc\n> new file mode 100644\n> index 0000000..3da226e\n> --- /dev/null\n> +++ b/conf/machine/include/rk3588s.inc\n> @@ -0,0 +1,16 @@\n> +MACHINEOVERRIDES =. \"rk3588s:\"\n> +DEFAULTTUNE ?= \"cortexa76-cortexa55-crypto\"\n> +\n> +require conf/machine/include/arm/armv8-2a/tune-cortexa76-cortexa55.inc\n> +require conf/machine/include/rockchip-defaults.inc\n> +require conf/machine/include/rockchip-wic.inc\n> +\n> +KBUILD_DEFCONFIG ?= \"defconfig\"\n> +KERNEL_CLASSES = \"kernel-fitimage\"\n> +KERNEL_IMAGETYPE = \"fitImage\"\n> +\n> +PREFERRED_PROVIDER_trusted-firmware-a = \"rockchip-rkbin\"\n> +PREFERRED_PROVIDER_optee-os = \"rockchip-rkbin\"\n> +\n> +UBOOT_SUFFIX ?= \"itb\"\n> +UBOOT_ENTRYPOINT ?= \"0x06000000\"\n> diff --git a/recipes-bsp/rkbin/rockchip-rkbin_git.bb b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\n> new file mode 100644\n> index 0000000..7fefb01\n> --- /dev/null\n> +++ b/recipes-bsp/rkbin/rockchip-rkbin_git.bb\n> @@ -0,0 +1,37 @@\n> +DESCRIPTION = \"Rockchip Firmware and Tool Binaries\"\n> +LICENSE = \"Proprietary\"\n> +LIC_FILES_CHKSUM = \"file://LICENSE;md5=15faa4a01e7eb0f5d33f9f2bcc7bff62\"\n> +\n> +SRC_URI = \"git://github.com/rockchip-linux/rkbin;protocol=https;branch=master\"\n> +SRCREV = \"b4558da0860ca48bf1a571dd33ccba580b9abe23\"\n> +\n> +PROVIDES += \"trusted-firmware-a\"\n> +PROVIDES += \"optee-os\"\n> +\n> +inherit bin_package deploy\n> +\n> +S = \"${WORKDIR}/git\"\n> +\n> +COMPATIBLE_MACHINE = \"\"\n> +COMPATIBLE_MACHINE:rk3588s = \"rk3588s\"\n> +\n> +PACKAGE_ARCH = \"${MACHINE_ARCH}\"\n> +\n> +do_install() {\n> +\t# Nothing in this recipe is useful in a filesystem\n> +\t:\n> +}\n> +\n> +PACKAGES = \"${PN}\"\n> +ALLOW_EMPTY:${PN} = \"1\"\n> +\n> +do_deploy() {\n> +\t# Prebuilt TF-A\n> +\tinstall -m 644 ${S}/bin/rk35/rk3588_bl31_v*.elf ${DEPLOYDIR}/bl31-rk3588.elf\n> +\t# Prebuilt OPTEE-OS\n> +\tinstall -m 644 ${S}/bin/rk35/rk3588_bl32_v*.bin ${DEPLOYDIR}/tee-rk3588.bin\n> +\t# Prebuilt U-Boot TPL (DDR init)\n> +\tinstall -m 644 ${S}/bin/rk35/rk3588_ddr_lp4_2112MHz_lp5_2736MHz_v*.bin ${DEPLOYDIR}/ddr-rk3588.bin\n> +}\n> +\n> +addtask deploy after do_install\n> diff --git a/recipes-bsp/u-boot/u-boot%.bbappend b/recipes-bsp/u-boot/u-boot%.bbappend\n> index de1f2ca..c611377 100644\n> --- a/recipes-bsp/u-boot/u-boot%.bbappend\n> +++ b/recipes-bsp/u-boot/u-boot%.bbappend\n> @@ -7,6 +7,12 @@ do_compile:append:rock2-square () {\n>   \n>   ATF_DEPENDS ??= \"\"\n>   \n> +EXTRA_OEMAKE:append:rk3588s = \" \\\n> +\tBL31=${DEPLOY_DIR_IMAGE}/bl31-rk3588.elf \\\n> +\tROCKCHIP_TPL=${DEPLOY_DIR_IMAGE}/ddr-rk3588.bin \\\n> +\t\"\n> +ATF_DEPENDS:rk3588s = \" rockchip-rkbin:do_deploy\"\n> +\n>   EXTRA_OEMAKE:append:rk3399 = \" BL31=${DEPLOY_DIR_IMAGE}/bl31-rk3399.elf\"\n>   ATF_DEPENDS:rk3399 = \" trusted-firmware-a:do_deploy\"\n>   EXTRA_OEMAKE:append:rk3328 = \" BL31=${DEPLOY_DIR_IMAGE}/bl31-rk3328.elf\"\n\n\n^ permalink raw reply\t[flat|nested] 3+ messages in thread",
    "* Re: [yocto] [meta-rockchip][kirkstone][PATCH] rk3588(s): add\n  2023-10-05  9:00 [meta-rockchip][kirkstone][PATCH] rk3588(s): add Quentin Schulz\n  2023-10-05  9:30 ` Quentin Schulz\n@ 2023-10-13 16:15 ` Trevor Woerner\n  1 sibling, 0 replies; 3+ messages in thread\nFrom: Trevor Woerner @ 2023-10-13 16:15 UTC (permalink / raw)\n  To: Quentin Schulz; +Cc: yocto, Quentin Schulz\n\nOn Thu 2023-10-05 @ 11:00:16 AM, Quentin Schulz wrote:\n> From: Trevor Woerner <twoerner@gmail.com>\n> \n> Unfortunately the TF-A project does not currently have support for\n> the rk3588. Therefore, for the time-being, the only way to supply a\n> TPL/DDR-init for the rk3588 is to use the closed-source rkbin binaries\n> from Rockchip. If/when TF-A adds support for the rk3588 we can investigate\n> switching.\n> \n> The rk3588 comes in two variants: rk3588 and rk3588s. The \"s\" option is a\n> stripped-down version of the rk3588. In the Linux kernel these two SoCs are\n> kept separate, with the rk3588 building on the rk3588s, so we've mimicked that\n> same behaviour here.\n> \n> Signed-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\n> Signed-off-by: Trevor Woerner <twoerner@gmail.com>\n> [backported from f8af59dd7cd7 (\"rock-5b: add\")]\n> [removed support for rock-5b since no decent linux-yocto support in kirkstone]\n> [removed KERNEL_FEATURES and kmeta since no decent linux-yocto support in kirkstone]\n> [renamed INIT_FIRMWARE_DEPENDS to ATF_DEPENDS]\n> [tested on downstream board with downstream kernel and u-boot]\n> Signed-off-by: Quentin Schulz <quentin.schulz@theobroma-systems.com>\n> ---\n>  conf/machine/include/rk3588.inc         |  6 ++++\n>  conf/machine/include/rk3588s.inc        | 16 +++++++++++\n>  recipes-bsp/rkbin/rockchip-rkbin_git.bb | 37 +++++++++++++++++++++++++\n>  recipes-bsp/u-boot/u-boot%.bbappend     |  6 ++++\n>  4 files changed, 65 insertions(+)\n>  create mode 100644 conf/machine/include/rk3588.inc\n>  create mode 100644 conf/machine/include/rk3588s.inc\n>  create mode 100644 recipes-bsp/rkbin/rockchip-rkbin_git.bb\n\nApplied to meta-rockchip, kirkstone branch.\nThanks!\n\n\n^ permalink raw reply\t[flat|nested] 3+ messages in thread",
    "end of thread, other threads:[~2023-10-13 16:15 UTC | newest]\n\nThread overview: 3+ messages (download: mbox.gz / follow: Atom feed)\n-- links below jump to the message on this page --\n2023-10-05  9:00 [meta-rockchip][kirkstone][PATCH] rk3588(s): add Quentin Schulz\n2023-10-05  9:30 ` Quentin Schulz\n2023-10-13 16:15 ` [yocto] \" Trevor Woerner\n"
]