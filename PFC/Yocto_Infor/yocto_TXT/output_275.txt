* [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
@ 2023-08-09  7:00 Ming Wen
  2023-08-09  7:04 ` [yocto] " Alexander Kanavin
  2023-08-10 17:34 ` Martin Jansa
  0 siblings, 2 replies; 8+ messages in thread
From: Ming Wen @ 2023-08-09  7:00 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 11453 bytes --]

Hi,

We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to the latest version. But sadly, hit below error when trying to use it to compile the code on *ubuntu 18.04*. For comparison, ubuntu 22.04 is OK.

Through narrowing down, we found below clues. It should be caused by some of recent updates to Poky.
It is appreciated if any of Yocto maintainer could help to give a quick fix. :)

*To make things simper, the test example is from* *official quick build manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html ).

*

==== *Segmentation fault of mkfs.ext4, which is provided by the package of e2fsprogs-native .* ====

jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal

WARNING: You are using a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.

Loading cache: 100% |                                                                                                                                   | ETA:  --:--:--

Loaded 0 entries from dependency cache.

Parsing recipes: 100% |##################################################################################################################################| Time: 0:00:17

Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45 skipped, 0 masked, 0 errors.

NOTE: Resolving any missing task queue dependencies

Build Configuration:

BB_VERSION           = "2.0.0"

BUILD_SYS            = "x86_64-linux"

NATIVELSBSTRING      = "ubuntu-18.04"

TARGET_SYS           = "x86_64-poky-linux"

MACHINE              = "qemux86-64"

DISTRO               = "poky"

DISTRO_VERSION       = "4.0.12"

TUNE_FEATURES        = "m64 core2"

TARGET_FPU           = ""

meta

meta-poky

meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"

meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"

Initialising tasks: 100% |###############################################################################################################################| Time: 0:00:01

Checking sstate mirror object availability: 100% |#######################################################################################################| Time: 0:00:05

Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46% match, 0% complete)

NOTE: Executing Tasks

WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL http://www.openssl.org/source/openssl-3.0.10.tar.gz , attempting MIRRORS if available

ERROR: core-image-minimal-1.0-r0 do_image_ext4: ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796', 139, None, None)

ERROR: Logfile of failure stored in: /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796

Log data follows:

| DEBUG: Executing python function extend_recipe_sysroot

| NOTE: Direct dependencies are ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:do_populate_sysroot']

| NOTE: Installed into sysroot: ['e2fsprogs-native']

| NOTE: Skipping as already exists in sysroot: ['cross-localedef-native', 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross', 'update-rc.d-native', 'createrepo-c-native', 'dnf-native', 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native', 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native', 'librepo-native', 'gettext-minimal-native', 'libdnf-native', 'python3-iniparse-native', 'libcomps-native', 'cmake-native', 'python3-native', 'perl-native', 'zlib-native', 'attr-native', 'libtool-native', 'texinfo-dummy-native', 'util-linux-native', 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native', 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native', 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native', 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native', 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native', 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native', 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native', 'python3-wheel-native', 'python3-setuptools-native', 'python3-installer-native', 'ncurses-native', 'libnsl2-native', 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native', 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native', 'libcap-ng-native', 'itstool-native', 'libgpg-error-native', 'libcap-native', 'libmicrohttpd-native', 'gettext-native', 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native', 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native', 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native', 'libidn2-native', 'gnu-config-native']

| DEBUG: sed -e 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g' /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath | xargs sed -i -e 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g; s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g' -e 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g' -e 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g' -e 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g' -e 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g' -e 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'

| DEBUG: Python function extend_recipe_sysroot finished

| DEBUG: Executing python function set_image_size

| DEBUG: 27409.200000 = 21084 * 1.300000

| DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0

| DEBUG: 27410.000000 = int(27409.200000)

| DEBUG: 27410 = aligned(27410)

| DEBUG: returning 27410

| DEBUG: Python function set_image_size finished

| DEBUG: Executing shell function do_image_ext4

| DEBUG: Executing dd if=/dev/zero of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 seek=27410 count=0 bs=1024

| 0+0 records in

| 0+0 records out

| 0 bytes copied, 6.4388e-05 s, 0.0 kB/s

| DEBUG: Actual Rootfs size:  19988 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| DEBUG: Actual Partion size: 28067840

| DEBUG: Executing mkfs.ext4 -F -i 4096 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 -d /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| WARNING: exit code 139 from a shell command.

| Segmentation fault (core dumped)

ERROR: Task (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4) failed with exit code '1'

NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be rerun and 1 failed.

Summary: 1 task failed:

/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4

Summary: There were 2 WARNING messages.

Summary: There was 1 ERROR message, returning a non-zero exit code.

==== *I rolled back the revision of poky  to check the issue,  the commit of  " uninative: Upgrade to 3.10 to support gcc 13" introduced it.* ====

commit aab6fc20de9473d8d7f277332601cbae70c53320

Author: Michael Halstead < mhalstead@linuxfoundation.org >

Date:   Fri May 26 10:21:48 2023 -0700

uninative: Upgrade to 3.10 to support gcc 13

(From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)

Signed-off-by: Michael Halstead < mhalstead@linuxfoundation.org >

Signed-off-by: Richard Purdie < richard.purdie@linuxfoundation.org >

(cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)

Signed-off-by: Steve Sakoman < steve@sakoman.com >

commit 51d6afc92f621657f800171a992cea7708261d31

Author: Richard Purdie < richard.purdie@linuxfoundation.org >

Date:   Wed Jun 7 17:27:36 2023 +0100

selftest/reproducible: Allow native/cross reuse in test

We don't compare reproducibility of the native/cross components, only the

target ones. With the long build times of rust-native, the test now takes

crazy lengths of time so this tweak should allow us to reuse native/cross

artefacts from sstate whilst still testing the target output is

reproducible.

(From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)

Signed-off-by: Richard Purdie < richard.purdie@linuxfoundation.org >

(cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)

Signed-off-by: Steve Sakoman < steve@sakoman.com >

**

[-- Attachment #2: Type: text/html, Size: 25393 bytes --]

^ permalink raw reply	[flat|nested] 8+ messages in thread
* Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-09  7:00 [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04 Ming Wen
@ 2023-08-09  7:04 ` Alexander Kanavin
  2023-08-09  8:18   ` [EXT] " Ming Wen
  2023-08-09  8:27   ` Michael Opdenacker
  2023-08-10 17:34 ` Martin Jansa
  1 sibling, 2 replies; 8+ messages in thread
From: Alexander Kanavin @ 2023-08-09  7:04 UTC (permalink / raw)
  To: Ming Wen; +Cc: yocto

 I need to remind everyone that Ubuntu 18.04 went out of support on
31st of May this year, and it is no longer possible for the general
public to run that version securely. Please keep that in mind, whether
or not issues are fixed (I'd rather drop 18.04 from support list, and
as soon as possible, i.e. when the AB workers are updated).

Alex

On Wed, 9 Aug 2023 at 09:00, Ming Wen <mwen@ambarella.com> wrote:
>
> Hi,
>
> We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to the latest version. But sadly, hit below error when trying to use it to compile the code on ubuntu 18.04. For comparison, ubuntu 22.04 is OK.
>
> Through narrowing down, we found below clues. It should be caused by some of recent updates to Poky.
> It is appreciated if any of Yocto maintainer could help to give a quick fix. :)
>
> To make things simper, the test example is from official quick build manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html ).
>
> ==== Segmentation fault of mkfs.ext4, which is provided by the package of e2fsprogs-native . ====
>
>
>
> jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal
>
> WARNING: You are using a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.
>
> Loading cache: 100% |                                                                                                                                   | ETA:  --:--:--
>
> Loaded 0 entries from dependency cache.
>
> Parsing recipes: 100% |##################################################################################################################################| Time: 0:00:17
>
> Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45 skipped, 0 masked, 0 errors.
>
> NOTE: Resolving any missing task queue dependencies
>
>
>
> Build Configuration:
>
> BB_VERSION           = "2.0.0"
>
> BUILD_SYS            = "x86_64-linux"
>
> NATIVELSBSTRING      = "ubuntu-18.04"
>
> TARGET_SYS           = "x86_64-poky-linux"
>
> MACHINE              = "qemux86-64"
>
> DISTRO               = "poky"
>
> DISTRO_VERSION       = "4.0.12"
>
> TUNE_FEATURES        = "m64 core2"
>
> TARGET_FPU           = ""
>
> meta
>
> meta-poky
>
> meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"
>
> meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"
>
>
>
> Initialising tasks: 100% |###############################################################################################################################| Time: 0:00:01
>
> Checking sstate mirror object availability: 100% |#######################################################################################################| Time: 0:00:05
>
> Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46% match, 0% complete)
>
> NOTE: Executing Tasks
>
> WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL http://www.openssl.org/source/openssl-3.0.10.tar.gz, attempting MIRRORS if available
>
> ERROR: core-image-minimal-1.0-r0 do_image_ext4: ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796', 139, None, None)
>
> ERROR: Logfile of failure stored in: /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796
>
> Log data follows:
>
> | DEBUG: Executing python function extend_recipe_sysroot
>
> | NOTE: Direct dependencies are ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:do_populate_sysroot']
>
> | NOTE: Installed into sysroot: ['e2fsprogs-native']
>
> | NOTE: Skipping as already exists in sysroot: ['cross-localedef-native', 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross', 'update-rc.d-native', 'createrepo-c-native', 'dnf-native', 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native', 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native', 'librepo-native', 'gettext-minimal-native', 'libdnf-native', 'python3-iniparse-native', 'libcomps-native', 'cmake-native', 'python3-native', 'perl-native', 'zlib-native', 'attr-native', 'libtool-native', 'texinfo-dummy-native', 'util-linux-native', 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native', 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native', 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native', 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native', 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native', 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native', 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native', 'python3-wheel-native', 'python3-setuptools-native', 'python3-installer-native', 'ncurses-native', 'libnsl2-native', 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native', 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native', 'libcap-ng-native', 'itstool-native', 'libgpg-error-native', 'libcap-native', 'libmicrohttpd-native', 'gettext-native', 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native', 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native', 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native', 'libidn2-native', 'gnu-config-native']
>
> | DEBUG: sed -e 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g' /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath | xargs sed -i -e 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g; s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g' -e 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g' -e 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g' -e 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g' -e 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g' -e 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'
>
> | DEBUG: Python function extend_recipe_sysroot finished
>
> | DEBUG: Executing python function set_image_size
>
> | DEBUG: 27409.200000 = 21084 * 1.300000
>
> | DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0
>
> | DEBUG: 27410.000000 = int(27409.200000)
>
> | DEBUG: 27410 = aligned(27410)
>
> | DEBUG: returning 27410
>
> | DEBUG: Python function set_image_size finished
>
> | DEBUG: Executing shell function do_image_ext4
>
> | DEBUG: Executing dd if=/dev/zero of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 seek=27410 count=0 bs=1024
>
> | 0+0 records in
>
> | 0+0 records out
>
> | 0 bytes copied, 6.4388e-05 s, 0.0 kB/s
>
> | DEBUG: Actual Rootfs size:  19988 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | DEBUG: Actual Partion size: 28067840
>
> | DEBUG: Executing mkfs.ext4 -F -i 4096 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 -d /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | WARNING: exit code 139 from a shell command.
>
> | Segmentation fault (core dumped)
>
> ERROR: Task (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4) failed with exit code '1'
>
> NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be rerun and 1 failed.
>
>
>
> Summary: 1 task failed:
>
>   /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4
>
> Summary: There were 2 WARNING messages.
>
> Summary: There was 1 ERROR message, returning a non-zero exit code.
>
>
>
>
>
> ==== I rolled back the revision of poky  to check the issue,  the commit of  "uninative: Upgrade to 3.10 to support gcc 13" introduced it. ====
>
>
>
> commit aab6fc20de9473d8d7f277332601cbae70c53320
>
> Author: Michael Halstead <mhalstead@linuxfoundation.org>
>
> Date:   Fri May 26 10:21:48 2023 -0700
>
>
>
>     uninative: Upgrade to 3.10 to support gcc 13
>
>
>
>     (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)
>
>
>
>     Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
> commit 51d6afc92f621657f800171a992cea7708261d31
>
> Author: Richard Purdie <richard.purdie@linuxfoundation.org>
>
> Date:   Wed Jun 7 17:27:36 2023 +0100
>
>
>
>     selftest/reproducible: Allow native/cross reuse in test
>
>
>
>     We don't compare reproducibility of the native/cross components, only the
>
>     target ones. With the long build times of rust-native, the test now takes
>
>     crazy lengths of time so this tweak should allow us to reuse native/cross
>
>     artefacts from sstate whilst still testing the target output is
>
>     reproducible.
>
>
>
>     (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)
>
>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#60757): https://lists.yoctoproject.org/g/yocto/message/60757
> Mute This Topic: https://lists.yoctoproject.org/mt/100638466/1686489
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [alex.kanavin@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>


^ permalink raw reply	[flat|nested] 8+ messages in thread
* RE: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-09  7:04 ` [yocto] " Alexander Kanavin
@ 2023-08-09  8:18   ` Ming Wen
  2023-08-09  8:27   ` Michael Opdenacker
  1 sibling, 0 replies; 8+ messages in thread
From: Ming Wen @ 2023-08-09  8:18 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: yocto

Hi Alex:
 
Got it. Thanks for your quick comments.
Do let us know if you will have a chance to take care of Ubuntu 18.04 at current stage for Poky-Kirkstone.
In parallel, we will also think about upgrade the Ubuntu OS of our build server.
 
Best Regards!
Ming Wen (闻明)
SDK Team | Ambarella Shanghai

-----Original Message-----
From: yocto@lists.yoctoproject.org <yocto@lists.yoctoproject.org> On Behalf Of Alexander Kanavin
Sent: Wednesday, August 9, 2023 3:04 PM
To: Ming Wen <mwen@ambarella.com>
Cc: yocto@lists.yoctoproject.org
Subject: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.

 I need to remind everyone that Ubuntu 18.04 went out of support on 31st of May this year, and it is no longer possible for the general public to run that version securely. Please keep that in mind, whether or not issues are fixed (I'd rather drop 18.04 from support list, and as soon as possible, i.e. when the AB workers are updated).

Alex

On Wed, 9 Aug 2023 at 09:00, Ming Wen <mwen@ambarella.com> wrote:
>
> Hi,
>
> We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to the latest version. But sadly, hit below error when trying to use it to compile the code on ubuntu 18.04. For comparison, ubuntu 22.04 is OK.
>
> Through narrowing down, we found below clues. It should be caused by some of recent updates to Poky.
> It is appreciated if any of Yocto maintainer could help to give a 
> quick fix. :)
>
> To make things simper, the test example is from official quick build manual( https://urldefense.com/v3/__https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html__;!!PeEy7nZLVv0!kxrNUFeQHJvm7Naw5sXvk0eDL_kdQEjsFIzgdtzJ_JAE08NtXffo0DLA8SnC40VB79ElKm8XRvsmUnBzBfdK$  ).
>
> ==== Segmentation fault of mkfs.ext4, which is provided by the package 
> of e2fsprogs-native . ====
>
>
>
> jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake 
> core-image-minimal
>
> WARNING: You are using a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.
>
> Loading cache: 100% |                                                                                                                                   | ETA:  --:--:--
>
> Loaded 0 entries from dependency cache.
>
> Parsing recipes: 100% 
> |#####################################################################
> #############################################################| Time: 
> 0:00:17
>
> Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45 skipped, 0 masked, 0 errors.
>
> NOTE: Resolving any missing task queue dependencies
>
>
>
> Build Configuration:
>
> BB_VERSION           = "2.0.0"
>
> BUILD_SYS            = "x86_64-linux"
>
> NATIVELSBSTRING      = "ubuntu-18.04"
>
> TARGET_SYS           = "x86_64-poky-linux"
>
> MACHINE              = "qemux86-64"
>
> DISTRO               = "poky"
>
> DISTRO_VERSION       = "4.0.12"
>
> TUNE_FEATURES        = "m64 core2"
>
> TARGET_FPU           = ""
>
> meta
>
> meta-poky
>
> meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"
>
> meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"
>
>
>
> Initialising tasks: 100% 
> |#####################################################################
> ##########################################################| Time: 
> 0:00:01
>
> Checking sstate mirror object availability: 100% 
> |#####################################################################
> ##################################| Time: 0:00:05
>
> Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 
> (46% match, 0% complete)
>
> NOTE: Executing Tasks
>
> WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL 
> https://urldefense.com/v3/__http://www.openssl.org/source/openssl-3.0.
> 10.tar.gz__;!!PeEy7nZLVv0!kxrNUFeQHJvm7Naw5sXvk0eDL_kdQEjsFIzgdtzJ_JAE
> 08NtXffo0DLA8SnC40VB79ElKm8XRvsmUjQ8bWSx$ , attempting MIRRORS if 
> available
>
> ERROR: core-image-minimal-1.0-r0 do_image_ext4: 
> ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/q
> emux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.
> 22796', 139, None, None)
>
> ERROR: Logfile of failure stored in: 
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-l
> inux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796
>
> Log data follows:
>
> | DEBUG: Executing python function extend_recipe_sysroot
>
> | NOTE: Direct dependencies are 
> | ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cros
> | s-localedef-native_2.35.bb:do_populate_sysroot', 
> | '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldcon
> | fig-native_2.12.1.bb:do_populate_sysroot', 
> | '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qe
> | muwrapper-cross_1.0.bb:do_populate_sysroot', 
> | '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depm
> | odwrapper-cross_1.0.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-c
> | ore/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/dnf/dnf_4.11.1.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/opkg/opkg_0.5.0.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/pseudo/pseudo_git.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-d
> | evtools/rpm/rpm_4.17.1.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-e
> | xtended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot', 
> | 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-e
> | xtended/pigz/pigz_2.7.bb:do_populate_sysroot']
>
> | NOTE: Installed into sysroot: ['e2fsprogs-native']
>
> | NOTE: Skipping as already exists in sysroot: 
> | ['cross-localedef-native', 'ldconfig-native', 'qemuwrapper-cross', 
> | 'depmodwrapper-cross', 'update-rc.d-native', 'createrepo-c-native', 
> | 'dnf-native', 'makedevs-native', 'opkg-utils-native', 'opkg-native', 
> | 'pseudo-native', 'rpm-native', 'pbzip2-native', 'pigz-native', 
> | 'bzip2-native', 'librepo-native', 'gettext-minimal-native', 
> | 'libdnf-native', 'python3-iniparse-native', 'libcomps-native', 
> | 'cmake-native', 'python3-native', 'perl-native', 'zlib-native', 
> | 'attr-native', 'libtool-native', 'texinfo-dummy-native', 
> | 'util-linux-native', 'openssl-native', 'debianutils-native', 
> | 'kmod-native', 'shadow-native', 'shared-mime-info-native', 
> | 'file-native', 'lua-native', 'sqlite3-native', 'zstd-native', 
> | 'popt-native', 'libgcrypt-native', 'xz-native', 'elfutils-native', 
> | 'qemu-native', 'curl-native', 'libxml2-native', 'glib-2.0-native', 
> | 'expat-native', 'libarchive-native', 'libsolv-native', 
> | 'gpgme-native', 'libmodulemd-native', 
> | 'gobject-introspection-native', 'libcheck-native', 'json-c-native', 
> | 'swig-native', 'python3-six-native', 'python3-wheel-native', 
> | 'python3-setuptools-native', 'python3-installer-native', 
> | 'ncurses-native', 'libnsl2-native', 'libffi-native', 
> | 'libtirpc-native', 'util-linux-libuuid-native', 'gdbm-native', 
> | 'readline-native', 'make-native', 'libpcre2-native', 
> | 'libcap-ng-native', 'itstool-native', 'libgpg-error-native', 
> | 'libcap-native', 'libmicrohttpd-native', 'gettext-native', 
> | 'libpcre-native', 'lzo-native', 'libassuan-native', 
> | 'libyaml-native', 'flex-native', 'python3-flit-core-native', 
> | 'unzip-native', 'gnutls-native', 'm4-native', 'nettle-native', 
> | 'libunistring-native', 'gmp-native', 'libidn2-native', 
> | 'gnu-config-native']
>
> | DEBUG: sed -e 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g' /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath | xargs sed -i -e 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g; s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g' -e 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g' -e 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g' -e 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g' -e 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g' -e 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'
>
> | DEBUG: Python function extend_recipe_sysroot finished
>
> | DEBUG: Executing python function set_image_size
>
> | DEBUG: 27409.200000 = 21084 * 1.300000
>
> | DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0
>
> | DEBUG: 27410.000000 = int(27409.200000)
>
> | DEBUG: 27410 = aligned(27410)
>
> | DEBUG: returning 27410
>
> | DEBUG: Python function set_image_size finished
>
> | DEBUG: Executing shell function do_image_ext4
>
> | DEBUG: Executing dd if=/dev/zero 
> | of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-p
> | oky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-
> | complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 
> | seek=27410 count=0 bs=1024
>
> | 0+0 records in
>
> | 0+0 records out
>
> | 0 bytes copied, 6.4388e-05 s, 0.0 kB/s
>
> | DEBUG: Actual Rootfs size:  19988 
> | /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky
> | -linux/core-image-minimal/1.0-r0/rootfs
>
> | DEBUG: Actual Partion size: 28067840
>
> | DEBUG: Executing mkfs.ext4 -F -i 4096 
> | /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky
> | -linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-com
> | plete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 -d 
> | /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky
> | -linux/core-image-minimal/1.0-r0/rootfs
>
> | WARNING: exit code 139 from a shell command.
>
> | Segmentation fault (core dumped)
>
> ERROR: Task (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4) failed with exit code '1'
>
> NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be rerun and 1 failed.
>
>
>
> Summary: 1 task failed:
>
>   
> /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-im
> age-minimal.bb:do_image_ext4
>
> Summary: There were 2 WARNING messages.
>
> Summary: There was 1 ERROR message, returning a non-zero exit code.
>
>
>
>
>
> ==== I rolled back the revision of poky  to check the issue,  the 
> commit of  "uninative: Upgrade to 3.10 to support gcc 13" introduced 
> it. ====
>
>
>
> commit aab6fc20de9473d8d7f277332601cbae70c53320
>
> Author: Michael Halstead <mhalstead@linuxfoundation.org>
>
> Date:   Fri May 26 10:21:48 2023 -0700
>
>
>
>     uninative: Upgrade to 3.10 to support gcc 13
>
>
>
>     (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)
>
>
>
>     Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit 
> f811bffb861b23238e8291394bd6e8407f013619)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
> commit 51d6afc92f621657f800171a992cea7708261d31
>
> Author: Richard Purdie <richard.purdie@linuxfoundation.org>
>
> Date:   Wed Jun 7 17:27:36 2023 +0100
>
>
>
>     selftest/reproducible: Allow native/cross reuse in test
>
>
>
>     We don't compare reproducibility of the native/cross components, 
> only the
>
>     target ones. With the long build times of rust-native, the test 
> now takes
>
>     crazy lengths of time so this tweak should allow us to reuse 
> native/cross
>
>     artefacts from sstate whilst still testing the target output is
>
>     reproducible.
>
>
>
>     (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)
>
>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit 
> b494d83c639a877cefeb7cbab6d37195e492f059)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
>
> 
>

######################################################################
This EXTERNAL email has been scanned by Proofpoint Email Protect service.

**********************************************************************
This email and attachments contain Ambarella Proprietary and/or Confidential Information and is intended solely for the use of the individual(s) to whom it is addressed. Any unauthorized review, use, disclosure, distribute, copy, or print is prohibited. If you are not an intended recipient, please contact the sender by reply email and destroy all copies of the original message. Thank you.

^ permalink raw reply	[flat|nested] 8+ messages in thread
* Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-09  7:04 ` [yocto] " Alexander Kanavin
  2023-08-09  8:18   ` [EXT] " Ming Wen
@ 2023-08-09  8:27   ` Michael Opdenacker
  1 sibling, 0 replies; 8+ messages in thread
From: Michael Opdenacker @ 2023-08-09  8:27 UTC (permalink / raw)
  To: Alexander Kanavin; +Cc: yocto, Ming Wen

Hi Alex,

On 09.08.23 at 09:04, Alexander Kanavin wrote:
>   I need to remind everyone that Ubuntu 18.04 went out of support on
> 31st of May this year, and it is no longer possible for the general
> public to run that version securely. Please keep that in mind, whether
> or not issues are fixed (I'd rather drop 18.04 from support list, and
> as soon as possible, i.e. when the AB workers are updated).
>
> Alex


I submitted a patch yesterday to update SANITY_TESTED_DISTROS on 
Kirkstone, and as soon as it is merged, I will update the patch I sent 
for the Kirkstone docs on Monday 
(https://lists.yoctoproject.org/g/docs/message/4108), which removes 
support for Ubuntu 18.04 (among other changes).

Cheers
Michael.

-- 
Michael Opdenacker, Bootlin
Embedded Linux and Kernel engineering
https://bootlin.com



^ permalink raw reply	[flat|nested] 8+ messages in thread
* Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-09  7:00 [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04 Ming Wen
  2023-08-09  7:04 ` [yocto] " Alexander Kanavin
@ 2023-08-10 17:34 ` Martin Jansa
  2023-08-15 14:05   ` [EXT] " Ming Wen
  1 sibling, 1 reply; 8+ messages in thread
From: Martin Jansa @ 2023-08-10 17:34 UTC (permalink / raw)
  To: Ming Wen; +Cc: yocto

[-- Attachment #1: Type: text/plain, Size: 12884 bytes --]

See
https://patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/
which is easy to backport work around to fix uninative-3.9 and 4.0.

Until uninative-4.1 with more proper fix (
https://patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/)
is released and configured to be used in dunfell, kirkstone, mickledore and
master.

Regards,

On Wed, Aug 9, 2023 at 9:00 AM Ming Wen <mwen@ambarella.com> wrote:

> Hi,
>
> We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to
> the latest version. But sadly, hit below error when trying to use it to
> compile the code on *ubuntu 18.04*. For comparison, ubuntu 22.04 is OK.
>
> Through narrowing down, we found below clues. It should be caused by some
> of recent updates to Poky.
> It is appreciated if any of Yocto maintainer could help to give a quick
> fix. :)
>
> *To make things simper, the test example is from*
>
> *official quick build
> manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html
> <https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html> ).*
>
> ==== *Segmentation fault of mkfs.ext4, which is provided by the package
> of e2fsprogs-native .* ====
>
>
>
> jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal
>
> WARNING: You are using a local hash equivalence server but have configured
> an sstate mirror. This will likely mean no sstate will match from the
> mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or
> use a hash equivalence server alongside the sstate mirror.
>
> Loading cache: 100% |
>
>   | ETA:  --:--:--
>
> Loaded 0 entries from dependency cache.
>
> Parsing recipes: 100%
> |##################################################################################################################################|
> Time: 0:00:17
>
> Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45
> skipped, 0 masked, 0 errors.
>
> NOTE: Resolving any missing task queue dependencies
>
>
>
> Build Configuration:
>
> BB_VERSION           = "2.0.0"
>
> BUILD_SYS            = "x86_64-linux"
>
> NATIVELSBSTRING      = "ubuntu-18.04"
>
> TARGET_SYS           = "x86_64-poky-linux"
>
> MACHINE              = "qemux86-64"
>
> DISTRO               = "poky"
>
> DISTRO_VERSION       = "4.0.12"
>
> TUNE_FEATURES        = "m64 core2"
>
> TARGET_FPU           = ""
>
> meta
>
> meta-poky
>
> meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"
>
> meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"
>
>
>
> Initialising tasks: 100%
> |###############################################################################################################################|
> Time: 0:00:01
>
> Checking sstate mirror object availability: 100%
> |#######################################################################################################|
> Time: 0:00:05
>
> Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46%
> match, 0% complete)
>
> NOTE: Executing Tasks
>
> WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL
> http://www.openssl.org/source/openssl-3.0.10.tar.gz, attempting MIRRORS
> if available
>
> ERROR: core-image-minimal-1.0-r0 do_image_ext4:
> ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796',
> 139, None, None)
>
> ERROR: Logfile of failure stored in:
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796
>
> Log data follows:
>
> | DEBUG: Executing python function extend_recipe_sysroot
>
> | NOTE: Direct dependencies are
> ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:
> do_populate_sysroot']
>
> | NOTE: Installed into sysroot: ['e2fsprogs-native']
>
> | NOTE: Skipping as already exists in sysroot: ['cross-localedef-native',
> 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross',
> 'update-rc.d-native', 'createrepo-c-native', 'dnf-native',
> 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native',
> 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native',
> 'librepo-native', 'gettext-minimal-native', 'libdnf-native',
> 'python3-iniparse-native', 'libcomps-native', 'cmake-native',
> 'python3-native', 'perl-native', 'zlib-native', 'attr-native',
> 'libtool-native', 'texinfo-dummy-native', 'util-linux-native',
> 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native',
> 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native',
> 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native',
> 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native',
> 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native',
> 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native',
> 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native',
> 'python3-wheel-native', 'python3-setuptools-native',
> 'python3-installer-native', 'ncurses-native', 'libnsl2-native',
> 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native',
> 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native',
> 'libcap-ng-native', 'itstool-native', 'libgpg-error-native',
> 'libcap-native', 'libmicrohttpd-native', 'gettext-native',
> 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native',
> 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native',
> 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native',
> 'libidn2-native', 'gnu-config-native']
>
> | DEBUG: sed -e
> 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g'
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath
> | xargs sed -i -e
> 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g;
> s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g'
> -e
> 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g'
> -e
> 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g'
> -e
> 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g'
> -e
> 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g'
> -e
> 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'
>
> | DEBUG: Python function extend_recipe_sysroot finished
>
> | DEBUG: Executing python function set_image_size
>
> | DEBUG: 27409.200000 = 21084 * 1.300000
>
> | DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0
>
> | DEBUG: 27410.000000 = int(27409.200000)
>
> | DEBUG: 27410 = aligned(27410)
>
> | DEBUG: returning 27410
>
> | DEBUG: Python function set_image_size finished
>
> | DEBUG: Executing shell function do_image_ext4
>
> | DEBUG: Executing dd if=/dev/zero
> of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4
> seek=27410 count=0 bs=1024
>
> | 0+0 records in
>
> | 0+0 records out
>
> | 0 bytes copied, 6.4388e-05 s, 0.0 kB/s
>
> | DEBUG: Actual Rootfs size:  19988
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | DEBUG: Actual Partion size: 28067840
>
> | DEBUG: Executing mkfs.ext4 -F -i 4096
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4
> -d
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | WARNING: exit code 139 from a shell command.
>
> | Segmentation fault (core dumped)
>
> ERROR: Task
> (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4)
> failed with exit code '1'
>
> NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be
> rerun and 1 failed.
>
>
>
> Summary: 1 task failed:
>
>
> /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:
> do_image_ext4
>
> Summary: There were 2 WARNING messages.
>
> Summary: There was 1 ERROR message, returning a non-zero exit code.
>
>
>
>
>
> ====* I rolled back the revision of poky  to check the issue,  the commit
> of  "uninative: Upgrade to 3.10 to support gcc 13" introduced it.* ====
>
>
>
> commit aab6fc20de9473d8d7f277332601cbae70c53320
>
> Author: Michael Halstead <mhalstead@linuxfoundation.org>
>
> Date:   Fri May 26 10:21:48 2023 -0700
>
>
>
>     uninative: Upgrade to 3.10 to support gcc 13
>
>
>
>     (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)
>
>
>
>     Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
> commit 51d6afc92f621657f800171a992cea7708261d31
>
> Author: Richard Purdie <richard.purdie@linuxfoundation.org>
>
> Date:   Wed Jun 7 17:27:36 2023 +0100
>
>
>
>     selftest/reproducible: Allow native/cross reuse in test
>
>
>
>     We don't compare reproducibility of the native/cross components, only
> the
>
>     target ones. With the long build times of rust-native, the test now
> takes
>
>     crazy lengths of time so this tweak should allow us to reuse
> native/cross
>
>     artefacts from sstate whilst still testing the target output is
>
>     reproducible.
>
>
>
>     (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)
>
>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#60757):
> https://lists.yoctoproject.org/g/yocto/message/60757
> Mute This Topic: https://lists.yoctoproject.org/mt/100638466/3617156
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [
> Martin.Jansa@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>
>

[-- Attachment #2: Type: text/html, Size: 23738 bytes --]

^ permalink raw reply	[flat|nested] 8+ messages in thread
* RE: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-10 17:34 ` Martin Jansa
@ 2023-08-15 14:05   ` Ming Wen
  2023-08-15 14:42     ` Martin Jansa
  0 siblings, 1 reply; 8+ messages in thread
From: Ming Wen @ 2023-08-15 14:05 UTC (permalink / raw)
  To: Martin Jansa; +Cc: yocto


[-- Attachment #1.1: Type: text/plain, Size: 14283 bytes --]

Hi Martin:

Nice to meet you and thanks for the help. We will take a try soon.

Best Regards!
________________________________
[Ambarella AI Envisioned]<https://www.ambarella.com/>



Ming Wen (闻明)
SDK Team | Ambarella Shanghai

Phone: +86-021-60880608-511
Email: mwen@ambarella.com<mailto:mwen@ambarella.com>


From: yocto@lists.yoctoproject.org <yocto@lists.yoctoproject.org> On Behalf Of Martin Jansa
Sent: Friday, August 11, 2023 1:35 AM
To: Ming Wen <mwen@ambarella.com>
Cc: yocto@lists.yoctoproject.org
Subject: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.

See https://patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/<https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj0sJlUJl$> which is easy to backport work around to fix uninative-3.9 and 4.0.

Until uninative-4.1 with more proper fix (https://patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/<https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj8F9otaB$>) is released and configured to be used in dunfell, kirkstone, mickledore and master.

Regards,

On Wed, Aug 9, 2023 at 9:00 AM Ming Wen <mwen@ambarella.com<mailto:mwen@ambarella.com>> wrote:
Hi,

We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to the latest version. But sadly, hit below error when trying to use it to compile the code on ubuntu 18.04. For comparison, ubuntu 22.04 is OK.

Through narrowing down, we found below clues. It should be caused by some of recent updates to Poky.
It is appreciated if any of Yocto maintainer could help to give a quick fix. :)

To make things simper, the test example is from official quick build manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html<https://urldefense.com/v3/__https:/docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj_YmEl0K$> ).

==== Segmentation fault of mkfs.ext4, which is provided by the package of e2fsprogs-native . ====



jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal

WARNING: You are using a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.

Loading cache: 100% |                                                                                                                                   | ETA:  --:--:--

Loaded 0 entries from dependency cache.

Parsing recipes: 100% |##################################################################################################################################| Time: 0:00:17

Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45 skipped, 0 masked, 0 errors.

NOTE: Resolving any missing task queue dependencies



Build Configuration:

BB_VERSION           = "2.0.0"

BUILD_SYS            = "x86_64-linux"

NATIVELSBSTRING      = "ubuntu-18.04"

TARGET_SYS           = "x86_64-poky-linux"

MACHINE              = "qemux86-64"

DISTRO               = "poky"

DISTRO_VERSION       = "4.0.12"

TUNE_FEATURES        = "m64 core2"

TARGET_FPU           = ""

meta

meta-poky

meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"

meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"



Initialising tasks: 100% |###############################################################################################################################| Time: 0:00:01

Checking sstate mirror object availability: 100% |#######################################################################################################| Time: 0:00:05

Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46% match, 0% complete)

NOTE: Executing Tasks

WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL http://www.openssl.org/source/openssl-3.0.10.tar.gz<https://urldefense.com/v3/__http:/www.openssl.org/source/openssl-3.0.10.tar.gz__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj-Kh_brC$>, attempting MIRRORS if available

ERROR: core-image-minimal-1.0-r0 do_image_ext4: ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796', 139, None, None)

ERROR: Logfile of failure stored in: /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796

Log data follows:

| DEBUG: Executing python function extend_recipe_sysroot

| NOTE: Direct dependencies are ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:do_populate_sysroot']

| NOTE: Installed into sysroot: ['e2fsprogs-native']

| NOTE: Skipping as already exists in sysroot: ['cross-localedef-native', 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross', 'update-rc.d-native', 'createrepo-c-native', 'dnf-native', 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native', 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native', 'librepo-native', 'gettext-minimal-native', 'libdnf-native', 'python3-iniparse-native', 'libcomps-native', 'cmake-native', 'python3-native', 'perl-native', 'zlib-native', 'attr-native', 'libtool-native', 'texinfo-dummy-native', 'util-linux-native', 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native', 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native', 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native', 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native', 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native', 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native', 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native', 'python3-wheel-native', 'python3-setuptools-native', 'python3-installer-native', 'ncurses-native', 'libnsl2-native', 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native', 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native', 'libcap-ng-native', 'itstool-native', 'libgpg-error-native', 'libcap-native', 'libmicrohttpd-native', 'gettext-native', 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native', 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native', 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native', 'libidn2-native', 'gnu-config-native']

| DEBUG: sed -e 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g' /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath | xargs sed -i -e 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g; s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g' -e 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g' -e 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g' -e 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g' -e 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g' -e 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'

| DEBUG: Python function extend_recipe_sysroot finished

| DEBUG: Executing python function set_image_size

| DEBUG: 27409.200000 = 21084 * 1.300000

| DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0

| DEBUG: 27410.000000 = int(27409.200000)

| DEBUG: 27410 = aligned(27410)

| DEBUG: returning 27410

| DEBUG: Python function set_image_size finished

| DEBUG: Executing shell function do_image_ext4

| DEBUG: Executing dd if=/dev/zero of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 seek=27410 count=0 bs=1024

| 0+0 records in

| 0+0 records out

| 0 bytes copied, 6.4388e-05 s, 0.0 kB/s

| DEBUG: Actual Rootfs size:  19988 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| DEBUG: Actual Partion size: 28067840

| DEBUG: Executing mkfs.ext4 -F -i 4096 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 -d /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| WARNING: exit code 139 from a shell command.

| Segmentation fault (core dumped)

ERROR: Task (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4) failed with exit code '1'

NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be rerun and 1 failed.



Summary: 1 task failed:

  /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4

Summary: There were 2 WARNING messages.

Summary: There was 1 ERROR message, returning a non-zero exit code.





==== I rolled back the revision of poky  to check the issue,  the commit of  "uninative: Upgrade to 3.10 to support gcc 13" introduced it. ====



commit aab6fc20de9473d8d7f277332601cbae70c53320

Author: Michael Halstead <mhalstead@linuxfoundation.org<mailto:mhalstead@linuxfoundation.org>>

Date:   Fri May 26 10:21:48 2023 -0700



    uninative: Upgrade to 3.10 to support gcc 13



    (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)



    Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org<mailto:mhalstead@linuxfoundation.org>>

    Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

    (cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)

    Signed-off-by: Steve Sakoman <steve@sakoman.com<mailto:steve@sakoman.com>>



commit 51d6afc92f621657f800171a992cea7708261d31

Author: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

Date:   Wed Jun 7 17:27:36 2023 +0100



    selftest/reproducible: Allow native/cross reuse in test



    We don't compare reproducibility of the native/cross components, only the

    target ones. With the long build times of rust-native, the test now takes

    crazy lengths of time so this tweak should allow us to reuse native/cross

    artefacts from sstate whilst still testing the target output is

    reproducible.



    (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)



    Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

    (cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)

    Signed-off-by: Steve Sakoman <steve@sakoman.com<mailto:steve@sakoman.com>>




________________________________
This EXTERNAL email has been scanned by Proofpoint Email Protect service.

**********************************************************************
This email and attachments contain Ambarella Proprietary and/or Confidential Information and is intended solely for the use of the individual(s) to whom it is addressed. Any unauthorized review, use, disclosure, distribute, copy, or print is prohibited. If you are not an intended recipient, please contact the sender by reply email and destroy all copies of the original message. Thank you.

[-- Attachment #1.2: Type: text/html, Size: 35550 bytes --]

[-- Attachment #2: image002.png --]
[-- Type: image/png, Size: 12782 bytes --]

^ permalink raw reply	[flat|nested] 8+ messages in thread
* Re: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-15 14:05   ` [EXT] " Ming Wen
@ 2023-08-15 14:42     ` Martin Jansa
  2023-08-15 14:46       ` Ming Wen
  0 siblings, 1 reply; 8+ messages in thread
From: Martin Jansa @ 2023-08-15 14:42 UTC (permalink / raw)
  To: Ming Wen; +Cc: yocto


[-- Attachment #1.1: Type: text/plain, Size: 14867 bytes --]

uninative 4.1 was already released, you can backport:
https://git.openembedded.org/openembedded-core/commit/?id=1c5c8ff97ba0a7f9adc592d702b865b3d166a24b
instead to fix this.

On Tue, Aug 15, 2023 at 4:06 PM Ming Wen <mwen@ambarella.com> wrote:

> *Hi Martin:*
>
>
>
> Nice to meet you and thanks for the help. We will take a try soon.
>
>
>
> *Best Regards!*
> ------------------------------
>
> [image: Ambarella AI Envisioned] <https://www.ambarella.com/>
>
>
>
>
>
>
>
> *Ming Wen (**闻明**)*
>
> SDK Team | Ambarella Shanghai
>
>
>
> *Phone: *+86-021-60880608-511
>
> *Email: *mwen@ambarella.com
>
>
>
>
>
> *From:* yocto@lists.yoctoproject.org <yocto@lists.yoctoproject.org> *On
> Behalf Of *Martin Jansa
> *Sent:* Friday, August 11, 2023 1:35 AM
> *To:* Ming Wen <mwen@ambarella.com>
> *Cc:* yocto@lists.yoctoproject.org
> *Subject:* [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last
> poky-kirkstone can't work on ubuntu 18.04.
>
>
>
> See
> https://patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/
> <https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj0sJlUJl$>
> which is easy to backport work around to fix uninative-3.9 and 4.0.
>
>
>
> Until uninative-4.1 with more proper fix (
> https://patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/
> <https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj8F9otaB$>)
> is released and configured to be used in dunfell, kirkstone, mickledore and
> master.
>
>
>
> Regards,
>
>
>
> On Wed, Aug 9, 2023 at 9:00 AM Ming Wen <mwen@ambarella.com> wrote:
>
> Hi,
>
> We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to
> the latest version. But sadly, hit below error when trying to use it to
> compile the code on *ubuntu 18.04*. For comparison, ubuntu 22.04 is OK.
>
> Through narrowing down, we found below clues. It should be caused by some
> of recent updates to Poky.
> It is appreciated if any of Yocto maintainer could help to give a quick
> fix. :)
>
> *To make things simper, the test example is from* *official quick build
> manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html
> <https://urldefense.com/v3/__https:/docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj_YmEl0K$> ).*
>
> ==== *Segmentation fault of mkfs.ext4, which is provided by the package
> of e2fsprogs-native .* ====
>
>
>
> jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal
>
> WARNING: You are using a local hash equivalence server but have configured
> an sstate mirror. This will likely mean no sstate will match from the
> mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or
> use a hash equivalence server alongside the sstate mirror.
>
> Loading cache: 100% |
>
>   | ETA:  --:--:--
>
> Loaded 0 entries from dependency cache.
>
> Parsing recipes: 100%
> |##################################################################################################################################|
> Time: 0:00:17
>
> Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45
> skipped, 0 masked, 0 errors.
>
> NOTE: Resolving any missing task queue dependencies
>
>
>
> Build Configuration:
>
> BB_VERSION           = "2.0.0"
>
> BUILD_SYS            = "x86_64-linux"
>
> NATIVELSBSTRING      = "ubuntu-18.04"
>
> TARGET_SYS           = "x86_64-poky-linux"
>
> MACHINE              = "qemux86-64"
>
> DISTRO               = "poky"
>
> DISTRO_VERSION       = "4.0.12"
>
> TUNE_FEATURES        = "m64 core2"
>
> TARGET_FPU           = ""
>
> meta
>
> meta-poky
>
> meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"
>
> meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"
>
>
>
> Initialising tasks: 100%
> |###############################################################################################################################|
> Time: 0:00:01
>
> Checking sstate mirror object availability: 100%
> |#######################################################################################################|
> Time: 0:00:05
>
> Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46%
> match, 0% complete)
>
> NOTE: Executing Tasks
>
> WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL
> http://www.openssl.org/source/openssl-3.0.10.tar.gz
> <https://urldefense.com/v3/__http:/www.openssl.org/source/openssl-3.0.10.tar.gz__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj-Kh_brC$>,
> attempting MIRRORS if available
>
> ERROR: core-image-minimal-1.0-r0 do_image_ext4:
> ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796',
> 139, None, None)
>
> ERROR: Logfile of failure stored in:
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796
>
> Log data follows:
>
> | DEBUG: Executing python function extend_recipe_sysroot
>
> | NOTE: Direct dependencies are
> ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot',
> '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot',
> 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:
> do_populate_sysroot']
>
> | NOTE: Installed into sysroot: ['e2fsprogs-native']
>
> | NOTE: Skipping as already exists in sysroot: ['cross-localedef-native',
> 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross',
> 'update-rc.d-native', 'createrepo-c-native', 'dnf-native',
> 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native',
> 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native',
> 'librepo-native', 'gettext-minimal-native', 'libdnf-native',
> 'python3-iniparse-native', 'libcomps-native', 'cmake-native',
> 'python3-native', 'perl-native', 'zlib-native', 'attr-native',
> 'libtool-native', 'texinfo-dummy-native', 'util-linux-native',
> 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native',
> 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native',
> 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native',
> 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native',
> 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native',
> 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native',
> 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native',
> 'python3-wheel-native', 'python3-setuptools-native',
> 'python3-installer-native', 'ncurses-native', 'libnsl2-native',
> 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native',
> 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native',
> 'libcap-ng-native', 'itstool-native', 'libgpg-error-native',
> 'libcap-native', 'libmicrohttpd-native', 'gettext-native',
> 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native',
> 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native',
> 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native',
> 'libidn2-native', 'gnu-config-native']
>
> | DEBUG: sed -e
> 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g'
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath
> | xargs sed -i -e
> 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g;
> s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g'
> -e
> 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g'
> -e
> 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g'
> -e
> 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g'
> -e
> 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g'
> -e
> 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'
>
> | DEBUG: Python function extend_recipe_sysroot finished
>
> | DEBUG: Executing python function set_image_size
>
> | DEBUG: 27409.200000 = 21084 * 1.300000
>
> | DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0
>
> | DEBUG: 27410.000000 = int(27409.200000)
>
> | DEBUG: 27410 = aligned(27410)
>
> | DEBUG: returning 27410
>
> | DEBUG: Python function set_image_size finished
>
> | DEBUG: Executing shell function do_image_ext4
>
> | DEBUG: Executing dd if=/dev/zero
> of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4
> seek=27410 count=0 bs=1024
>
> | 0+0 records in
>
> | 0+0 records out
>
> | 0 bytes copied, 6.4388e-05 s, 0.0 kB/s
>
> | DEBUG: Actual Rootfs size:  19988
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | DEBUG: Actual Partion size: 28067840
>
> | DEBUG: Executing mkfs.ext4 -F -i 4096
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4
> -d
> /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
>
> | WARNING: exit code 139 from a shell command.
>
> | Segmentation fault (core dumped)
>
> ERROR: Task
> (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4)
> failed with exit code '1'
>
> NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be
> rerun and 1 failed.
>
>
>
> Summary: 1 task failed:
>
>
> /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:
> do_image_ext4
>
> Summary: There were 2 WARNING messages.
>
> Summary: There was 1 ERROR message, returning a non-zero exit code.
>
>
>
>
>
> ====* I rolled back the revision of poky  to check the issue,  the commit
> of  "uninative: Upgrade to 3.10 to support gcc 13" introduced it.* ====
>
>
>
> commit aab6fc20de9473d8d7f277332601cbae70c53320
>
> Author: Michael Halstead <mhalstead@linuxfoundation.org>
>
> Date:   Fri May 26 10:21:48 2023 -0700
>
>
>
>     uninative: Upgrade to 3.10 to support gcc 13
>
>
>
>     (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)
>
>
>
>     Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
> commit 51d6afc92f621657f800171a992cea7708261d31
>
> Author: Richard Purdie <richard.purdie@linuxfoundation.org>
>
> Date:   Wed Jun 7 17:27:36 2023 +0100
>
>
>
>     selftest/reproducible: Allow native/cross reuse in test
>
>
>
>     We don't compare reproducibility of the native/cross components, only
> the
>
>     target ones. With the long build times of rust-native, the test now
> takes
>
>     crazy lengths of time so this tweak should allow us to reuse
> native/cross
>
>     artefacts from sstate whilst still testing the target output is
>
>     reproducible.
>
>
>
>     (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)
>
>
>
>     Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>
>
>     (cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)
>
>     Signed-off-by: Steve Sakoman <steve@sakoman.com>
>
>
>
>
>
> ------------------------------
>
> This EXTERNAL email has been scanned by Proofpoint Email Protect service.
> ------------------------------
> This email and attachments contain Ambarella Proprietary and/or
> Confidential Information and is intended solely for the use of the
> individual(s) to whom it is addressed. Any unauthorized review, use,
> disclosure, distribute, copy, or print is prohibited. If you are not an
> intended recipient, please contact the sender by reply email and destroy
> all copies of the original message. Thank you.
>

[-- Attachment #1.2: Type: text/html, Size: 33435 bytes --]

[-- Attachment #2: image002.png --]
[-- Type: image/png, Size: 12782 bytes --]

^ permalink raw reply	[flat|nested] 8+ messages in thread
* RE: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.
  2023-08-15 14:42     ` Martin Jansa
@ 2023-08-15 14:46       ` Ming Wen
  0 siblings, 0 replies; 8+ messages in thread
From: Ming Wen @ 2023-08-15 14:46 UTC (permalink / raw)
  To: Martin Jansa; +Cc: yocto


[-- Attachment #1.1: Type: text/plain, Size: 15600 bytes --]

Hi Martin:

Good news. Thanks~~

Best Regards!
________________________________
[Ambarella AI Envisioned]<https://www.ambarella.com/>



Ming Wen (闻明)
SDK Team | Ambarella Shanghai

Phone: +86-021-60880608-511
Email: mwen@ambarella.com<mailto:mwen@ambarella.com>


From: yocto@lists.yoctoproject.org <yocto@lists.yoctoproject.org> On Behalf Of Martin Jansa
Sent: Tuesday, August 15, 2023 10:42 PM
To: Ming Wen <mwen@ambarella.com>
Cc: yocto@lists.yoctoproject.org
Subject: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.

uninative 4.1 was already released, you can backport:
https://git.openembedded.org/openembedded-core/commit/?id=1c5c8ff97ba0a7f9adc592d702b865b3d166a24b<https://urldefense.com/v3/__https:/git.openembedded.org/openembedded-core/commit/?id=1c5c8ff97ba0a7f9adc592d702b865b3d166a24b__;!!PeEy7nZLVv0!g5Pnb3aHVpD1MlhvpBg4MjlkVlI10SYCHO7-NnzUcjkbXQboSjaabMFDoQLiW1pT6NIEfyRFnUBSk9Tbobcl$>
instead to fix this.

On Tue, Aug 15, 2023 at 4:06 PM Ming Wen <mwen@ambarella.com<mailto:mwen@ambarella.com>> wrote:
Hi Martin:

Nice to meet you and thanks for the help. We will take a try soon.

Best Regards!
________________________________
[Ambarella AI Envisioned]<https://www.ambarella.com/>



Ming Wen (闻明)
SDK Team | Ambarella Shanghai

Phone: +86-021-60880608-511
Email: mwen@ambarella.com<mailto:mwen@ambarella.com>


From: yocto@lists.yoctoproject.org<mailto:yocto@lists.yoctoproject.org> <yocto@lists.yoctoproject.org<mailto:yocto@lists.yoctoproject.org>> On Behalf Of Martin Jansa
Sent: Friday, August 11, 2023 1:35 AM
To: Ming Wen <mwen@ambarella.com<mailto:mwen@ambarella.com>>
Cc: yocto@lists.yoctoproject.org<mailto:yocto@lists.yoctoproject.org>
Subject: [EXT] Re: [yocto] [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04.

See https://patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/<https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230623093323.4058529-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj0sJlUJl$> which is easy to backport work around to fix uninative-3.9 and 4.0.

Until uninative-4.1 with more proper fix (https://patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/<https://urldefense.com/v3/__https:/patchwork.yoctoproject.org/project/oe-core/patch/20230731191005.3466888-1-Martin.Jansa@gmail.com/__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj8F9otaB$>) is released and configured to be used in dunfell, kirkstone, mickledore and master.

Regards,

On Wed, Aug 9, 2023 at 9:00 AM Ming Wen <mwen@ambarella.com<mailto:mwen@ambarella.com>> wrote:
Hi,

We're using Poky-Kirkstone for Yocto. Now we're trying to upgrade it to the latest version. But sadly, hit below error when trying to use it to compile the code on ubuntu 18.04. For comparison, ubuntu 22.04 is OK.

Through narrowing down, we found below clues. It should be caused by some of recent updates to Poky.
It is appreciated if any of Yocto maintainer could help to give a quick fix. :)

To make things simper, the test example is from official quick build manual( https://docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html<https://urldefense.com/v3/__https:/docs.yoctoproject.org/4.0.11/brief-yoctoprojectqs/index.html__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj_YmEl0K$> ).

==== Segmentation fault of mkfs.ext4, which is provided by the package of e2fsprogs-native . ====



jleng@jleng:~/data/cbuild-ng/build/qemux86-64$ bitbake core-image-minimal

WARNING: You are using a local hash equivalence server but have configured an sstate mirror. This will likely mean no sstate will match from the mirror. You may wish to disable the hash equivalence use (BB_HASHSERVE), or use a hash equivalence server alongside the sstate mirror.

Loading cache: 100% |                                                                                                                                   | ETA:  --:--:--

Loaded 0 entries from dependency cache.

Parsing recipes: 100% |##################################################################################################################################| Time: 0:00:17

Parsing of 886 .bb files complete (0 cached, 886 parsed). 1648 targets, 45 skipped, 0 masked, 0 errors.

NOTE: Resolving any missing task queue dependencies



Build Configuration:

BB_VERSION           = "2.0.0"

BUILD_SYS            = "x86_64-linux"

NATIVELSBSTRING      = "ubuntu-18.04"

TARGET_SYS           = "x86_64-poky-linux"

MACHINE              = "qemux86-64"

DISTRO               = "poky"

DISTRO_VERSION       = "4.0.12"

TUNE_FEATURES        = "m64 core2"

TARGET_FPU           = ""

meta

meta-poky

meta-yocto-bsp       = "kirkstone:d6b8790370500b99ca11f0d8a05c39b661ab2ba6"

meta-cbuild          = "main:fd1231d7002a0bd6e563d80782140b7c6eb549c1"



Initialising tasks: 100% |###############################################################################################################################| Time: 0:00:01

Checking sstate mirror object availability: 100% |#######################################################################################################| Time: 0:00:05

Sstate summary: Wanted 1397 Local 647 Mirrors 0 Missed 750 Current 0 (46% match, 0% complete)

NOTE: Executing Tasks

WARNING: openssl-native-3.0.10-r0 do_fetch: Failed to fetch URL http://www.openssl.org/source/openssl-3.0.10.tar.gz<https://urldefense.com/v3/__http:/www.openssl.org/source/openssl-3.0.10.tar.gz__;!!PeEy7nZLVv0!mGazcAcBmVhkAt-fFXp4dSVyIKGWUeiJengnAmsESk_cQOAHxwFsMngyUlF3XKh2SxG2BIWLa2erj-Kh_brC$>, attempting MIRRORS if available

ERROR: core-image-minimal-1.0-r0 do_image_ext4: ExecutionError('/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/run.do_image_ext4.22796', 139, None, None)

ERROR: Logfile of failure stored in: /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/log.do_image_ext4.22796

Log data follows:

| DEBUG: Executing python function extend_recipe_sysroot

| NOTE: Direct dependencies are ['/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/cross-localedef-native_2.35.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/glibc/ldconfig-native_2.12.1.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/qemu/qemuwrapper-cross_1.0.bb:do_populate_sysroot', '/home/jleng/data/cbuild-ng/build/poky/meta/recipes-kernel/kmod/depmodwrapper-cross_1.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/update-rc.d/update-rc.d_0.8.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/createrepo-c/createrepo-c_0.19.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/dnf/dnf_4.11.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/e2fsprogs/e2fsprogs_1.46.5.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/makedevs/makedevs_1.0.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg-utils/opkg-utils_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/opkg/opkg_0.5.0.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/pseudo/pseudo_git.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-devtools/rpm/rpm_4.17.1.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pbzip2/pbzip2_1.1.13.bb:do_populate_sysroot', 'virtual:native:/home/jleng/data/cbuild-ng/build/poky/meta/recipes-extended/pigz/pigz_2.7.bb:do_populate_sysroot']

| NOTE: Installed into sysroot: ['e2fsprogs-native']

| NOTE: Skipping as already exists in sysroot: ['cross-localedef-native', 'ldconfig-native', 'qemuwrapper-cross', 'depmodwrapper-cross', 'update-rc.d-native', 'createrepo-c-native', 'dnf-native', 'makedevs-native', 'opkg-utils-native', 'opkg-native', 'pseudo-native', 'rpm-native', 'pbzip2-native', 'pigz-native', 'bzip2-native', 'librepo-native', 'gettext-minimal-native', 'libdnf-native', 'python3-iniparse-native', 'libcomps-native', 'cmake-native', 'python3-native', 'perl-native', 'zlib-native', 'attr-native', 'libtool-native', 'texinfo-dummy-native', 'util-linux-native', 'openssl-native', 'debianutils-native', 'kmod-native', 'shadow-native', 'shared-mime-info-native', 'file-native', 'lua-native', 'sqlite3-native', 'zstd-native', 'popt-native', 'libgcrypt-native', 'xz-native', 'elfutils-native', 'qemu-native', 'curl-native', 'libxml2-native', 'glib-2.0-native', 'expat-native', 'libarchive-native', 'libsolv-native', 'gpgme-native', 'libmodulemd-native', 'gobject-introspection-native', 'libcheck-native', 'json-c-native', 'swig-native', 'python3-six-native', 'python3-wheel-native', 'python3-setuptools-native', 'python3-installer-native', 'ncurses-native', 'libnsl2-native', 'libffi-native', 'libtirpc-native', 'util-linux-libuuid-native', 'gdbm-native', 'readline-native', 'make-native', 'libpcre2-native', 'libcap-ng-native', 'itstool-native', 'libgpg-error-native', 'libcap-native', 'libmicrohttpd-native', 'gettext-native', 'libpcre-native', 'lzo-native', 'libassuan-native', 'libyaml-native', 'flex-native', 'python3-flit-core-native', 'unzip-native', 'gnutls-native', 'm4-native', 'nettle-native', 'libunistring-native', 'gmp-native', 'libidn2-native', 'gnu-config-native']

| DEBUG: sed -e 's:^[^/]*/:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native/:g' /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/e2fsprogs-native/fixmepath | xargs sed -i -e 's:FIXMESTAGINGDIRTARGET:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot:g; s:FIXMESTAGINGDIRHOST:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/recipe-sysroot-native:g' -e 's:FIXME_PSEUDO_SYSROOT:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/sysroots-components/x86_64/pseudo-native:g' -e 's:FIXME_HOSTTOOLS_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/hosttools:g' -e 's:FIXME_PKGDATA_DIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/pkgdata/qemux86-64:g' -e 's:FIXME_PSEUDO_LOCALSTATEDIR:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/pseudo/:g' -e 's:FIXME_LOGFIFO:/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/temp/fifo.22796:g'

| DEBUG: Python function extend_recipe_sysroot finished

| DEBUG: Executing python function set_image_size

| DEBUG: 27409.200000 = 21084 * 1.300000

| DEBUG: 27409.200000 = max(27409.200000, 8192)[27409.200000] + 0

| DEBUG: 27410.000000 = int(27409.200000)

| DEBUG: 27410 = aligned(27410)

| DEBUG: returning 27410

| DEBUG: Python function set_image_size finished

| DEBUG: Executing shell function do_image_ext4

| DEBUG: Executing dd if=/dev/zero of=/home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 seek=27410 count=0 bs=1024

| 0+0 records in

| 0+0 records out

| 0 bytes copied, 6.4388e-05 s, 0.0 kB/s

| DEBUG: Actual Rootfs size:  19988 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| DEBUG: Actual Partion size: 28067840

| DEBUG: Executing mkfs.ext4 -F -i 4096 /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230808061549.rootfs.ext4 -d /home/jleng/data/cbuild-ng/build/qemux86-64/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs

| WARNING: exit code 139 from a shell command.

| Segmentation fault (core dumped)

ERROR: Task (/home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4) failed with exit code '1'

NOTE: Tasks Summary: Attempted 3592 tasks of which 1187 didn't need to be rerun and 1 failed.



Summary: 1 task failed:

  /home/jleng/data/cbuild-ng/build/poky/meta/recipes-core/images/core-image-minimal.bb:do_image_ext4

Summary: There were 2 WARNING messages.

Summary: There was 1 ERROR message, returning a non-zero exit code.





==== I rolled back the revision of poky  to check the issue,  the commit of  "uninative: Upgrade to 3.10 to support gcc 13" introduced it. ====



commit aab6fc20de9473d8d7f277332601cbae70c53320

Author: Michael Halstead <mhalstead@linuxfoundation.org<mailto:mhalstead@linuxfoundation.org>>

Date:   Fri May 26 10:21:48 2023 -0700



    uninative: Upgrade to 3.10 to support gcc 13



    (From OE-Core rev: dbf2a81d42b48c22864f64425672315158eb99cb)



    Signed-off-by: Michael Halstead <mhalstead@linuxfoundation.org<mailto:mhalstead@linuxfoundation.org>>

    Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

    (cherry picked from commit f811bffb861b23238e8291394bd6e8407f013619)

    Signed-off-by: Steve Sakoman <steve@sakoman.com<mailto:steve@sakoman.com>>



commit 51d6afc92f621657f800171a992cea7708261d31

Author: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

Date:   Wed Jun 7 17:27:36 2023 +0100



    selftest/reproducible: Allow native/cross reuse in test



    We don't compare reproducibility of the native/cross components, only the

    target ones. With the long build times of rust-native, the test now takes

    crazy lengths of time so this tweak should allow us to reuse native/cross

    artefacts from sstate whilst still testing the target output is

    reproducible.



    (From OE-Core rev: 18a9596ae711ba37ac7e44e46744298ba79ae320)



    Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org<mailto:richard.purdie@linuxfoundation.org>>

    (cherry picked from commit b494d83c639a877cefeb7cbab6d37195e492f059)

    Signed-off-by: Steve Sakoman <steve@sakoman.com<mailto:steve@sakoman.com>>



________________________________
This EXTERNAL email has been scanned by Proofpoint Email Protect service.
________________________________
This email and attachments contain Ambarella Proprietary and/or Confidential Information and is intended solely for the use of the individual(s) to whom it is addressed. Any unauthorized review, use, disclosure, distribute, copy, or print is prohibited. If you are not an intended recipient, please contact the sender by reply email and destroy all copies of the original message. Thank you.
________________________________
This EXTERNAL email has been scanned by Proofpoint Email Protect service.

[-- Attachment #1.2: Type: text/html, Size: 44142 bytes --]

[-- Attachment #2: image001.png --]
[-- Type: image/png, Size: 12782 bytes --]

[-- Attachment #3: image002.png --]
[-- Type: image/png, Size: 12782 bytes --]

^ permalink raw reply	[flat|nested] 8+ messages in thread
end of thread, other threads:[~2023-08-15 14:46 UTC | newest]

Thread overview: 8+ messages (download: mbox.gz / follow: Atom feed)
-- links below jump to the message on this page --
2023-08-09  7:00 [Poky-Kirkstone][Ubuntu 18.04] The last poky-kirkstone can't work on ubuntu 18.04 Ming Wen
2023-08-09  7:04 ` [yocto] " Alexander Kanavin
2023-08-09  8:18   ` [EXT] " Ming Wen
2023-08-09  8:27   ` Michael Opdenacker
2023-08-10 17:34 ` Martin Jansa
2023-08-15 14:05   ` [EXT] " Ming Wen
2023-08-15 14:42     ` Martin Jansa
2023-08-15 14:46       ` Ming Wen

