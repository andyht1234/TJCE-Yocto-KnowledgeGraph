* [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
@ 2023-03-27  6:16 Mikko Rapeli
  2023-03-27 13:51 ` Anton Antonov
  2023-04-01 12:50 ` [yocto] " akuster808
  0 siblings, 2 replies; 10+ messages in thread
From: Mikko Rapeli @ 2023-03-27  6:16 UTC (permalink / raw)
  To: yocto; +Cc: Mikko Rapeli

parsec-service 1.1.0 fails to compile with latest tpm2-tss update
in meta-security:

| error: failed to run custom build command for `tss-esapi v7.1.0`
|
| Caused by:
|   process didn't exit successfully:
`/oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/build/target/release/build/tss-esapi-5b5d9342bd16db73/build-script-build`
(exit status: 101)
|   --- stderr
|   thread 'main' panicked at 'Unsupported TSS version: 4',
/oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/cargo_home/bitbake/tss-esapi-7.1.0/build.rs:9:22

and also latest meta-clang changes break the build with:

|   thread 'main' panicked at '"enum_(unnamed_at_/oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1_1_0-r0/build/target/aarch64-trs-linux-gnu/release/build/psa-crypto-sys-b4f9ce2b7d8846b2/out/include/mbedtls/cipher_h_205_1)" is not a valid Ident', /oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/cargo_home/bitbake/proc-macro2-1.0.43/src/fallback.rs:730:9
|   stack backtrace:
|      0: rust_begin_unwind
|      1: core::panicking::panic_fmt
|      2: proc_macro2::fallback::validate_ident
|      3: proc_macro2::fallback::Ident::_new
|      4: proc_macro2::fallback::Ident::new
|      5: proc_macro2::imp::Ident::new
|      6: proc_macro2::Ident::new
|      7: bindgen::ir::context::BindgenContext::rust_ident_raw
|      8: bindgen::ir::context::BindgenContext::rust_ident
|      9: <bindgen::ir::enum_ty::Enum as bindgen::codegen::CodeGenerator>::codegen
|     10: <bindgen::ir::ty::Type as bindgen::codegen::CodeGenerator>::codegen
|     11: <bindgen::ir::item::Item as bindgen::codegen::CodeGenerator>::codegen
|     12: <bindgen::ir::module::Module as bindgen::codegen::CodeGenerator>::codegen::{{closure}}
|     13: <bindgen::ir::module::Module as bindgen::codegen::CodeGenerator>::codegen
|     14: <bindgen::ir::item::Item as bindgen::codegen::CodeGenerator>::codegen
|     15: bindgen::codegen::codegen::{{closure}}
|     16: bindgen::ir::context::BindgenContext::gen
|     17: bindgen::codegen::codegen
|     18: bindgen::Bindings::generate
|     19: bindgen::Builder::generate
|     20: build_script_build::common::generate_mbed_crypto_bindings
|     21: build_script_build::operations::script_operations
|     22: build_script_build::main
|     23: core::ops::function::FnOnce::call_once
|   note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.

In both cases fix is to update to the master branch or 1.2.0-rc1 pre-release.
Porting the individual patches did not work due to complex rust crate depencies.

Added LICENSE file checksum. Using cargo-update-recipe-crates.bbclass from
poky to maintain list of crates in the .inc file, but removed entries
for fuzz/Cargo.lock. Tested on qemu that parsec.service stars correctly
and works with swtpm use cases.

Signed-off-by: Mikko Rapeli <mikko.rapeli@linaro.org>
---
 ...ce_1.1.0.inc => parsec-service-crates.inc} | 239 +++++++++---------
 ...e_1.1.0.bb => parsec-service_1.2.0-rc1.bb} |  14 +-
 2 files changed, 134 insertions(+), 119 deletions(-)
 rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.inc => parsec-service-crates.inc} (50%)
 rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.bb => parsec-service_1.2.0-rc1.bb} (91%)

v3: change to gitsm fetcher

v2: removed crates for fuzz/Cargo.lock from SRC_URI
    https://lists.yoctoproject.org/g/yocto/message/59518

v1: https://lists.yoctoproject.org/g/yocto/message/59495
diff --git a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc b/meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
similarity index 50%
rename from meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc
rename to meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
index c04bcbd..fe80b42 100644
--- a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc
+++ b/meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
@@ -1,223 +1,232 @@
-# This file is created from parsec repository Cargo.lock using cargo-bitbake tool
+# Autogenerated with 'bitbake -c update_crates parsec-service'
 
+# from Cargo.lock
 SRC_URI += " \
     crate://crates.io/ahash/0.7.6 \
-    crate://crates.io/aho-corasick/0.7.19 \
+    crate://crates.io/aho-corasick/0.7.20 \
     crate://crates.io/ansi_term/0.12.1 \
-    crate://crates.io/anyhow/1.0.64 \
+    crate://crates.io/anyhow/1.0.69 \
+    crate://crates.io/asn1-rs/0.3.1 \
     crate://crates.io/asn1-rs-derive/0.1.0 \
     crate://crates.io/asn1-rs-impl/0.1.0 \
-    crate://crates.io/asn1-rs/0.3.1 \
     crate://crates.io/atty/0.2.14 \
     crate://crates.io/autocfg/1.1.0 \
-    crate://crates.io/base64/0.13.0 \
+    crate://crates.io/base64/0.13.1 \
     crate://crates.io/bincode/1.3.3 \
     crate://crates.io/bindgen/0.57.0 \
-    crate://crates.io/bindgen/0.59.2 \
+    crate://crates.io/bindgen/0.63.0 \
     crate://crates.io/bitfield/0.13.2 \
     crate://crates.io/bitflags/1.3.2 \
-    crate://crates.io/bumpalo/3.11.0 \
-    crate://crates.io/bytes/1.2.1 \
-    crate://crates.io/cc/1.0.73 \
+    crate://crates.io/bumpalo/3.12.0 \
+    crate://crates.io/bytes/1.4.0 \
+    crate://crates.io/cc/1.0.79 \
     crate://crates.io/cexpr/0.4.0 \
     crate://crates.io/cexpr/0.6.0 \
     crate://crates.io/cfg-if/1.0.0 \
-    crate://crates.io/clang-sys/1.3.3 \
+    crate://crates.io/clang-sys/1.6.0 \
     crate://crates.io/clap/2.34.0 \
     crate://crates.io/cmake/0.1.45 \
     crate://crates.io/const-oid/0.7.1 \
     crate://crates.io/cryptoauthlib-sys/0.2.2 \
-    crate://crates.io/cryptoki-sys/0.1.4 \
-    crate://crates.io/cryptoki/0.3.0 \
-    crate://crates.io/data-encoding/2.3.2 \
-    crate://crates.io/der-parser/7.0.0 \
+    crate://crates.io/cryptoki/0.3.1 \
+    crate://crates.io/cryptoki-sys/0.1.5 \
+    crate://crates.io/data-encoding/2.3.3 \
     crate://crates.io/der/0.5.1 \
+    crate://crates.io/der-parser/7.0.0 \
     crate://crates.io/derivative/2.2.0 \
     crate://crates.io/displaydoc/0.2.3 \
-    crate://crates.io/either/1.8.0 \
+    crate://crates.io/either/1.8.1 \
     crate://crates.io/enumflags2/0.7.5 \
     crate://crates.io/enumflags2_derive/0.7.4 \
     crate://crates.io/env_logger/0.8.4 \
-    crate://crates.io/env_logger/0.9.0 \
+    crate://crates.io/errno/0.2.8 \
+    crate://crates.io/errno-dragonfly/0.1.2 \
     crate://crates.io/fallible-iterator/0.2.0 \
     crate://crates.io/fallible-streaming-iterator/0.1.9 \
-    crate://crates.io/fastrand/1.8.0 \
+    crate://crates.io/fastrand/1.9.0 \
     crate://crates.io/fixedbitset/0.2.0 \
-    crate://crates.io/form_urlencoded/1.0.1 \
-    crate://crates.io/futures-channel/0.3.24 \
-    crate://crates.io/futures-core/0.3.24 \
-    crate://crates.io/futures-executor/0.3.24 \
-    crate://crates.io/futures-io/0.3.24 \
-    crate://crates.io/futures-macro/0.3.24 \
-    crate://crates.io/futures-sink/0.3.24 \
-    crate://crates.io/futures-task/0.3.24 \
-    crate://crates.io/futures-util/0.3.24 \
-    crate://crates.io/futures/0.3.24 \
+    crate://crates.io/form_urlencoded/1.1.0 \
+    crate://crates.io/futures/0.3.27 \
+    crate://crates.io/futures-channel/0.3.27 \
+    crate://crates.io/futures-core/0.3.27 \
+    crate://crates.io/futures-executor/0.3.27 \
+    crate://crates.io/futures-io/0.3.27 \
+    crate://crates.io/futures-macro/0.3.27 \
+    crate://crates.io/futures-sink/0.3.27 \
+    crate://crates.io/futures-task/0.3.27 \
+    crate://crates.io/futures-util/0.3.27 \
     crate://crates.io/generic-array/0.14.6 \
-    crate://crates.io/getrandom/0.2.7 \
-    crate://crates.io/glob/0.3.0 \
-    crate://crates.io/grpcio-sys/0.9.1+1.38.0 \
+    crate://crates.io/getrandom/0.2.8 \
+    crate://crates.io/glob/0.3.1 \
     crate://crates.io/grpcio/0.9.1 \
-    crate://crates.io/hashbrown/0.11.2 \
-    crate://crates.io/hashlink/0.7.0 \
+    crate://crates.io/grpcio-sys/0.9.1+1.38.0 \
+    crate://crates.io/hashbrown/0.12.3 \
+    crate://crates.io/hashlink/0.8.1 \
     crate://crates.io/heck/0.3.3 \
     crate://crates.io/hermit-abi/0.1.19 \
+    crate://crates.io/hermit-abi/0.2.6 \
     crate://crates.io/hex/0.4.3 \
     crate://crates.io/hostname-validator/1.1.1 \
     crate://crates.io/humantime/2.1.0 \
-    crate://crates.io/idna/0.2.3 \
-    crate://crates.io/indexmap/1.8.2 \
+    crate://crates.io/idna/0.3.0 \
+    crate://crates.io/indexmap/1.9.2 \
     crate://crates.io/instant/0.1.12 \
-    crate://crates.io/itertools/0.10.3 \
-    crate://crates.io/itoa/1.0.3 \
-    crate://crates.io/js-sys/0.3.59 \
+    crate://crates.io/io-lifetimes/1.0.6 \
+    crate://crates.io/itertools/0.10.5 \
+    crate://crates.io/itoa/1.0.6 \
+    crate://crates.io/js-sys/0.3.61 \
     crate://crates.io/jsonwebkey/0.3.5 \
-    crate://crates.io/jsonwebtoken/8.1.1 \
+    crate://crates.io/jsonwebtoken/8.2.0 \
     crate://crates.io/lazy_static/1.4.0 \
     crate://crates.io/lazycell/1.3.0 \
-    crate://crates.io/libc/0.2.132 \
-    crate://crates.io/libloading/0.7.3 \
-    crate://crates.io/libsqlite3-sys/0.23.2 \
+    crate://crates.io/libc/0.2.140 \
+    crate://crates.io/libloading/0.7.4 \
+    crate://crates.io/libsqlite3-sys/0.25.2 \
     crate://crates.io/libz-sys/1.1.8 \
-    crate://crates.io/lock_api/0.4.8 \
+    crate://crates.io/linux-raw-sys/0.1.4 \
+    crate://crates.io/lock_api/0.4.9 \
     crate://crates.io/log/0.4.17 \
-    crate://crates.io/matches/0.1.9 \
     crate://crates.io/mbox/0.6.0 \
     crate://crates.io/memchr/2.5.0 \
     crate://crates.io/minimal-lexical/0.2.1 \
     crate://crates.io/multimap/0.8.3 \
     crate://crates.io/nom/5.1.2 \
-    crate://crates.io/nom/7.1.1 \
+    crate://crates.io/nom/7.1.3 \
+    crate://crates.io/num/0.4.0 \
     crate://crates.io/num-bigint/0.4.3 \
-    crate://crates.io/num-complex/0.4.2 \
+    crate://crates.io/num-complex/0.4.3 \
     crate://crates.io/num-derive/0.3.3 \
     crate://crates.io/num-integer/0.1.45 \
     crate://crates.io/num-iter/0.1.43 \
     crate://crates.io/num-rational/0.4.1 \
     crate://crates.io/num-traits/0.2.15 \
-    crate://crates.io/num/0.4.0 \
-    crate://crates.io/num_cpus/1.13.1 \
+    crate://crates.io/num_cpus/1.15.0 \
     crate://crates.io/num_threads/0.1.6 \
-    crate://crates.io/oid-registry/0.4.0 \
     crate://crates.io/oid/0.2.1 \
-    crate://crates.io/once_cell/1.14.0 \
+    crate://crates.io/oid-registry/0.4.0 \
+    crate://crates.io/once_cell/1.17.1 \
     crate://crates.io/parking_lot/0.11.2 \
-    crate://crates.io/parking_lot_core/0.8.5 \
-    crate://crates.io/parsec-interface/0.27.0 \
+    crate://crates.io/parking_lot_core/0.8.6 \
+    crate://crates.io/parsec-interface/0.28.0 \
     crate://crates.io/peeking_take_while/0.1.2 \
-    crate://crates.io/pem/1.1.0 \
-    crate://crates.io/percent-encoding/2.1.0 \
-    crate://crates.io/pest/2.3.0 \
+    crate://crates.io/pem/1.1.1 \
+    crate://crates.io/percent-encoding/2.2.0 \
+    crate://crates.io/pest/2.5.6 \
     crate://crates.io/petgraph/0.5.1 \
+    crate://crates.io/picky-asn1/0.3.3 \
     crate://crates.io/picky-asn1-der/0.2.5 \
     crate://crates.io/picky-asn1-x509/0.6.1 \
-    crate://crates.io/picky-asn1/0.3.3 \
     crate://crates.io/pin-project-lite/0.2.9 \
     crate://crates.io/pin-utils/0.1.0 \
     crate://crates.io/pkcs8/0.8.0 \
-    crate://crates.io/pkg-config/0.3.25 \
-    crate://crates.io/ppv-lite86/0.2.16 \
-    crate://crates.io/proc-macro-error-attr/1.0.4 \
+    crate://crates.io/pkg-config/0.3.26 \
+    crate://crates.io/ppv-lite86/0.2.17 \
     crate://crates.io/proc-macro-error/1.0.4 \
-    crate://crates.io/proc-macro2/1.0.43 \
+    crate://crates.io/proc-macro-error-attr/1.0.4 \
+    crate://crates.io/proc-macro2/1.0.52 \
+    crate://crates.io/prost/0.8.0 \
     crate://crates.io/prost-build/0.8.0 \
     crate://crates.io/prost-derive/0.8.0 \
     crate://crates.io/prost-types/0.8.0 \
-    crate://crates.io/prost/0.8.0 \
-    crate://crates.io/protobuf/2.27.1 \
-    crate://crates.io/psa-crypto-sys/0.9.3 \
-    crate://crates.io/psa-crypto/0.9.2 \
-    crate://crates.io/quote/1.0.21 \
+    crate://crates.io/protobuf/2.28.0 \
+    crate://crates.io/psa-crypto/0.10.0 \
+    crate://crates.io/psa-crypto-sys/0.10.0 \
+    crate://crates.io/quote/1.0.26 \
     crate://crates.io/rand/0.8.5 \
     crate://crates.io/rand_chacha/0.3.1 \
-    crate://crates.io/rand_core/0.6.3 \
+    crate://crates.io/rand_core/0.6.4 \
     crate://crates.io/redox_syscall/0.2.16 \
-    crate://crates.io/regex-syntax/0.6.27 \
-    crate://crates.io/regex/1.6.0 \
-    crate://crates.io/remove_dir_all/0.5.3 \
+    crate://crates.io/regex/1.7.1 \
+    crate://crates.io/regex-syntax/0.6.28 \
     crate://crates.io/ring/0.16.20 \
-    crate://crates.io/rusqlite/0.26.3 \
+    crate://crates.io/rusqlite/0.28.0 \
     crate://crates.io/rust-cryptoauthlib/0.4.5 \
     crate://crates.io/rustc-hash/1.1.0 \
     crate://crates.io/rustc_version/0.3.3 \
     crate://crates.io/rusticata-macros/4.1.0 \
-    crate://crates.io/ryu/1.0.11 \
+    crate://crates.io/rustix/0.36.9 \
+    crate://crates.io/ryu/1.0.13 \
     crate://crates.io/same-file/1.0.6 \
     crate://crates.io/scopeguard/1.1.0 \
-    crate://crates.io/sd-notify/0.2.0 \
+    crate://crates.io/sd-notify/0.3.0 \
     crate://crates.io/secrecy/0.7.0 \
-    crate://crates.io/semver-parser/0.10.2 \
     crate://crates.io/semver/0.11.0 \
-    crate://crates.io/serde/1.0.144 \
-    crate://crates.io/serde_bytes/0.11.7 \
-    crate://crates.io/serde_derive/1.0.144 \
-    crate://crates.io/serde_json/1.0.85 \
+    crate://crates.io/semver-parser/0.10.2 \
+    crate://crates.io/serde/1.0.156 \
+    crate://crates.io/serde_bytes/0.11.9 \
+    crate://crates.io/serde_derive/1.0.156 \
+    crate://crates.io/serde_json/1.0.94 \
     crate://crates.io/shlex/0.1.1 \
     crate://crates.io/shlex/1.1.0 \
-    crate://crates.io/signal-hook-registry/1.4.0 \
-    crate://crates.io/signal-hook/0.3.14 \
+    crate://crates.io/signal-hook/0.3.15 \
+    crate://crates.io/signal-hook-registry/1.4.1 \
     crate://crates.io/simple_asn1/0.6.2 \
-    crate://crates.io/slab/0.4.7 \
-    crate://crates.io/smallvec/1.9.0 \
+    crate://crates.io/slab/0.4.8 \
+    crate://crates.io/smallvec/1.10.0 \
     crate://crates.io/spiffe/0.2.1 \
     crate://crates.io/spin/0.5.2 \
     crate://crates.io/spki/0.5.4 \
     crate://crates.io/stable_deref_trait/1.2.0 \
     crate://crates.io/strsim/0.8.0 \
-    crate://crates.io/structopt-derive/0.4.18 \
     crate://crates.io/structopt/0.3.26 \
+    crate://crates.io/structopt-derive/0.4.18 \
     crate://crates.io/strum_macros/0.21.1 \
-    crate://crates.io/syn/1.0.99 \
+    crate://crates.io/syn/1.0.109 \
     crate://crates.io/synstructure/0.12.6 \
-    crate://crates.io/target-lexicon/0.12.4 \
-    crate://crates.io/tempfile/3.3.0 \
-    crate://crates.io/termcolor/1.1.3 \
+    crate://crates.io/target-lexicon/0.12.6 \
+    crate://crates.io/tempfile/3.4.0 \
+    crate://crates.io/termcolor/1.2.0 \
     crate://crates.io/textwrap/0.11.0 \
-    crate://crates.io/thiserror-impl/1.0.33 \
-    crate://crates.io/thiserror/1.0.33 \
+    crate://crates.io/thiserror/1.0.39 \
+    crate://crates.io/thiserror-impl/1.0.39 \
     crate://crates.io/threadpool/1.8.1 \
+    crate://crates.io/time/0.3.15 \
     crate://crates.io/time-macros/0.2.4 \
-    crate://crates.io/time/0.3.14 \
     crate://crates.io/tinyvec/1.6.0 \
-    crate://crates.io/tinyvec_macros/0.1.0 \
-    crate://crates.io/toml/0.5.9 \
-    crate://crates.io/tss-esapi-sys/0.3.0 \
-    crate://crates.io/tss-esapi/7.1.0 \
-    crate://crates.io/typenum/1.15.0 \
-    crate://crates.io/ucd-trie/0.1.4 \
-    crate://crates.io/unicode-bidi/0.3.8 \
-    crate://crates.io/unicode-ident/1.0.3 \
-    crate://crates.io/unicode-normalization/0.1.21 \
-    crate://crates.io/unicode-segmentation/1.9.0 \
-    crate://crates.io/unicode-width/0.1.9 \
-    crate://crates.io/unicode-xid/0.2.3 \
+    crate://crates.io/tinyvec_macros/0.1.1 \
+    crate://crates.io/toml/0.5.11 \
+    crate://crates.io/tss-esapi/7.2.0 \
+    crate://crates.io/tss-esapi-sys/0.4.0 \
+    crate://crates.io/typenum/1.16.0 \
+    crate://crates.io/ucd-trie/0.1.5 \
+    crate://crates.io/unicode-bidi/0.3.11 \
+    crate://crates.io/unicode-ident/1.0.8 \
+    crate://crates.io/unicode-normalization/0.1.22 \
+    crate://crates.io/unicode-segmentation/1.10.1 \
+    crate://crates.io/unicode-width/0.1.10 \
+    crate://crates.io/unicode-xid/0.2.4 \
     crate://crates.io/untrusted/0.7.1 \
-    crate://crates.io/url/2.2.2 \
+    crate://crates.io/url/2.3.1 \
     crate://crates.io/users/0.11.0 \
     crate://crates.io/uuid/0.8.2 \
     crate://crates.io/vcpkg/0.2.15 \
     crate://crates.io/vec_map/0.8.2 \
-    crate://crates.io/version/3.0.0 \
     crate://crates.io/version_check/0.9.4 \
     crate://crates.io/walkdir/2.3.2 \
     crate://crates.io/wasi/0.11.0+wasi-snapshot-preview1 \
-    crate://crates.io/wasm-bindgen-backend/0.2.82 \
-    crate://crates.io/wasm-bindgen-macro-support/0.2.82 \
-    crate://crates.io/wasm-bindgen-macro/0.2.82 \
-    crate://crates.io/wasm-bindgen-shared/0.2.82 \
-    crate://crates.io/wasm-bindgen/0.2.82 \
-    crate://crates.io/web-sys/0.3.59 \
-    crate://crates.io/which/4.3.0 \
+    crate://crates.io/wasm-bindgen/0.2.84 \
+    crate://crates.io/wasm-bindgen-backend/0.2.84 \
+    crate://crates.io/wasm-bindgen-macro/0.2.84 \
+    crate://crates.io/wasm-bindgen-macro-support/0.2.84 \
+    crate://crates.io/wasm-bindgen-shared/0.2.84 \
+    crate://crates.io/web-sys/0.3.61 \
+    crate://crates.io/which/4.4.0 \
+    crate://crates.io/winapi/0.3.9 \
     crate://crates.io/winapi-i686-pc-windows-gnu/0.4.0 \
     crate://crates.io/winapi-util/0.1.5 \
     crate://crates.io/winapi-x86_64-pc-windows-gnu/0.4.0 \
-    crate://crates.io/winapi/0.3.9 \
+    crate://crates.io/windows-sys/0.42.0 \
+    crate://crates.io/windows-sys/0.45.0 \
+    crate://crates.io/windows-targets/0.42.2 \
+    crate://crates.io/windows_aarch64_gnullvm/0.42.2 \
+    crate://crates.io/windows_aarch64_msvc/0.42.2 \
+    crate://crates.io/windows_i686_gnu/0.42.2 \
+    crate://crates.io/windows_i686_msvc/0.42.2 \
+    crate://crates.io/windows_x86_64_gnu/0.42.2 \
+    crate://crates.io/windows_x86_64_gnullvm/0.42.2 \
+    crate://crates.io/windows_x86_64_msvc/0.42.2 \
     crate://crates.io/x509-parser/0.13.2 \
     crate://crates.io/yasna/0.4.0 \
     crate://crates.io/zeroize/1.5.7 \
-    crate://crates.io/zeroize_derive/1.3.2 \
-"
-
-LIC_FILES_CHKSUM = " \
-    file://LICENSE;md5=3b83ef96387f14655fc854ddc3c6bd57 \
+    crate://crates.io/zeroize_derive/1.3.3 \
 "
diff --git a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb b/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
similarity index 91%
rename from meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb
rename to meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
index 218b776..2536da7 100644
--- a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb
+++ b/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
@@ -1,16 +1,22 @@
 SUMMARY = "Platform AbstRaction for SECurity Daemon"
 HOMEPAGE = "https://github.com/parallaxsecond/parsec"
 LICENSE = "Apache-2.0"
+LIC_FILES_CHKSUM = "file://LICENSE;md5=3b83ef96387f14655fc854ddc3c6bd57"
 
-inherit cargo pkgconfig
-DEPENDS = "clang-native"
+inherit cargo pkgconfig cargo-update-recipe-crates
 
-SRC_URI += "crate://crates.io/parsec-service/${PV} \
+DEPENDS += "clang-native"
+
+SRC_URI += "gitsm://github.com/parallaxsecond/parsec;protocol=https;branch=main \
             file://parsec_init \
             file://systemd.patch \
             file://parsec-tmpfiles.conf \
 "
 
+SRCREV = "f7eda9396eae530771b24b097b709d35d54e40c8"
+
+S = "${WORKDIR}/git"
+
 PACKAGECONFIG ??= "PKCS11 MBED-CRYPTO"
 have_TPM = "${@bb.utils.contains('DISTRO_FEATURES', 'tpm2', 'TPM', '', d)}"
 PACKAGECONFIG:append = " ${@bb.utils.contains('BBFILE_COLLECTIONS', 'tpm-layer', '${have_TPM}', '', d)}"
@@ -82,7 +88,7 @@ FILES:${PN} += " \
     ${sysconfdir}/init.d/parsec \
 "
 
-require parsec-service_${PV}.inc
+require parsec-service-crates.inc
 
 # The QA check has been temporarily disabled. An issue has been created 
 # upstream to fix this. 
-- 
2.34.1



^ permalink raw reply related	[flat|nested] 10+ messages in thread
* Re: [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-03-27  6:16 [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1 Mikko Rapeli
@ 2023-03-27 13:51 ` Anton Antonov
  2023-04-01 12:50 ` [yocto] " akuster808
  1 sibling, 0 replies; 10+ messages in thread
From: Anton Antonov @ 2023-03-27 13:51 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 627 bytes --]

On Sun, Mar 26, 2023 at 11:16 PM, Mikko Rapeli wrote:

> 
> ...ce_1.1.0.inc => parsec-service-crates.inc} | 239 +++++++++---------
> ...e_1.1.0.bb => parsec-service_1.2.0-rc1.bb} | 14 +-
> 2 files changed, 134 insertions(+), 119 deletions(-)
> rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.inc
> => parsec-service-crates.inc} (50%)
> rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.bb
> => parsec-service_1.2.0-rc1.bb} (91%)
> 
> v3: change to gitsm fetcher

Ack, although this recipe will be replaced with 1.2.0 release version in a week of two.

Cheers,
Anton

[-- Attachment #2: Type: text/html, Size: 697 bytes --]

^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [yocto] [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-03-27  6:16 [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1 Mikko Rapeli
  2023-03-27 13:51 ` Anton Antonov
@ 2023-04-01 12:50 ` akuster808
  2023-04-03  8:59   ` Anton Antonov
  2023-04-03 10:53   ` Anton Antonov
  1 sibling, 2 replies; 10+ messages in thread
From: akuster808 @ 2023-04-01 12:50 UTC (permalink / raw)
  To: Mikko Rapeli, yocto



On 3/27/23 2:16 AM, Mikko Rapeli wrote:
> parsec-service 1.1.0 fails to compile with latest tpm2-tss update
> in meta-security:
Thanks for the update.

This patch is currently in a test build.

Just a note. If this version ends up being the official one being 
supported in the upcoming 4.2 release, when parsec-service 1.2.0 
official drops and is added, we will need to us "EPOCH" as I believe 
"-rc1" being dropped will signal the version going backwards.

- armin
>
> | error: failed to run custom build command for `tss-esapi v7.1.0`
> |
> | Caused by:
> |   process didn't exit successfully:
> `/oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/build/target/release/build/tss-esapi-5b5d9342bd16db73/build-script-build`
> (exit status: 101)
> |   --- stderr
> |   thread 'main' panicked at 'Unsupported TSS version: 4',
> /oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/cargo_home/bitbake/tss-esapi-7.1.0/build.rs:9:22
>
> and also latest meta-clang changes break the build with:
>
> |   thread 'main' panicked at '"enum_(unnamed_at_/oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1_1_0-r0/build/target/aarch64-trs-linux-gnu/release/build/psa-crypto-sys-b4f9ce2b7d8846b2/out/include/mbedtls/cipher_h_205_1)" is not a valid Ident', /oe/build/tmp_trs-qemuarm64/work/cortexa57-trs-linux/parsec-service/1.1.0-r0/cargo_home/bitbake/proc-macro2-1.0.43/src/fallback.rs:730:9
> |   stack backtrace:
> |      0: rust_begin_unwind
> |      1: core::panicking::panic_fmt
> |      2: proc_macro2::fallback::validate_ident
> |      3: proc_macro2::fallback::Ident::_new
> |      4: proc_macro2::fallback::Ident::new
> |      5: proc_macro2::imp::Ident::new
> |      6: proc_macro2::Ident::new
> |      7: bindgen::ir::context::BindgenContext::rust_ident_raw
> |      8: bindgen::ir::context::BindgenContext::rust_ident
> |      9: <bindgen::ir::enum_ty::Enum as bindgen::codegen::CodeGenerator>::codegen
> |     10: <bindgen::ir::ty::Type as bindgen::codegen::CodeGenerator>::codegen
> |     11: <bindgen::ir::item::Item as bindgen::codegen::CodeGenerator>::codegen
> |     12: <bindgen::ir::module::Module as bindgen::codegen::CodeGenerator>::codegen::{{closure}}
> |     13: <bindgen::ir::module::Module as bindgen::codegen::CodeGenerator>::codegen
> |     14: <bindgen::ir::item::Item as bindgen::codegen::CodeGenerator>::codegen
> |     15: bindgen::codegen::codegen::{{closure}}
> |     16: bindgen::ir::context::BindgenContext::gen
> |     17: bindgen::codegen::codegen
> |     18: bindgen::Bindings::generate
> |     19: bindgen::Builder::generate
> |     20: build_script_build::common::generate_mbed_crypto_bindings
> |     21: build_script_build::operations::script_operations
> |     22: build_script_build::main
> |     23: core::ops::function::FnOnce::call_once
> |   note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
>
> In both cases fix is to update to the master branch or 1.2.0-rc1 pre-release.
> Porting the individual patches did not work due to complex rust crate depencies.
>
> Added LICENSE file checksum. Using cargo-update-recipe-crates.bbclass from
> poky to maintain list of crates in the .inc file, but removed entries
> for fuzz/Cargo.lock. Tested on qemu that parsec.service stars correctly
> and works with swtpm use cases.
>
> Signed-off-by: Mikko Rapeli <mikko.rapeli@linaro.org>
> ---
>   ...ce_1.1.0.inc => parsec-service-crates.inc} | 239 +++++++++---------
>   ...e_1.1.0.bb => parsec-service_1.2.0-rc1.bb} |  14 +-
>   2 files changed, 134 insertions(+), 119 deletions(-)
>   rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.inc => parsec-service-crates.inc} (50%)
>   rename meta-parsec/recipes-parsec/parsec-service/{parsec-service_1.1.0.bb => parsec-service_1.2.0-rc1.bb} (91%)
>
> v3: change to gitsm fetcher
>
> v2: removed crates for fuzz/Cargo.lock from SRC_URI
>      https://lists.yoctoproject.org/g/yocto/message/59518
>
> v1: https://lists.yoctoproject.org/g/yocto/message/59495
> diff --git a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc b/meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
> similarity index 50%
> rename from meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc
> rename to meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
> index c04bcbd..fe80b42 100644
> --- a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.inc
> +++ b/meta-parsec/recipes-parsec/parsec-service/parsec-service-crates.inc
> @@ -1,223 +1,232 @@
> -# This file is created from parsec repository Cargo.lock using cargo-bitbake tool
> +# Autogenerated with 'bitbake -c update_crates parsec-service'
>   
> +# from Cargo.lock
>   SRC_URI += " \
>       crate://crates.io/ahash/0.7.6 \
> -    crate://crates.io/aho-corasick/0.7.19 \
> +    crate://crates.io/aho-corasick/0.7.20 \
>       crate://crates.io/ansi_term/0.12.1 \
> -    crate://crates.io/anyhow/1.0.64 \
> +    crate://crates.io/anyhow/1.0.69 \
> +    crate://crates.io/asn1-rs/0.3.1 \
>       crate://crates.io/asn1-rs-derive/0.1.0 \
>       crate://crates.io/asn1-rs-impl/0.1.0 \
> -    crate://crates.io/asn1-rs/0.3.1 \
>       crate://crates.io/atty/0.2.14 \
>       crate://crates.io/autocfg/1.1.0 \
> -    crate://crates.io/base64/0.13.0 \
> +    crate://crates.io/base64/0.13.1 \
>       crate://crates.io/bincode/1.3.3 \
>       crate://crates.io/bindgen/0.57.0 \
> -    crate://crates.io/bindgen/0.59.2 \
> +    crate://crates.io/bindgen/0.63.0 \
>       crate://crates.io/bitfield/0.13.2 \
>       crate://crates.io/bitflags/1.3.2 \
> -    crate://crates.io/bumpalo/3.11.0 \
> -    crate://crates.io/bytes/1.2.1 \
> -    crate://crates.io/cc/1.0.73 \
> +    crate://crates.io/bumpalo/3.12.0 \
> +    crate://crates.io/bytes/1.4.0 \
> +    crate://crates.io/cc/1.0.79 \
>       crate://crates.io/cexpr/0.4.0 \
>       crate://crates.io/cexpr/0.6.0 \
>       crate://crates.io/cfg-if/1.0.0 \
> -    crate://crates.io/clang-sys/1.3.3 \
> +    crate://crates.io/clang-sys/1.6.0 \
>       crate://crates.io/clap/2.34.0 \
>       crate://crates.io/cmake/0.1.45 \
>       crate://crates.io/const-oid/0.7.1 \
>       crate://crates.io/cryptoauthlib-sys/0.2.2 \
> -    crate://crates.io/cryptoki-sys/0.1.4 \
> -    crate://crates.io/cryptoki/0.3.0 \
> -    crate://crates.io/data-encoding/2.3.2 \
> -    crate://crates.io/der-parser/7.0.0 \
> +    crate://crates.io/cryptoki/0.3.1 \
> +    crate://crates.io/cryptoki-sys/0.1.5 \
> +    crate://crates.io/data-encoding/2.3.3 \
>       crate://crates.io/der/0.5.1 \
> +    crate://crates.io/der-parser/7.0.0 \
>       crate://crates.io/derivative/2.2.0 \
>       crate://crates.io/displaydoc/0.2.3 \
> -    crate://crates.io/either/1.8.0 \
> +    crate://crates.io/either/1.8.1 \
>       crate://crates.io/enumflags2/0.7.5 \
>       crate://crates.io/enumflags2_derive/0.7.4 \
>       crate://crates.io/env_logger/0.8.4 \
> -    crate://crates.io/env_logger/0.9.0 \
> +    crate://crates.io/errno/0.2.8 \
> +    crate://crates.io/errno-dragonfly/0.1.2 \
>       crate://crates.io/fallible-iterator/0.2.0 \
>       crate://crates.io/fallible-streaming-iterator/0.1.9 \
> -    crate://crates.io/fastrand/1.8.0 \
> +    crate://crates.io/fastrand/1.9.0 \
>       crate://crates.io/fixedbitset/0.2.0 \
> -    crate://crates.io/form_urlencoded/1.0.1 \
> -    crate://crates.io/futures-channel/0.3.24 \
> -    crate://crates.io/futures-core/0.3.24 \
> -    crate://crates.io/futures-executor/0.3.24 \
> -    crate://crates.io/futures-io/0.3.24 \
> -    crate://crates.io/futures-macro/0.3.24 \
> -    crate://crates.io/futures-sink/0.3.24 \
> -    crate://crates.io/futures-task/0.3.24 \
> -    crate://crates.io/futures-util/0.3.24 \
> -    crate://crates.io/futures/0.3.24 \
> +    crate://crates.io/form_urlencoded/1.1.0 \
> +    crate://crates.io/futures/0.3.27 \
> +    crate://crates.io/futures-channel/0.3.27 \
> +    crate://crates.io/futures-core/0.3.27 \
> +    crate://crates.io/futures-executor/0.3.27 \
> +    crate://crates.io/futures-io/0.3.27 \
> +    crate://crates.io/futures-macro/0.3.27 \
> +    crate://crates.io/futures-sink/0.3.27 \
> +    crate://crates.io/futures-task/0.3.27 \
> +    crate://crates.io/futures-util/0.3.27 \
>       crate://crates.io/generic-array/0.14.6 \
> -    crate://crates.io/getrandom/0.2.7 \
> -    crate://crates.io/glob/0.3.0 \
> -    crate://crates.io/grpcio-sys/0.9.1+1.38.0 \
> +    crate://crates.io/getrandom/0.2.8 \
> +    crate://crates.io/glob/0.3.1 \
>       crate://crates.io/grpcio/0.9.1 \
> -    crate://crates.io/hashbrown/0.11.2 \
> -    crate://crates.io/hashlink/0.7.0 \
> +    crate://crates.io/grpcio-sys/0.9.1+1.38.0 \
> +    crate://crates.io/hashbrown/0.12.3 \
> +    crate://crates.io/hashlink/0.8.1 \
>       crate://crates.io/heck/0.3.3 \
>       crate://crates.io/hermit-abi/0.1.19 \
> +    crate://crates.io/hermit-abi/0.2.6 \
>       crate://crates.io/hex/0.4.3 \
>       crate://crates.io/hostname-validator/1.1.1 \
>       crate://crates.io/humantime/2.1.0 \
> -    crate://crates.io/idna/0.2.3 \
> -    crate://crates.io/indexmap/1.8.2 \
> +    crate://crates.io/idna/0.3.0 \
> +    crate://crates.io/indexmap/1.9.2 \
>       crate://crates.io/instant/0.1.12 \
> -    crate://crates.io/itertools/0.10.3 \
> -    crate://crates.io/itoa/1.0.3 \
> -    crate://crates.io/js-sys/0.3.59 \
> +    crate://crates.io/io-lifetimes/1.0.6 \
> +    crate://crates.io/itertools/0.10.5 \
> +    crate://crates.io/itoa/1.0.6 \
> +    crate://crates.io/js-sys/0.3.61 \
>       crate://crates.io/jsonwebkey/0.3.5 \
> -    crate://crates.io/jsonwebtoken/8.1.1 \
> +    crate://crates.io/jsonwebtoken/8.2.0 \
>       crate://crates.io/lazy_static/1.4.0 \
>       crate://crates.io/lazycell/1.3.0 \
> -    crate://crates.io/libc/0.2.132 \
> -    crate://crates.io/libloading/0.7.3 \
> -    crate://crates.io/libsqlite3-sys/0.23.2 \
> +    crate://crates.io/libc/0.2.140 \
> +    crate://crates.io/libloading/0.7.4 \
> +    crate://crates.io/libsqlite3-sys/0.25.2 \
>       crate://crates.io/libz-sys/1.1.8 \
> -    crate://crates.io/lock_api/0.4.8 \
> +    crate://crates.io/linux-raw-sys/0.1.4 \
> +    crate://crates.io/lock_api/0.4.9 \
>       crate://crates.io/log/0.4.17 \
> -    crate://crates.io/matches/0.1.9 \
>       crate://crates.io/mbox/0.6.0 \
>       crate://crates.io/memchr/2.5.0 \
>       crate://crates.io/minimal-lexical/0.2.1 \
>       crate://crates.io/multimap/0.8.3 \
>       crate://crates.io/nom/5.1.2 \
> -    crate://crates.io/nom/7.1.1 \
> +    crate://crates.io/nom/7.1.3 \
> +    crate://crates.io/num/0.4.0 \
>       crate://crates.io/num-bigint/0.4.3 \
> -    crate://crates.io/num-complex/0.4.2 \
> +    crate://crates.io/num-complex/0.4.3 \
>       crate://crates.io/num-derive/0.3.3 \
>       crate://crates.io/num-integer/0.1.45 \
>       crate://crates.io/num-iter/0.1.43 \
>       crate://crates.io/num-rational/0.4.1 \
>       crate://crates.io/num-traits/0.2.15 \
> -    crate://crates.io/num/0.4.0 \
> -    crate://crates.io/num_cpus/1.13.1 \
> +    crate://crates.io/num_cpus/1.15.0 \
>       crate://crates.io/num_threads/0.1.6 \
> -    crate://crates.io/oid-registry/0.4.0 \
>       crate://crates.io/oid/0.2.1 \
> -    crate://crates.io/once_cell/1.14.0 \
> +    crate://crates.io/oid-registry/0.4.0 \
> +    crate://crates.io/once_cell/1.17.1 \
>       crate://crates.io/parking_lot/0.11.2 \
> -    crate://crates.io/parking_lot_core/0.8.5 \
> -    crate://crates.io/parsec-interface/0.27.0 \
> +    crate://crates.io/parking_lot_core/0.8.6 \
> +    crate://crates.io/parsec-interface/0.28.0 \
>       crate://crates.io/peeking_take_while/0.1.2 \
> -    crate://crates.io/pem/1.1.0 \
> -    crate://crates.io/percent-encoding/2.1.0 \
> -    crate://crates.io/pest/2.3.0 \
> +    crate://crates.io/pem/1.1.1 \
> +    crate://crates.io/percent-encoding/2.2.0 \
> +    crate://crates.io/pest/2.5.6 \
>       crate://crates.io/petgraph/0.5.1 \
> +    crate://crates.io/picky-asn1/0.3.3 \
>       crate://crates.io/picky-asn1-der/0.2.5 \
>       crate://crates.io/picky-asn1-x509/0.6.1 \
> -    crate://crates.io/picky-asn1/0.3.3 \
>       crate://crates.io/pin-project-lite/0.2.9 \
>       crate://crates.io/pin-utils/0.1.0 \
>       crate://crates.io/pkcs8/0.8.0 \
> -    crate://crates.io/pkg-config/0.3.25 \
> -    crate://crates.io/ppv-lite86/0.2.16 \
> -    crate://crates.io/proc-macro-error-attr/1.0.4 \
> +    crate://crates.io/pkg-config/0.3.26 \
> +    crate://crates.io/ppv-lite86/0.2.17 \
>       crate://crates.io/proc-macro-error/1.0.4 \
> -    crate://crates.io/proc-macro2/1.0.43 \
> +    crate://crates.io/proc-macro-error-attr/1.0.4 \
> +    crate://crates.io/proc-macro2/1.0.52 \
> +    crate://crates.io/prost/0.8.0 \
>       crate://crates.io/prost-build/0.8.0 \
>       crate://crates.io/prost-derive/0.8.0 \
>       crate://crates.io/prost-types/0.8.0 \
> -    crate://crates.io/prost/0.8.0 \
> -    crate://crates.io/protobuf/2.27.1 \
> -    crate://crates.io/psa-crypto-sys/0.9.3 \
> -    crate://crates.io/psa-crypto/0.9.2 \
> -    crate://crates.io/quote/1.0.21 \
> +    crate://crates.io/protobuf/2.28.0 \
> +    crate://crates.io/psa-crypto/0.10.0 \
> +    crate://crates.io/psa-crypto-sys/0.10.0 \
> +    crate://crates.io/quote/1.0.26 \
>       crate://crates.io/rand/0.8.5 \
>       crate://crates.io/rand_chacha/0.3.1 \
> -    crate://crates.io/rand_core/0.6.3 \
> +    crate://crates.io/rand_core/0.6.4 \
>       crate://crates.io/redox_syscall/0.2.16 \
> -    crate://crates.io/regex-syntax/0.6.27 \
> -    crate://crates.io/regex/1.6.0 \
> -    crate://crates.io/remove_dir_all/0.5.3 \
> +    crate://crates.io/regex/1.7.1 \
> +    crate://crates.io/regex-syntax/0.6.28 \
>       crate://crates.io/ring/0.16.20 \
> -    crate://crates.io/rusqlite/0.26.3 \
> +    crate://crates.io/rusqlite/0.28.0 \
>       crate://crates.io/rust-cryptoauthlib/0.4.5 \
>       crate://crates.io/rustc-hash/1.1.0 \
>       crate://crates.io/rustc_version/0.3.3 \
>       crate://crates.io/rusticata-macros/4.1.0 \
> -    crate://crates.io/ryu/1.0.11 \
> +    crate://crates.io/rustix/0.36.9 \
> +    crate://crates.io/ryu/1.0.13 \
>       crate://crates.io/same-file/1.0.6 \
>       crate://crates.io/scopeguard/1.1.0 \
> -    crate://crates.io/sd-notify/0.2.0 \
> +    crate://crates.io/sd-notify/0.3.0 \
>       crate://crates.io/secrecy/0.7.0 \
> -    crate://crates.io/semver-parser/0.10.2 \
>       crate://crates.io/semver/0.11.0 \
> -    crate://crates.io/serde/1.0.144 \
> -    crate://crates.io/serde_bytes/0.11.7 \
> -    crate://crates.io/serde_derive/1.0.144 \
> -    crate://crates.io/serde_json/1.0.85 \
> +    crate://crates.io/semver-parser/0.10.2 \
> +    crate://crates.io/serde/1.0.156 \
> +    crate://crates.io/serde_bytes/0.11.9 \
> +    crate://crates.io/serde_derive/1.0.156 \
> +    crate://crates.io/serde_json/1.0.94 \
>       crate://crates.io/shlex/0.1.1 \
>       crate://crates.io/shlex/1.1.0 \
> -    crate://crates.io/signal-hook-registry/1.4.0 \
> -    crate://crates.io/signal-hook/0.3.14 \
> +    crate://crates.io/signal-hook/0.3.15 \
> +    crate://crates.io/signal-hook-registry/1.4.1 \
>       crate://crates.io/simple_asn1/0.6.2 \
> -    crate://crates.io/slab/0.4.7 \
> -    crate://crates.io/smallvec/1.9.0 \
> +    crate://crates.io/slab/0.4.8 \
> +    crate://crates.io/smallvec/1.10.0 \
>       crate://crates.io/spiffe/0.2.1 \
>       crate://crates.io/spin/0.5.2 \
>       crate://crates.io/spki/0.5.4 \
>       crate://crates.io/stable_deref_trait/1.2.0 \
>       crate://crates.io/strsim/0.8.0 \
> -    crate://crates.io/structopt-derive/0.4.18 \
>       crate://crates.io/structopt/0.3.26 \
> +    crate://crates.io/structopt-derive/0.4.18 \
>       crate://crates.io/strum_macros/0.21.1 \
> -    crate://crates.io/syn/1.0.99 \
> +    crate://crates.io/syn/1.0.109 \
>       crate://crates.io/synstructure/0.12.6 \
> -    crate://crates.io/target-lexicon/0.12.4 \
> -    crate://crates.io/tempfile/3.3.0 \
> -    crate://crates.io/termcolor/1.1.3 \
> +    crate://crates.io/target-lexicon/0.12.6 \
> +    crate://crates.io/tempfile/3.4.0 \
> +    crate://crates.io/termcolor/1.2.0 \
>       crate://crates.io/textwrap/0.11.0 \
> -    crate://crates.io/thiserror-impl/1.0.33 \
> -    crate://crates.io/thiserror/1.0.33 \
> +    crate://crates.io/thiserror/1.0.39 \
> +    crate://crates.io/thiserror-impl/1.0.39 \
>       crate://crates.io/threadpool/1.8.1 \
> +    crate://crates.io/time/0.3.15 \
>       crate://crates.io/time-macros/0.2.4 \
> -    crate://crates.io/time/0.3.14 \
>       crate://crates.io/tinyvec/1.6.0 \
> -    crate://crates.io/tinyvec_macros/0.1.0 \
> -    crate://crates.io/toml/0.5.9 \
> -    crate://crates.io/tss-esapi-sys/0.3.0 \
> -    crate://crates.io/tss-esapi/7.1.0 \
> -    crate://crates.io/typenum/1.15.0 \
> -    crate://crates.io/ucd-trie/0.1.4 \
> -    crate://crates.io/unicode-bidi/0.3.8 \
> -    crate://crates.io/unicode-ident/1.0.3 \
> -    crate://crates.io/unicode-normalization/0.1.21 \
> -    crate://crates.io/unicode-segmentation/1.9.0 \
> -    crate://crates.io/unicode-width/0.1.9 \
> -    crate://crates.io/unicode-xid/0.2.3 \
> +    crate://crates.io/tinyvec_macros/0.1.1 \
> +    crate://crates.io/toml/0.5.11 \
> +    crate://crates.io/tss-esapi/7.2.0 \
> +    crate://crates.io/tss-esapi-sys/0.4.0 \
> +    crate://crates.io/typenum/1.16.0 \
> +    crate://crates.io/ucd-trie/0.1.5 \
> +    crate://crates.io/unicode-bidi/0.3.11 \
> +    crate://crates.io/unicode-ident/1.0.8 \
> +    crate://crates.io/unicode-normalization/0.1.22 \
> +    crate://crates.io/unicode-segmentation/1.10.1 \
> +    crate://crates.io/unicode-width/0.1.10 \
> +    crate://crates.io/unicode-xid/0.2.4 \
>       crate://crates.io/untrusted/0.7.1 \
> -    crate://crates.io/url/2.2.2 \
> +    crate://crates.io/url/2.3.1 \
>       crate://crates.io/users/0.11.0 \
>       crate://crates.io/uuid/0.8.2 \
>       crate://crates.io/vcpkg/0.2.15 \
>       crate://crates.io/vec_map/0.8.2 \
> -    crate://crates.io/version/3.0.0 \
>       crate://crates.io/version_check/0.9.4 \
>       crate://crates.io/walkdir/2.3.2 \
>       crate://crates.io/wasi/0.11.0+wasi-snapshot-preview1 \
> -    crate://crates.io/wasm-bindgen-backend/0.2.82 \
> -    crate://crates.io/wasm-bindgen-macro-support/0.2.82 \
> -    crate://crates.io/wasm-bindgen-macro/0.2.82 \
> -    crate://crates.io/wasm-bindgen-shared/0.2.82 \
> -    crate://crates.io/wasm-bindgen/0.2.82 \
> -    crate://crates.io/web-sys/0.3.59 \
> -    crate://crates.io/which/4.3.0 \
> +    crate://crates.io/wasm-bindgen/0.2.84 \
> +    crate://crates.io/wasm-bindgen-backend/0.2.84 \
> +    crate://crates.io/wasm-bindgen-macro/0.2.84 \
> +    crate://crates.io/wasm-bindgen-macro-support/0.2.84 \
> +    crate://crates.io/wasm-bindgen-shared/0.2.84 \
> +    crate://crates.io/web-sys/0.3.61 \
> +    crate://crates.io/which/4.4.0 \
> +    crate://crates.io/winapi/0.3.9 \
>       crate://crates.io/winapi-i686-pc-windows-gnu/0.4.0 \
>       crate://crates.io/winapi-util/0.1.5 \
>       crate://crates.io/winapi-x86_64-pc-windows-gnu/0.4.0 \
> -    crate://crates.io/winapi/0.3.9 \
> +    crate://crates.io/windows-sys/0.42.0 \
> +    crate://crates.io/windows-sys/0.45.0 \
> +    crate://crates.io/windows-targets/0.42.2 \
> +    crate://crates.io/windows_aarch64_gnullvm/0.42.2 \
> +    crate://crates.io/windows_aarch64_msvc/0.42.2 \
> +    crate://crates.io/windows_i686_gnu/0.42.2 \
> +    crate://crates.io/windows_i686_msvc/0.42.2 \
> +    crate://crates.io/windows_x86_64_gnu/0.42.2 \
> +    crate://crates.io/windows_x86_64_gnullvm/0.42.2 \
> +    crate://crates.io/windows_x86_64_msvc/0.42.2 \
>       crate://crates.io/x509-parser/0.13.2 \
>       crate://crates.io/yasna/0.4.0 \
>       crate://crates.io/zeroize/1.5.7 \
> -    crate://crates.io/zeroize_derive/1.3.2 \
> -"
> -
> -LIC_FILES_CHKSUM = " \
> -    file://LICENSE;md5=3b83ef96387f14655fc854ddc3c6bd57 \
> +    crate://crates.io/zeroize_derive/1.3.3 \
>   "
> diff --git a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb b/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
> similarity index 91%
> rename from meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb
> rename to meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
> index 218b776..2536da7 100644
> --- a/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.1.0.bb
> +++ b/meta-parsec/recipes-parsec/parsec-service/parsec-service_1.2.0-rc1.bb
> @@ -1,16 +1,22 @@
>   SUMMARY = "Platform AbstRaction for SECurity Daemon"
>   HOMEPAGE = "https://github.com/parallaxsecond/parsec"
>   LICENSE = "Apache-2.0"
> +LIC_FILES_CHKSUM = "file://LICENSE;md5=3b83ef96387f14655fc854ddc3c6bd57"
>   
> -inherit cargo pkgconfig
> -DEPENDS = "clang-native"
> +inherit cargo pkgconfig cargo-update-recipe-crates
>   
> -SRC_URI += "crate://crates.io/parsec-service/${PV} \
> +DEPENDS += "clang-native"
> +
> +SRC_URI += "gitsm://github.com/parallaxsecond/parsec;protocol=https;branch=main \
>               file://parsec_init \
>               file://systemd.patch \
>               file://parsec-tmpfiles.conf \
>   "
>   
> +SRCREV = "f7eda9396eae530771b24b097b709d35d54e40c8"
> +
> +S = "${WORKDIR}/git"
> +
>   PACKAGECONFIG ??= "PKCS11 MBED-CRYPTO"
>   have_TPM = "${@bb.utils.contains('DISTRO_FEATURES', 'tpm2', 'TPM', '', d)}"
>   PACKAGECONFIG:append = " ${@bb.utils.contains('BBFILE_COLLECTIONS', 'tpm-layer', '${have_TPM}', '', d)}"
> @@ -82,7 +88,7 @@ FILES:${PN} += " \
>       ${sysconfdir}/init.d/parsec \
>   "
>   
> -require parsec-service_${PV}.inc
> +require parsec-service-crates.inc
>   
>   # The QA check has been temporarily disabled. An issue has been created
>   # upstream to fix this.
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#59523): https://lists.yoctoproject.org/g/yocto/message/59523
> Mute This Topic: https://lists.yoctoproject.org/mt/97876594/3616698
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [akuster808@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>



^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-01 12:50 ` [yocto] " akuster808
@ 2023-04-03  8:59   ` Anton Antonov
  2023-04-03 10:53   ` Anton Antonov
  1 sibling, 0 replies; 10+ messages in thread
From: Anton Antonov @ 2023-04-03  8:59 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 681 bytes --]

On Sat, Apr 1, 2023 at 05:50 AM, Armin Kuster wrote:

> 
> 
>> parsec-service 1.1.0 fails to compile with latest tpm2-tss update
>> in meta-security:
> 
> Thanks for the update.
> This patch is currently in a test build.
> Just a note. If this version ends up being the official one being
> supported in the upcoming 4.2 release, when parsec-service 1.2.0 official
> drops and is added, we will need to us "EPOCH" as I believe "-rc1" being
> dropped will signal the version going backwards.

We're planning to include Parsec 1.2.0 release into 4.2. I'm not sure what to do with this rc1 recipes tbh.

Miko, can you wait for the Parsec release?

Cheers,

Anton

[-- Attachment #2: Type: text/html, Size: 752 bytes --]

^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-01 12:50 ` [yocto] " akuster808
  2023-04-03  8:59   ` Anton Antonov
@ 2023-04-03 10:53   ` Anton Antonov
  2023-04-03 12:04     ` [yocto] " akuster808
  2023-04-06 12:38     ` akuster808
  1 sibling, 2 replies; 10+ messages in thread
From: Anton Antonov @ 2023-04-03 10:53 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 902 bytes --]

On Sat, Apr 1, 2023 at 05:50 AM, Armin Kuster wrote:

> 
> 
>> parsec-service 1.1.0 fails to compile with latest tpm2-tss update
>> in meta-security:
> 
> Thanks for the update.
> This patch is currently in a test build.
> Just a note. If this version ends up being the official one being
> supported in the upcoming 4.2 release, when parsec-service 1.2.0 official
> drops and is added, we will need to us "EPOCH" as I believe "-rc1" being
> dropped will signal the version going backwards.

I think Parsec would fail to be built with this patch after these patches in OE-core:

https://git.yoctoproject.org/poky/commit/?id=2b12c58724d250d1faf24072128e2de75dfe2c15

https://git.yoctoproject.org/poky/commit/?id=4d9886e1435dba3785973cc920865f8ab67e644d

Updates for cargo-update-recipe-crates are under review and the 1.2.0 release recipe would solve the issue.

Cheers,

Anton

[-- Attachment #2: Type: text/html, Size: 1259 bytes --]

^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [yocto] [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-03 10:53   ` Anton Antonov
@ 2023-04-03 12:04     ` akuster808
  2023-04-06 12:38     ` akuster808
  1 sibling, 0 replies; 10+ messages in thread
From: akuster808 @ 2023-04-03 12:04 UTC (permalink / raw)
  To: Anton Antonov, yocto



On 4/3/23 6:53 AM, Anton Antonov wrote:
> On Sat, Apr 1, 2023 at 05:50 AM, Armin Kuster wrote:
>
>         parsec-service 1.1.0 fails to compile with latest tpm2-tss update
>         in meta-security:
>
>     Thanks for the update.
>     This patch is currently in a test build.
>     Just a note. If this version ends up being the official one being
>     supported in the upcoming 4.2 release, when parsec-service 1.2.0
>     official drops and is added, we will need to us "EPOCH" as I
>     believe "-rc1" being dropped will signal the version going backwards.
>
> I think Parsec would fail to be built with this patch after these 
> patches in OE-core:
>
> https://git.yoctoproject.org/poky/commit/?id=2b12c58724d250d1faf24072128e2de75dfe2c15
>
> https://git.yoctoproject.org/poky/commit/?id=4d9886e1435dba3785973cc920865f8ab67e644d
>

Yep, I am dealing with this on two other rust recipes. Fun.

-armin
>
> Updates for cargo-update-recipe-crates are under review and the 1.2.0 
> release recipe would solve the issue.
>
> Cheers,
>
> Anton
>
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#59596): https://lists.yoctoproject.org/g/yocto/message/59596
> Mute This Topic: https://lists.yoctoproject.org/mt/97876594/3616698
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [akuster808@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>



^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [yocto] [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-03 10:53   ` Anton Antonov
  2023-04-03 12:04     ` [yocto] " akuster808
@ 2023-04-06 12:38     ` akuster808
  2023-04-06 12:41       ` Anton Antonov
  1 sibling, 1 reply; 10+ messages in thread
From: akuster808 @ 2023-04-06 12:38 UTC (permalink / raw)
  To: Anton Antonov, yocto



On 4/3/23 6:53 AM, Anton Antonov wrote:
> On Sat, Apr 1, 2023 at 05:50 AM, Armin Kuster wrote:
>
>         parsec-service 1.1.0 fails to compile with latest tpm2-tss update
>         in meta-security:
>
>     Thanks for the update.
>     This patch is currently in a test build.
>     Just a note. If this version ends up being the official one being
>     supported in the upcoming 4.2 release, when parsec-service 1.2.0
>     official drops and is added, we will need to us "EPOCH" as I
>     believe "-rc1" being dropped will signal the version going backwards.
>
> I think Parsec would fail to be built with this patch after these 
> patches in OE-core:
>
> https://git.yoctoproject.org/poky/commit/?id=2b12c58724d250d1faf24072128e2de75dfe2c15
>
> https://git.yoctoproject.org/poky/commit/?id=4d9886e1435dba3785973cc920865f8ab67e644d
>
> Updates for cargo-update-recipe-crates are under review and the 1.2.0 
> release recipe would solve the issue.
>

1.2.0 released yesterday. Is someone planning on sending  a new series. 
If not, I can give it a shot.

- Armin
>
> Cheers,
>
> Anton
>
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#59596): https://lists.yoctoproject.org/g/yocto/message/59596
> Mute This Topic: https://lists.yoctoproject.org/mt/97876594/3616698
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [akuster808@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>



^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-06 12:38     ` akuster808
@ 2023-04-06 12:41       ` Anton Antonov
  2023-04-10 11:17         ` [yocto] " akuster808
  0 siblings, 1 reply; 10+ messages in thread
From: Anton Antonov @ 2023-04-06 12:41 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 256 bytes --]

On Thu, Apr 6, 2023 at 05:38 AM, Armin Kuster wrote:

> 
> 1.2.0 released yesterday. Is someone planning on sending  a new series. If
> not, I can give it a shot.

Yes, we're testing the new recipes atm. We will send them asap.

Cheers,

Anton

[-- Attachment #2: Type: text/html, Size: 310 bytes --]

^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [yocto] [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-06 12:41       ` Anton Antonov
@ 2023-04-10 11:17         ` akuster808
  2023-04-10 18:22           ` Anton Antonov
  0 siblings, 1 reply; 10+ messages in thread
From: akuster808 @ 2023-04-10 11:17 UTC (permalink / raw)
  To: Anton Antonov, yocto



On 4/6/23 8:41 AM, Anton Antonov wrote:
> On Thu, Apr 6, 2023 at 05:38 AM, Armin Kuster wrote:
>
>     1.2.0 released yesterday. Is someone planning on sending  a new
>     series. If not, I can give it a shot.
>
> Yes, we're testing the new recipes atm. We will send them asap.
>

Something in latest master may have introduced another issue, this time 
the runtime testing.  I am see this new error:


  self.check_packageconfig("TS")
   File 
"/home/akuster/oss/maint/meta-security/meta-parsec/lib/oeqa/runtime/cases/parsec.py", 
line 64, in check_packageconfig
     if prov not in self.tc.td['PACKAGECONFIG:pn-parsec-service']:
KeyError: 'PACKAGECONFIG:pn-parsec-service'


Any ideas on how to fix or what might be causing this? I thought I had a 
fix but the test hangs.

-armin

> Cheers,
>
> Anton
>
>
> -=-=-=-=-=-=-=-=-=-=-=-
> Links: You receive all messages sent to this group.
> View/Reply Online (#59629): https://lists.yoctoproject.org/g/yocto/message/59629
> Mute This Topic: https://lists.yoctoproject.org/mt/97876594/3616698
> Group Owner: yocto+owner@lists.yoctoproject.org
> Unsubscribe: https://lists.yoctoproject.org/g/yocto/unsub [akuster808@gmail.com]
> -=-=-=-=-=-=-=-=-=-=-=-
>



^ permalink raw reply	[flat|nested] 10+ messages in thread
* Re: [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1
  2023-04-10 11:17         ` [yocto] " akuster808
@ 2023-04-10 18:22           ` Anton Antonov
  0 siblings, 0 replies; 10+ messages in thread
From: Anton Antonov @ 2023-04-10 18:22 UTC (permalink / raw)
  To: yocto

[-- Attachment #1: Type: text/plain, Size: 743 bytes --]

On Mon, Apr 10, 2023 at 04:17 AM, Armin Kuster wrote:

> 
> Something in latest master may have introduced another issue, this time
> the runtime testing.  I am see this new error:
> 
> self.check_packageconfig("TS")
> File
> "/home/akuster/oss/maint/meta-security/meta-parsec/lib/oeqa/runtime/cases/parsec.py",
> line 64, in check_packageconfig
> if prov not in self.tc.td['PACKAGECONFIG:pn-parsec-service']:
> KeyError: 'PACKAGECONFIG:pn-parsec-service'
> 
> Any ideas on how to fix or what might be causing this? I thought I had a
> fix but the test hangs.

The default value of PACKAGECONFIG is not included into tc.td if it's not defined in local.conf for whatever reason.

I will send a fix soon.

Cheers,

Anton

[-- Attachment #2: Type: text/html, Size: 854 bytes --]

^ permalink raw reply	[flat|nested] 10+ messages in thread
end of thread, other threads:[~2023-04-10 18:22 UTC | newest]

Thread overview: 10+ messages (download: mbox.gz / follow: Atom feed)
-- links below jump to the message on this page --
2023-03-27  6:16 [meta-security][PATCH v3] parsec-service: update from 1.1.0 to 1.2.0-rc1 Mikko Rapeli
2023-03-27 13:51 ` Anton Antonov
2023-04-01 12:50 ` [yocto] " akuster808
2023-04-03  8:59   ` Anton Antonov
2023-04-03 10:53   ` Anton Antonov
2023-04-03 12:04     ` [yocto] " akuster808
2023-04-06 12:38     ` akuster808
2023-04-06 12:41       ` Anton Antonov
2023-04-10 11:17         ` [yocto] " akuster808
2023-04-10 18:22           ` Anton Antonov

