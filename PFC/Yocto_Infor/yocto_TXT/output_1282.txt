* license manifest files effectively disappear when do_rootfs is not rerun
@ 2022-10-21 13:31 Christian Thießen
  2022-10-25  8:37 ` Christian Thießen
  0 siblings, 1 reply; 2+ messages in thread
From: Christian Thießen @ 2022-10-21 13:31 UTC (permalink / raw)
  To: yocto

Dear list,
when building an image based on kirkstone, it seems I've come across an interesting corner case: The image built successfully, the build/tmp/deploy/licenses/${IMAGE}-${MACHINE} symlink got updated as expected, but that new directory contained only image_license.manifest. license.manifest and package.manifest were missing.
I've discovered that these latter files are generated by the image's do_rootfs task (ROOTFS_POSTPROCESS_COMMAND:prepend = "write_package_manifest; license_create_manifest; " in poky/meta/classes/license_image.bbclass). This task apparently did not need to be rerun in that particular build.
This behavior is at least a bit surprising to the user; bitbake claims to have run everything that needed to be run, completes successfully and then some files are just not there. It might be what happened here https://lists.yoctoproject.org/g/yocto/message/49600 too. For me, it broke a CI build that ran due to an environment change that didn't affect the image and then failed to deploy the manifest files. I could run bitbake with -C rootfs as a workaround, but that causes a warning and the problem could probably better be fixed within Yocto. I'm not sure how though: Could the manifest generation be moved to a different point in the build, e.g. where image_license.manifest is generated? Or should build/tmp/deploy/licenses/${IMAGE}-${MACHINE} become a directory containing symlinks to files, instead of a symlink to a new directory, so that things that don't need to be updated can be retained? Maybe you have a completely different idea? I'll leave that up for discussion.
Thank you,

Christian Thießen


^ permalink raw reply	[flat|nested] 2+ messages in thread
* Re: license manifest files effectively disappear when do_rootfs is not rerun
  2022-10-21 13:31 license manifest files effectively disappear when do_rootfs is not rerun Christian Thießen
@ 2022-10-25  8:37 ` Christian Thießen
  0 siblings, 0 replies; 2+ messages in thread
From: Christian Thießen @ 2022-10-25  8:37 UTC (permalink / raw)
  To: yocto

Sorry for first posting to the wrong board, beginner's mistake.
For reference, discussion has moved to https://lists.openembedded.org/g/openembedded-core/topic/94530086 and led to a bug report at https://bugzilla.yoctoproject.org/show_bug.cgi?id=14946 .

Christian


^ permalink raw reply	[flat|nested] 2+ messages in thread
end of thread, other threads:[~2022-10-25  8:37 UTC | newest]

Thread overview: 2+ messages (download: mbox.gz / follow: Atom feed)
-- links below jump to the message on this page --
2022-10-21 13:31 license manifest files effectively disappear when do_rootfs is not rerun Christian Thießen
2022-10-25  8:37 ` Christian Thießen

